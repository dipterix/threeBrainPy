
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
        <link rel="canonical" href="https://dipterix.org/threebrainpy/api-core-brain/">
      
      
        <link rel="prev" href="../getting-started/">
      
      
        <link rel="next" href="../api-core-vec3/">
      
      
      <link rel="icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.5.2, mkdocs-material-9.2.3">
    
    
      
        <title><Class Brain> - Your Advanced Electrode Localizer Viewer for Python</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.0e669242.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../assets/_mkdocstrings.css">
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    <body dir="ltr">
  
    
    
      <script>var palette=__md_get("__palette");if(palette&&"object"==typeof palette.color)for(var key of Object.keys(palette.color))document.body.setAttribute("data-md-color-"+key,palette.color[key])</script>
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#threebrainpy.core.brain.Brain" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="Your Advanced Electrode Localizer Viewer for Python" class="md-header__button md-logo" aria-label="Your Advanced Electrode Localizer Viewer for Python" data-md-component="logo">
      
  <img src="../assets/images/favicon.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Your Advanced Electrode Localizer Viewer for Python
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              <code>&lt;Class Brain&gt;</code>
            
          </span>
        </div>
      </div>
    </div>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/dipterix/threebrainpy" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.4.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="Your Advanced Electrode Localizer Viewer for Python" class="md-nav__button md-logo" aria-label="Your Advanced Electrode Localizer Viewer for Python" data-md-component="logo">
      
  <img src="../assets/images/favicon.png" alt="logo">

    </a>
    Your Advanced Electrode Localizer Viewer for Python
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/dipterix/threebrainpy" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.4.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Home
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
    <li class="md-nav__item">
      <a href="../getting-started/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Getting Started
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" checked>
        
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    API Reference
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            API Reference
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
    
  
  
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_1" checked>
        
          <label class="md-nav__link" for="__nav_3_1" id="__nav_3_1_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    <code>threebrainpy.core</code>
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_1_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_3_1">
            <span class="md-nav__icon md-icon"></span>
            <code>threebrainpy.core</code>
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  <span class="md-ellipsis">
    <code>&lt;Class Brain&gt;</code>
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    <code>&lt;Class Brain&gt;</code>
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#threebrainpy.core.brain.Brain" class="md-nav__link">
    Brain
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#threebrainpy.core.brain.Brain.electrode_contacts" class="md-nav__link">
    electrode_contacts
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#threebrainpy.core.brain.Brain.path" class="md-nav__link">
    path
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#threebrainpy.core.brain.Brain.path_mri" class="md-nav__link">
    path_mri
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#threebrainpy.core.brain.Brain.path_surf" class="md-nav__link">
    path_surf
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#threebrainpy.core.brain.Brain.ras2mni_152" class="md-nav__link">
    ras2mni_152
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#threebrainpy.core.brain.Brain.ras2mni_305" class="md-nav__link">
    ras2mni_305
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#threebrainpy.core.brain.Brain.ras2ras_tkr" class="md-nav__link">
    ras2ras_tkr
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#threebrainpy.core.brain.Brain.ras_tkr2mni_152" class="md-nav__link">
    ras_tkr2mni_152
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#threebrainpy.core.brain.Brain.ras_tkr2mni_305" class="md-nav__link">
    ras_tkr2mni_305
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#threebrainpy.core.brain.Brain.storage" class="md-nav__link">
    storage
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#threebrainpy.core.brain.Brain.subject_code" class="md-nav__link">
    subject_code
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#threebrainpy.core.brain.Brain.vox2ras" class="md-nav__link">
    vox2ras
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#threebrainpy.core.brain.Brain.vox2ras_tkr" class="md-nav__link">
    vox2ras_tkr
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#threebrainpy.core.brain.Brain.__init__" class="md-nav__link">
    __init__()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#threebrainpy.core.brain.Brain.add_electrode_contact" class="md-nav__link">
    add_electrode_contact()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#threebrainpy.core.brain.Brain.add_electrodes" class="md-nav__link">
    add_electrodes()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#threebrainpy.core.brain.Brain.add_global_data" class="md-nav__link">
    add_global_data()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#threebrainpy.core.brain.Brain.add_group" class="md-nav__link">
    add_group()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#threebrainpy.core.brain.Brain.add_slice" class="md-nav__link">
    add_slice()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#threebrainpy.core.brain.Brain.add_surfaces" class="md-nav__link">
    add_surfaces()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#threebrainpy.core.brain.Brain.add_volume" class="md-nav__link">
    add_volume()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#threebrainpy.core.brain.Brain.build" class="md-nav__link">
    build()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#threebrainpy.core.brain.Brain.clean_electrodes" class="md-nav__link">
    clean_electrodes()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#threebrainpy.core.brain.Brain.ensure_group" class="md-nav__link">
    ensure_group()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#threebrainpy.core.brain.Brain.get_electrode_colormap" class="md-nav__link">
    get_electrode_colormap()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#threebrainpy.core.brain.Brain.get_electrode_contact" class="md-nav__link">
    get_electrode_contact()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#threebrainpy.core.brain.Brain.get_geometry" class="md-nav__link">
    get_geometry()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#threebrainpy.core.brain.Brain.get_global_data" class="md-nav__link">
    get_global_data()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#threebrainpy.core.brain.Brain.get_group" class="md-nav__link">
    get_group()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#threebrainpy.core.brain.Brain.get_slice" class="md-nav__link">
    get_slice()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#threebrainpy.core.brain.Brain.get_slices" class="md-nav__link">
    get_slices()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#threebrainpy.core.brain.Brain.get_surfaces" class="md-nav__link">
    get_surfaces()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#threebrainpy.core.brain.Brain.get_transform" class="md-nav__link">
    get_transform()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#threebrainpy.core.brain.Brain.has_geometry" class="md-nav__link">
    has_geometry()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#threebrainpy.core.brain.Brain.has_group" class="md-nav__link">
    has_group()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#threebrainpy.core.brain.Brain.has_slice" class="md-nav__link">
    has_slice()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#threebrainpy.core.brain.Brain.has_surface_type" class="md-nav__link">
    has_surface_type()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#threebrainpy.core.brain.Brain.render" class="md-nav__link">
    render()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#threebrainpy.core.brain.Brain.set_electrode_keyframe" class="md-nav__link">
    set_electrode_keyframe()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#threebrainpy.core.brain.Brain.set_electrode_value" class="md-nav__link">
    set_electrode_value()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#threebrainpy.core.brain.Brain.set_electrode_values" class="md-nav__link">
    set_electrode_values()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#threebrainpy.core.brain.Brain.set_group_data" class="md-nav__link">
    set_group_data()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#threebrainpy.core.brain.Brain.set_transform_space" class="md-nav__link">
    set_transform_space()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#threebrainpy.core.brain.Brain.to_dict" class="md-nav__link">
    to_dict()
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../api-core-vec3/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    <code>&lt;Class Vec3&gt;</code>
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../api-core-mat44/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    <code>&lt;Class Mat44&gt;</code>
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../api-utils/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Module utils
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#threebrainpy.core.brain.Brain" class="md-nav__link">
    Brain
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#threebrainpy.core.brain.Brain.electrode_contacts" class="md-nav__link">
    electrode_contacts
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#threebrainpy.core.brain.Brain.path" class="md-nav__link">
    path
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#threebrainpy.core.brain.Brain.path_mri" class="md-nav__link">
    path_mri
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#threebrainpy.core.brain.Brain.path_surf" class="md-nav__link">
    path_surf
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#threebrainpy.core.brain.Brain.ras2mni_152" class="md-nav__link">
    ras2mni_152
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#threebrainpy.core.brain.Brain.ras2mni_305" class="md-nav__link">
    ras2mni_305
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#threebrainpy.core.brain.Brain.ras2ras_tkr" class="md-nav__link">
    ras2ras_tkr
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#threebrainpy.core.brain.Brain.ras_tkr2mni_152" class="md-nav__link">
    ras_tkr2mni_152
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#threebrainpy.core.brain.Brain.ras_tkr2mni_305" class="md-nav__link">
    ras_tkr2mni_305
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#threebrainpy.core.brain.Brain.storage" class="md-nav__link">
    storage
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#threebrainpy.core.brain.Brain.subject_code" class="md-nav__link">
    subject_code
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#threebrainpy.core.brain.Brain.vox2ras" class="md-nav__link">
    vox2ras
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#threebrainpy.core.brain.Brain.vox2ras_tkr" class="md-nav__link">
    vox2ras_tkr
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#threebrainpy.core.brain.Brain.__init__" class="md-nav__link">
    __init__()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#threebrainpy.core.brain.Brain.add_electrode_contact" class="md-nav__link">
    add_electrode_contact()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#threebrainpy.core.brain.Brain.add_electrodes" class="md-nav__link">
    add_electrodes()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#threebrainpy.core.brain.Brain.add_global_data" class="md-nav__link">
    add_global_data()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#threebrainpy.core.brain.Brain.add_group" class="md-nav__link">
    add_group()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#threebrainpy.core.brain.Brain.add_slice" class="md-nav__link">
    add_slice()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#threebrainpy.core.brain.Brain.add_surfaces" class="md-nav__link">
    add_surfaces()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#threebrainpy.core.brain.Brain.add_volume" class="md-nav__link">
    add_volume()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#threebrainpy.core.brain.Brain.build" class="md-nav__link">
    build()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#threebrainpy.core.brain.Brain.clean_electrodes" class="md-nav__link">
    clean_electrodes()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#threebrainpy.core.brain.Brain.ensure_group" class="md-nav__link">
    ensure_group()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#threebrainpy.core.brain.Brain.get_electrode_colormap" class="md-nav__link">
    get_electrode_colormap()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#threebrainpy.core.brain.Brain.get_electrode_contact" class="md-nav__link">
    get_electrode_contact()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#threebrainpy.core.brain.Brain.get_geometry" class="md-nav__link">
    get_geometry()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#threebrainpy.core.brain.Brain.get_global_data" class="md-nav__link">
    get_global_data()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#threebrainpy.core.brain.Brain.get_group" class="md-nav__link">
    get_group()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#threebrainpy.core.brain.Brain.get_slice" class="md-nav__link">
    get_slice()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#threebrainpy.core.brain.Brain.get_slices" class="md-nav__link">
    get_slices()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#threebrainpy.core.brain.Brain.get_surfaces" class="md-nav__link">
    get_surfaces()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#threebrainpy.core.brain.Brain.get_transform" class="md-nav__link">
    get_transform()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#threebrainpy.core.brain.Brain.has_geometry" class="md-nav__link">
    has_geometry()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#threebrainpy.core.brain.Brain.has_group" class="md-nav__link">
    has_group()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#threebrainpy.core.brain.Brain.has_slice" class="md-nav__link">
    has_slice()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#threebrainpy.core.brain.Brain.has_surface_type" class="md-nav__link">
    has_surface_type()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#threebrainpy.core.brain.Brain.render" class="md-nav__link">
    render()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#threebrainpy.core.brain.Brain.set_electrode_keyframe" class="md-nav__link">
    set_electrode_keyframe()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#threebrainpy.core.brain.Brain.set_electrode_value" class="md-nav__link">
    set_electrode_value()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#threebrainpy.core.brain.Brain.set_electrode_values" class="md-nav__link">
    set_electrode_values()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#threebrainpy.core.brain.Brain.set_group_data" class="md-nav__link">
    set_group_data()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#threebrainpy.core.brain.Brain.set_transform_space" class="md-nav__link">
    set_transform_space()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#threebrainpy.core.brain.Brain.to_dict" class="md-nav__link">
    to_dict()
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  

  
  


  <h1><code>&lt;Class Brain&gt;</code></h1>

<p><code>Brain</code> is a high-level class that provides almost all the core features of <code>threebrainpy</code>.</p>
<p>To import the <code>Brain</code> class, use the following command:</p>
<pre><code class="language-python">from threebrainpy.core import Brain
</code></pre>


<div class="doc doc-object doc-class">



<a id="threebrainpy.core.brain.Brain"></a>
  <div class="doc doc-contents first">
          <p class="doc doc-class-bases">
            Bases: <code>object</code></p>

  
      <p>Class definition for storing brain data and rendering information.</p>



<p><strong>Examples:</strong></p>
    <p>This example loads <code>fsaverage</code> brain from FreeSurfer (if you have installed) and renders it.</p>
    <div class="highlight"><pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">os</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">threebrainpy.core</span> <span class="kn">import</span> <span class="n">Brain</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">fs_home</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;FREESURFER_HOME&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">if</span> <span class="n">fs_home</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="n">brain</span> <span class="o">=</span> <span class="n">Brain</span><span class="p">(</span><span class="s2">&quot;fsaverage&quot;</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">fs_home</span><span class="p">,</span> <span class="s2">&quot;subjects&quot;</span><span class="p">,</span> <span class="s2">&quot;fsaverage&quot;</span><span class="p">))</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="nb">print</span><span class="p">(</span><span class="n">brain</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="n">brain</span><span class="o">.</span><span class="n">build</span><span class="p">()</span>
</code></pre></div>

            <details class="quote">
              <summary>Source code in <code>threebrainpy/core/brain.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">  29</span>
<span class="normal">  30</span>
<span class="normal">  31</span>
<span class="normal">  32</span>
<span class="normal">  33</span>
<span class="normal">  34</span>
<span class="normal">  35</span>
<span class="normal">  36</span>
<span class="normal">  37</span>
<span class="normal">  38</span>
<span class="normal">  39</span>
<span class="normal">  40</span>
<span class="normal">  41</span>
<span class="normal">  42</span>
<span class="normal">  43</span>
<span class="normal">  44</span>
<span class="normal">  45</span>
<span class="normal">  46</span>
<span class="normal">  47</span>
<span class="normal">  48</span>
<span class="normal">  49</span>
<span class="normal">  50</span>
<span class="normal">  51</span>
<span class="normal">  52</span>
<span class="normal">  53</span>
<span class="normal">  54</span>
<span class="normal">  55</span>
<span class="normal">  56</span>
<span class="normal">  57</span>
<span class="normal">  58</span>
<span class="normal">  59</span>
<span class="normal">  60</span>
<span class="normal">  61</span>
<span class="normal">  62</span>
<span class="normal">  63</span>
<span class="normal">  64</span>
<span class="normal">  65</span>
<span class="normal">  66</span>
<span class="normal">  67</span>
<span class="normal">  68</span>
<span class="normal">  69</span>
<span class="normal">  70</span>
<span class="normal">  71</span>
<span class="normal">  72</span>
<span class="normal">  73</span>
<span class="normal">  74</span>
<span class="normal">  75</span>
<span class="normal">  76</span>
<span class="normal">  77</span>
<span class="normal">  78</span>
<span class="normal">  79</span>
<span class="normal">  80</span>
<span class="normal">  81</span>
<span class="normal">  82</span>
<span class="normal">  83</span>
<span class="normal">  84</span>
<span class="normal">  85</span>
<span class="normal">  86</span>
<span class="normal">  87</span>
<span class="normal">  88</span>
<span class="normal">  89</span>
<span class="normal">  90</span>
<span class="normal">  91</span>
<span class="normal">  92</span>
<span class="normal">  93</span>
<span class="normal">  94</span>
<span class="normal">  95</span>
<span class="normal">  96</span>
<span class="normal">  97</span>
<span class="normal">  98</span>
<span class="normal">  99</span>
<span class="normal"> 100</span>
<span class="normal"> 101</span>
<span class="normal"> 102</span>
<span class="normal"> 103</span>
<span class="normal"> 104</span>
<span class="normal"> 105</span>
<span class="normal"> 106</span>
<span class="normal"> 107</span>
<span class="normal"> 108</span>
<span class="normal"> 109</span>
<span class="normal"> 110</span>
<span class="normal"> 111</span>
<span class="normal"> 112</span>
<span class="normal"> 113</span>
<span class="normal"> 114</span>
<span class="normal"> 115</span>
<span class="normal"> 116</span>
<span class="normal"> 117</span>
<span class="normal"> 118</span>
<span class="normal"> 119</span>
<span class="normal"> 120</span>
<span class="normal"> 121</span>
<span class="normal"> 122</span>
<span class="normal"> 123</span>
<span class="normal"> 124</span>
<span class="normal"> 125</span>
<span class="normal"> 126</span>
<span class="normal"> 127</span>
<span class="normal"> 128</span>
<span class="normal"> 129</span>
<span class="normal"> 130</span>
<span class="normal"> 131</span>
<span class="normal"> 132</span>
<span class="normal"> 133</span>
<span class="normal"> 134</span>
<span class="normal"> 135</span>
<span class="normal"> 136</span>
<span class="normal"> 137</span>
<span class="normal"> 138</span>
<span class="normal"> 139</span>
<span class="normal"> 140</span>
<span class="normal"> 141</span>
<span class="normal"> 142</span>
<span class="normal"> 143</span>
<span class="normal"> 144</span>
<span class="normal"> 145</span>
<span class="normal"> 146</span>
<span class="normal"> 147</span>
<span class="normal"> 148</span>
<span class="normal"> 149</span>
<span class="normal"> 150</span>
<span class="normal"> 151</span>
<span class="normal"> 152</span>
<span class="normal"> 153</span>
<span class="normal"> 154</span>
<span class="normal"> 155</span>
<span class="normal"> 156</span>
<span class="normal"> 157</span>
<span class="normal"> 158</span>
<span class="normal"> 159</span>
<span class="normal"> 160</span>
<span class="normal"> 161</span>
<span class="normal"> 162</span>
<span class="normal"> 163</span>
<span class="normal"> 164</span>
<span class="normal"> 165</span>
<span class="normal"> 166</span>
<span class="normal"> 167</span>
<span class="normal"> 168</span>
<span class="normal"> 169</span>
<span class="normal"> 170</span>
<span class="normal"> 171</span>
<span class="normal"> 172</span>
<span class="normal"> 173</span>
<span class="normal"> 174</span>
<span class="normal"> 175</span>
<span class="normal"> 176</span>
<span class="normal"> 177</span>
<span class="normal"> 178</span>
<span class="normal"> 179</span>
<span class="normal"> 180</span>
<span class="normal"> 181</span>
<span class="normal"> 182</span>
<span class="normal"> 183</span>
<span class="normal"> 184</span>
<span class="normal"> 185</span>
<span class="normal"> 186</span>
<span class="normal"> 187</span>
<span class="normal"> 188</span>
<span class="normal"> 189</span>
<span class="normal"> 190</span>
<span class="normal"> 191</span>
<span class="normal"> 192</span>
<span class="normal"> 193</span>
<span class="normal"> 194</span>
<span class="normal"> 195</span>
<span class="normal"> 196</span>
<span class="normal"> 197</span>
<span class="normal"> 198</span>
<span class="normal"> 199</span>
<span class="normal"> 200</span>
<span class="normal"> 201</span>
<span class="normal"> 202</span>
<span class="normal"> 203</span>
<span class="normal"> 204</span>
<span class="normal"> 205</span>
<span class="normal"> 206</span>
<span class="normal"> 207</span>
<span class="normal"> 208</span>
<span class="normal"> 209</span>
<span class="normal"> 210</span>
<span class="normal"> 211</span>
<span class="normal"> 212</span>
<span class="normal"> 213</span>
<span class="normal"> 214</span>
<span class="normal"> 215</span>
<span class="normal"> 216</span>
<span class="normal"> 217</span>
<span class="normal"> 218</span>
<span class="normal"> 219</span>
<span class="normal"> 220</span>
<span class="normal"> 221</span>
<span class="normal"> 222</span>
<span class="normal"> 223</span>
<span class="normal"> 224</span>
<span class="normal"> 225</span>
<span class="normal"> 226</span>
<span class="normal"> 227</span>
<span class="normal"> 228</span>
<span class="normal"> 229</span>
<span class="normal"> 230</span>
<span class="normal"> 231</span>
<span class="normal"> 232</span>
<span class="normal"> 233</span>
<span class="normal"> 234</span>
<span class="normal"> 235</span>
<span class="normal"> 236</span>
<span class="normal"> 237</span>
<span class="normal"> 238</span>
<span class="normal"> 239</span>
<span class="normal"> 240</span>
<span class="normal"> 241</span>
<span class="normal"> 242</span>
<span class="normal"> 243</span>
<span class="normal"> 244</span>
<span class="normal"> 245</span>
<span class="normal"> 246</span>
<span class="normal"> 247</span>
<span class="normal"> 248</span>
<span class="normal"> 249</span>
<span class="normal"> 250</span>
<span class="normal"> 251</span>
<span class="normal"> 252</span>
<span class="normal"> 253</span>
<span class="normal"> 254</span>
<span class="normal"> 255</span>
<span class="normal"> 256</span>
<span class="normal"> 257</span>
<span class="normal"> 258</span>
<span class="normal"> 259</span>
<span class="normal"> 260</span>
<span class="normal"> 261</span>
<span class="normal"> 262</span>
<span class="normal"> 263</span>
<span class="normal"> 264</span>
<span class="normal"> 265</span>
<span class="normal"> 266</span>
<span class="normal"> 267</span>
<span class="normal"> 268</span>
<span class="normal"> 269</span>
<span class="normal"> 270</span>
<span class="normal"> 271</span>
<span class="normal"> 272</span>
<span class="normal"> 273</span>
<span class="normal"> 274</span>
<span class="normal"> 275</span>
<span class="normal"> 276</span>
<span class="normal"> 277</span>
<span class="normal"> 278</span>
<span class="normal"> 279</span>
<span class="normal"> 280</span>
<span class="normal"> 281</span>
<span class="normal"> 282</span>
<span class="normal"> 283</span>
<span class="normal"> 284</span>
<span class="normal"> 285</span>
<span class="normal"> 286</span>
<span class="normal"> 287</span>
<span class="normal"> 288</span>
<span class="normal"> 289</span>
<span class="normal"> 290</span>
<span class="normal"> 291</span>
<span class="normal"> 292</span>
<span class="normal"> 293</span>
<span class="normal"> 294</span>
<span class="normal"> 295</span>
<span class="normal"> 296</span>
<span class="normal"> 297</span>
<span class="normal"> 298</span>
<span class="normal"> 299</span>
<span class="normal"> 300</span>
<span class="normal"> 301</span>
<span class="normal"> 302</span>
<span class="normal"> 303</span>
<span class="normal"> 304</span>
<span class="normal"> 305</span>
<span class="normal"> 306</span>
<span class="normal"> 307</span>
<span class="normal"> 308</span>
<span class="normal"> 309</span>
<span class="normal"> 310</span>
<span class="normal"> 311</span>
<span class="normal"> 312</span>
<span class="normal"> 313</span>
<span class="normal"> 314</span>
<span class="normal"> 315</span>
<span class="normal"> 316</span>
<span class="normal"> 317</span>
<span class="normal"> 318</span>
<span class="normal"> 319</span>
<span class="normal"> 320</span>
<span class="normal"> 321</span>
<span class="normal"> 322</span>
<span class="normal"> 323</span>
<span class="normal"> 324</span>
<span class="normal"> 325</span>
<span class="normal"> 326</span>
<span class="normal"> 327</span>
<span class="normal"> 328</span>
<span class="normal"> 329</span>
<span class="normal"> 330</span>
<span class="normal"> 331</span>
<span class="normal"> 332</span>
<span class="normal"> 333</span>
<span class="normal"> 334</span>
<span class="normal"> 335</span>
<span class="normal"> 336</span>
<span class="normal"> 337</span>
<span class="normal"> 338</span>
<span class="normal"> 339</span>
<span class="normal"> 340</span>
<span class="normal"> 341</span>
<span class="normal"> 342</span>
<span class="normal"> 343</span>
<span class="normal"> 344</span>
<span class="normal"> 345</span>
<span class="normal"> 346</span>
<span class="normal"> 347</span>
<span class="normal"> 348</span>
<span class="normal"> 349</span>
<span class="normal"> 350</span>
<span class="normal"> 351</span>
<span class="normal"> 352</span>
<span class="normal"> 353</span>
<span class="normal"> 354</span>
<span class="normal"> 355</span>
<span class="normal"> 356</span>
<span class="normal"> 357</span>
<span class="normal"> 358</span>
<span class="normal"> 359</span>
<span class="normal"> 360</span>
<span class="normal"> 361</span>
<span class="normal"> 362</span>
<span class="normal"> 363</span>
<span class="normal"> 364</span>
<span class="normal"> 365</span>
<span class="normal"> 366</span>
<span class="normal"> 367</span>
<span class="normal"> 368</span>
<span class="normal"> 369</span>
<span class="normal"> 370</span>
<span class="normal"> 371</span>
<span class="normal"> 372</span>
<span class="normal"> 373</span>
<span class="normal"> 374</span>
<span class="normal"> 375</span>
<span class="normal"> 376</span>
<span class="normal"> 377</span>
<span class="normal"> 378</span>
<span class="normal"> 379</span>
<span class="normal"> 380</span>
<span class="normal"> 381</span>
<span class="normal"> 382</span>
<span class="normal"> 383</span>
<span class="normal"> 384</span>
<span class="normal"> 385</span>
<span class="normal"> 386</span>
<span class="normal"> 387</span>
<span class="normal"> 388</span>
<span class="normal"> 389</span>
<span class="normal"> 390</span>
<span class="normal"> 391</span>
<span class="normal"> 392</span>
<span class="normal"> 393</span>
<span class="normal"> 394</span>
<span class="normal"> 395</span>
<span class="normal"> 396</span>
<span class="normal"> 397</span>
<span class="normal"> 398</span>
<span class="normal"> 399</span>
<span class="normal"> 400</span>
<span class="normal"> 401</span>
<span class="normal"> 402</span>
<span class="normal"> 403</span>
<span class="normal"> 404</span>
<span class="normal"> 405</span>
<span class="normal"> 406</span>
<span class="normal"> 407</span>
<span class="normal"> 408</span>
<span class="normal"> 409</span>
<span class="normal"> 410</span>
<span class="normal"> 411</span>
<span class="normal"> 412</span>
<span class="normal"> 413</span>
<span class="normal"> 414</span>
<span class="normal"> 415</span>
<span class="normal"> 416</span>
<span class="normal"> 417</span>
<span class="normal"> 418</span>
<span class="normal"> 419</span>
<span class="normal"> 420</span>
<span class="normal"> 421</span>
<span class="normal"> 422</span>
<span class="normal"> 423</span>
<span class="normal"> 424</span>
<span class="normal"> 425</span>
<span class="normal"> 426</span>
<span class="normal"> 427</span>
<span class="normal"> 428</span>
<span class="normal"> 429</span>
<span class="normal"> 430</span>
<span class="normal"> 431</span>
<span class="normal"> 432</span>
<span class="normal"> 433</span>
<span class="normal"> 434</span>
<span class="normal"> 435</span>
<span class="normal"> 436</span>
<span class="normal"> 437</span>
<span class="normal"> 438</span>
<span class="normal"> 439</span>
<span class="normal"> 440</span>
<span class="normal"> 441</span>
<span class="normal"> 442</span>
<span class="normal"> 443</span>
<span class="normal"> 444</span>
<span class="normal"> 445</span>
<span class="normal"> 446</span>
<span class="normal"> 447</span>
<span class="normal"> 448</span>
<span class="normal"> 449</span>
<span class="normal"> 450</span>
<span class="normal"> 451</span>
<span class="normal"> 452</span>
<span class="normal"> 453</span>
<span class="normal"> 454</span>
<span class="normal"> 455</span>
<span class="normal"> 456</span>
<span class="normal"> 457</span>
<span class="normal"> 458</span>
<span class="normal"> 459</span>
<span class="normal"> 460</span>
<span class="normal"> 461</span>
<span class="normal"> 462</span>
<span class="normal"> 463</span>
<span class="normal"> 464</span>
<span class="normal"> 465</span>
<span class="normal"> 466</span>
<span class="normal"> 467</span>
<span class="normal"> 468</span>
<span class="normal"> 469</span>
<span class="normal"> 470</span>
<span class="normal"> 471</span>
<span class="normal"> 472</span>
<span class="normal"> 473</span>
<span class="normal"> 474</span>
<span class="normal"> 475</span>
<span class="normal"> 476</span>
<span class="normal"> 477</span>
<span class="normal"> 478</span>
<span class="normal"> 479</span>
<span class="normal"> 480</span>
<span class="normal"> 481</span>
<span class="normal"> 482</span>
<span class="normal"> 483</span>
<span class="normal"> 484</span>
<span class="normal"> 485</span>
<span class="normal"> 486</span>
<span class="normal"> 487</span>
<span class="normal"> 488</span>
<span class="normal"> 489</span>
<span class="normal"> 490</span>
<span class="normal"> 491</span>
<span class="normal"> 492</span>
<span class="normal"> 493</span>
<span class="normal"> 494</span>
<span class="normal"> 495</span>
<span class="normal"> 496</span>
<span class="normal"> 497</span>
<span class="normal"> 498</span>
<span class="normal"> 499</span>
<span class="normal"> 500</span>
<span class="normal"> 501</span>
<span class="normal"> 502</span>
<span class="normal"> 503</span>
<span class="normal"> 504</span>
<span class="normal"> 505</span>
<span class="normal"> 506</span>
<span class="normal"> 507</span>
<span class="normal"> 508</span>
<span class="normal"> 509</span>
<span class="normal"> 510</span>
<span class="normal"> 511</span>
<span class="normal"> 512</span>
<span class="normal"> 513</span>
<span class="normal"> 514</span>
<span class="normal"> 515</span>
<span class="normal"> 516</span>
<span class="normal"> 517</span>
<span class="normal"> 518</span>
<span class="normal"> 519</span>
<span class="normal"> 520</span>
<span class="normal"> 521</span>
<span class="normal"> 522</span>
<span class="normal"> 523</span>
<span class="normal"> 524</span>
<span class="normal"> 525</span>
<span class="normal"> 526</span>
<span class="normal"> 527</span>
<span class="normal"> 528</span>
<span class="normal"> 529</span>
<span class="normal"> 530</span>
<span class="normal"> 531</span>
<span class="normal"> 532</span>
<span class="normal"> 533</span>
<span class="normal"> 534</span>
<span class="normal"> 535</span>
<span class="normal"> 536</span>
<span class="normal"> 537</span>
<span class="normal"> 538</span>
<span class="normal"> 539</span>
<span class="normal"> 540</span>
<span class="normal"> 541</span>
<span class="normal"> 542</span>
<span class="normal"> 543</span>
<span class="normal"> 544</span>
<span class="normal"> 545</span>
<span class="normal"> 546</span>
<span class="normal"> 547</span>
<span class="normal"> 548</span>
<span class="normal"> 549</span>
<span class="normal"> 550</span>
<span class="normal"> 551</span>
<span class="normal"> 552</span>
<span class="normal"> 553</span>
<span class="normal"> 554</span>
<span class="normal"> 555</span>
<span class="normal"> 556</span>
<span class="normal"> 557</span>
<span class="normal"> 558</span>
<span class="normal"> 559</span>
<span class="normal"> 560</span>
<span class="normal"> 561</span>
<span class="normal"> 562</span>
<span class="normal"> 563</span>
<span class="normal"> 564</span>
<span class="normal"> 565</span>
<span class="normal"> 566</span>
<span class="normal"> 567</span>
<span class="normal"> 568</span>
<span class="normal"> 569</span>
<span class="normal"> 570</span>
<span class="normal"> 571</span>
<span class="normal"> 572</span>
<span class="normal"> 573</span>
<span class="normal"> 574</span>
<span class="normal"> 575</span>
<span class="normal"> 576</span>
<span class="normal"> 577</span>
<span class="normal"> 578</span>
<span class="normal"> 579</span>
<span class="normal"> 580</span>
<span class="normal"> 581</span>
<span class="normal"> 582</span>
<span class="normal"> 583</span>
<span class="normal"> 584</span>
<span class="normal"> 585</span>
<span class="normal"> 586</span>
<span class="normal"> 587</span>
<span class="normal"> 588</span>
<span class="normal"> 589</span>
<span class="normal"> 590</span>
<span class="normal"> 591</span>
<span class="normal"> 592</span>
<span class="normal"> 593</span>
<span class="normal"> 594</span>
<span class="normal"> 595</span>
<span class="normal"> 596</span>
<span class="normal"> 597</span>
<span class="normal"> 598</span>
<span class="normal"> 599</span>
<span class="normal"> 600</span>
<span class="normal"> 601</span>
<span class="normal"> 602</span>
<span class="normal"> 603</span>
<span class="normal"> 604</span>
<span class="normal"> 605</span>
<span class="normal"> 606</span>
<span class="normal"> 607</span>
<span class="normal"> 608</span>
<span class="normal"> 609</span>
<span class="normal"> 610</span>
<span class="normal"> 611</span>
<span class="normal"> 612</span>
<span class="normal"> 613</span>
<span class="normal"> 614</span>
<span class="normal"> 615</span>
<span class="normal"> 616</span>
<span class="normal"> 617</span>
<span class="normal"> 618</span>
<span class="normal"> 619</span>
<span class="normal"> 620</span>
<span class="normal"> 621</span>
<span class="normal"> 622</span>
<span class="normal"> 623</span>
<span class="normal"> 624</span>
<span class="normal"> 625</span>
<span class="normal"> 626</span>
<span class="normal"> 627</span>
<span class="normal"> 628</span>
<span class="normal"> 629</span>
<span class="normal"> 630</span>
<span class="normal"> 631</span>
<span class="normal"> 632</span>
<span class="normal"> 633</span>
<span class="normal"> 634</span>
<span class="normal"> 635</span>
<span class="normal"> 636</span>
<span class="normal"> 637</span>
<span class="normal"> 638</span>
<span class="normal"> 639</span>
<span class="normal"> 640</span>
<span class="normal"> 641</span>
<span class="normal"> 642</span>
<span class="normal"> 643</span>
<span class="normal"> 644</span>
<span class="normal"> 645</span>
<span class="normal"> 646</span>
<span class="normal"> 647</span>
<span class="normal"> 648</span>
<span class="normal"> 649</span>
<span class="normal"> 650</span>
<span class="normal"> 651</span>
<span class="normal"> 652</span>
<span class="normal"> 653</span>
<span class="normal"> 654</span>
<span class="normal"> 655</span>
<span class="normal"> 656</span>
<span class="normal"> 657</span>
<span class="normal"> 658</span>
<span class="normal"> 659</span>
<span class="normal"> 660</span>
<span class="normal"> 661</span>
<span class="normal"> 662</span>
<span class="normal"> 663</span>
<span class="normal"> 664</span>
<span class="normal"> 665</span>
<span class="normal"> 666</span>
<span class="normal"> 667</span>
<span class="normal"> 668</span>
<span class="normal"> 669</span>
<span class="normal"> 670</span>
<span class="normal"> 671</span>
<span class="normal"> 672</span>
<span class="normal"> 673</span>
<span class="normal"> 674</span>
<span class="normal"> 675</span>
<span class="normal"> 676</span>
<span class="normal"> 677</span>
<span class="normal"> 678</span>
<span class="normal"> 679</span>
<span class="normal"> 680</span>
<span class="normal"> 681</span>
<span class="normal"> 682</span>
<span class="normal"> 683</span>
<span class="normal"> 684</span>
<span class="normal"> 685</span>
<span class="normal"> 686</span>
<span class="normal"> 687</span>
<span class="normal"> 688</span>
<span class="normal"> 689</span>
<span class="normal"> 690</span>
<span class="normal"> 691</span>
<span class="normal"> 692</span>
<span class="normal"> 693</span>
<span class="normal"> 694</span>
<span class="normal"> 695</span>
<span class="normal"> 696</span>
<span class="normal"> 697</span>
<span class="normal"> 698</span>
<span class="normal"> 699</span>
<span class="normal"> 700</span>
<span class="normal"> 701</span>
<span class="normal"> 702</span>
<span class="normal"> 703</span>
<span class="normal"> 704</span>
<span class="normal"> 705</span>
<span class="normal"> 706</span>
<span class="normal"> 707</span>
<span class="normal"> 708</span>
<span class="normal"> 709</span>
<span class="normal"> 710</span>
<span class="normal"> 711</span>
<span class="normal"> 712</span>
<span class="normal"> 713</span>
<span class="normal"> 714</span>
<span class="normal"> 715</span>
<span class="normal"> 716</span>
<span class="normal"> 717</span>
<span class="normal"> 718</span>
<span class="normal"> 719</span>
<span class="normal"> 720</span>
<span class="normal"> 721</span>
<span class="normal"> 722</span>
<span class="normal"> 723</span>
<span class="normal"> 724</span>
<span class="normal"> 725</span>
<span class="normal"> 726</span>
<span class="normal"> 727</span>
<span class="normal"> 728</span>
<span class="normal"> 729</span>
<span class="normal"> 730</span>
<span class="normal"> 731</span>
<span class="normal"> 732</span>
<span class="normal"> 733</span>
<span class="normal"> 734</span>
<span class="normal"> 735</span>
<span class="normal"> 736</span>
<span class="normal"> 737</span>
<span class="normal"> 738</span>
<span class="normal"> 739</span>
<span class="normal"> 740</span>
<span class="normal"> 741</span>
<span class="normal"> 742</span>
<span class="normal"> 743</span>
<span class="normal"> 744</span>
<span class="normal"> 745</span>
<span class="normal"> 746</span>
<span class="normal"> 747</span>
<span class="normal"> 748</span>
<span class="normal"> 749</span>
<span class="normal"> 750</span>
<span class="normal"> 751</span>
<span class="normal"> 752</span>
<span class="normal"> 753</span>
<span class="normal"> 754</span>
<span class="normal"> 755</span>
<span class="normal"> 756</span>
<span class="normal"> 757</span>
<span class="normal"> 758</span>
<span class="normal"> 759</span>
<span class="normal"> 760</span>
<span class="normal"> 761</span>
<span class="normal"> 762</span>
<span class="normal"> 763</span>
<span class="normal"> 764</span>
<span class="normal"> 765</span>
<span class="normal"> 766</span>
<span class="normal"> 767</span>
<span class="normal"> 768</span>
<span class="normal"> 769</span>
<span class="normal"> 770</span>
<span class="normal"> 771</span>
<span class="normal"> 772</span>
<span class="normal"> 773</span>
<span class="normal"> 774</span>
<span class="normal"> 775</span>
<span class="normal"> 776</span>
<span class="normal"> 777</span>
<span class="normal"> 778</span>
<span class="normal"> 779</span>
<span class="normal"> 780</span>
<span class="normal"> 781</span>
<span class="normal"> 782</span>
<span class="normal"> 783</span>
<span class="normal"> 784</span>
<span class="normal"> 785</span>
<span class="normal"> 786</span>
<span class="normal"> 787</span>
<span class="normal"> 788</span>
<span class="normal"> 789</span>
<span class="normal"> 790</span>
<span class="normal"> 791</span>
<span class="normal"> 792</span>
<span class="normal"> 793</span>
<span class="normal"> 794</span>
<span class="normal"> 795</span>
<span class="normal"> 796</span>
<span class="normal"> 797</span>
<span class="normal"> 798</span>
<span class="normal"> 799</span>
<span class="normal"> 800</span>
<span class="normal"> 801</span>
<span class="normal"> 802</span>
<span class="normal"> 803</span>
<span class="normal"> 804</span>
<span class="normal"> 805</span>
<span class="normal"> 806</span>
<span class="normal"> 807</span>
<span class="normal"> 808</span>
<span class="normal"> 809</span>
<span class="normal"> 810</span>
<span class="normal"> 811</span>
<span class="normal"> 812</span>
<span class="normal"> 813</span>
<span class="normal"> 814</span>
<span class="normal"> 815</span>
<span class="normal"> 816</span>
<span class="normal"> 817</span>
<span class="normal"> 818</span>
<span class="normal"> 819</span>
<span class="normal"> 820</span>
<span class="normal"> 821</span>
<span class="normal"> 822</span>
<span class="normal"> 823</span>
<span class="normal"> 824</span>
<span class="normal"> 825</span>
<span class="normal"> 826</span>
<span class="normal"> 827</span>
<span class="normal"> 828</span>
<span class="normal"> 829</span>
<span class="normal"> 830</span>
<span class="normal"> 831</span>
<span class="normal"> 832</span>
<span class="normal"> 833</span>
<span class="normal"> 834</span>
<span class="normal"> 835</span>
<span class="normal"> 836</span>
<span class="normal"> 837</span>
<span class="normal"> 838</span>
<span class="normal"> 839</span>
<span class="normal"> 840</span>
<span class="normal"> 841</span>
<span class="normal"> 842</span>
<span class="normal"> 843</span>
<span class="normal"> 844</span>
<span class="normal"> 845</span>
<span class="normal"> 846</span>
<span class="normal"> 847</span>
<span class="normal"> 848</span>
<span class="normal"> 849</span>
<span class="normal"> 850</span>
<span class="normal"> 851</span>
<span class="normal"> 852</span>
<span class="normal"> 853</span>
<span class="normal"> 854</span>
<span class="normal"> 855</span>
<span class="normal"> 856</span>
<span class="normal"> 857</span>
<span class="normal"> 858</span>
<span class="normal"> 859</span>
<span class="normal"> 860</span>
<span class="normal"> 861</span>
<span class="normal"> 862</span>
<span class="normal"> 863</span>
<span class="normal"> 864</span>
<span class="normal"> 865</span>
<span class="normal"> 866</span>
<span class="normal"> 867</span>
<span class="normal"> 868</span>
<span class="normal"> 869</span>
<span class="normal"> 870</span>
<span class="normal"> 871</span>
<span class="normal"> 872</span>
<span class="normal"> 873</span>
<span class="normal"> 874</span>
<span class="normal"> 875</span>
<span class="normal"> 876</span>
<span class="normal"> 877</span>
<span class="normal"> 878</span>
<span class="normal"> 879</span>
<span class="normal"> 880</span>
<span class="normal"> 881</span>
<span class="normal"> 882</span>
<span class="normal"> 883</span>
<span class="normal"> 884</span>
<span class="normal"> 885</span>
<span class="normal"> 886</span>
<span class="normal"> 887</span>
<span class="normal"> 888</span>
<span class="normal"> 889</span>
<span class="normal"> 890</span>
<span class="normal"> 891</span>
<span class="normal"> 892</span>
<span class="normal"> 893</span>
<span class="normal"> 894</span>
<span class="normal"> 895</span>
<span class="normal"> 896</span>
<span class="normal"> 897</span>
<span class="normal"> 898</span>
<span class="normal"> 899</span>
<span class="normal"> 900</span>
<span class="normal"> 901</span>
<span class="normal"> 902</span>
<span class="normal"> 903</span>
<span class="normal"> 904</span>
<span class="normal"> 905</span>
<span class="normal"> 906</span>
<span class="normal"> 907</span>
<span class="normal"> 908</span>
<span class="normal"> 909</span>
<span class="normal"> 910</span>
<span class="normal"> 911</span>
<span class="normal"> 912</span>
<span class="normal"> 913</span>
<span class="normal"> 914</span>
<span class="normal"> 915</span>
<span class="normal"> 916</span>
<span class="normal"> 917</span>
<span class="normal"> 918</span>
<span class="normal"> 919</span>
<span class="normal"> 920</span>
<span class="normal"> 921</span>
<span class="normal"> 922</span>
<span class="normal"> 923</span>
<span class="normal"> 924</span>
<span class="normal"> 925</span>
<span class="normal"> 926</span>
<span class="normal"> 927</span>
<span class="normal"> 928</span>
<span class="normal"> 929</span>
<span class="normal"> 930</span>
<span class="normal"> 931</span>
<span class="normal"> 932</span>
<span class="normal"> 933</span>
<span class="normal"> 934</span>
<span class="normal"> 935</span>
<span class="normal"> 936</span>
<span class="normal"> 937</span>
<span class="normal"> 938</span>
<span class="normal"> 939</span>
<span class="normal"> 940</span>
<span class="normal"> 941</span>
<span class="normal"> 942</span>
<span class="normal"> 943</span>
<span class="normal"> 944</span>
<span class="normal"> 945</span>
<span class="normal"> 946</span>
<span class="normal"> 947</span>
<span class="normal"> 948</span>
<span class="normal"> 949</span>
<span class="normal"> 950</span>
<span class="normal"> 951</span>
<span class="normal"> 952</span>
<span class="normal"> 953</span>
<span class="normal"> 954</span>
<span class="normal"> 955</span>
<span class="normal"> 956</span>
<span class="normal"> 957</span>
<span class="normal"> 958</span>
<span class="normal"> 959</span>
<span class="normal"> 960</span>
<span class="normal"> 961</span>
<span class="normal"> 962</span>
<span class="normal"> 963</span>
<span class="normal"> 964</span>
<span class="normal"> 965</span>
<span class="normal"> 966</span>
<span class="normal"> 967</span>
<span class="normal"> 968</span>
<span class="normal"> 969</span>
<span class="normal"> 970</span>
<span class="normal"> 971</span>
<span class="normal"> 972</span>
<span class="normal"> 973</span>
<span class="normal"> 974</span>
<span class="normal"> 975</span>
<span class="normal"> 976</span>
<span class="normal"> 977</span>
<span class="normal"> 978</span>
<span class="normal"> 979</span>
<span class="normal"> 980</span>
<span class="normal"> 981</span>
<span class="normal"> 982</span>
<span class="normal"> 983</span>
<span class="normal"> 984</span>
<span class="normal"> 985</span>
<span class="normal"> 986</span>
<span class="normal"> 987</span>
<span class="normal"> 988</span>
<span class="normal"> 989</span>
<span class="normal"> 990</span>
<span class="normal"> 991</span>
<span class="normal"> 992</span>
<span class="normal"> 993</span>
<span class="normal"> 994</span>
<span class="normal"> 995</span>
<span class="normal"> 996</span>
<span class="normal"> 997</span>
<span class="normal"> 998</span>
<span class="normal"> 999</span>
<span class="normal">1000</span>
<span class="normal">1001</span>
<span class="normal">1002</span>
<span class="normal">1003</span>
<span class="normal">1004</span>
<span class="normal">1005</span>
<span class="normal">1006</span>
<span class="normal">1007</span>
<span class="normal">1008</span>
<span class="normal">1009</span>
<span class="normal">1010</span>
<span class="normal">1011</span>
<span class="normal">1012</span>
<span class="normal">1013</span>
<span class="normal">1014</span>
<span class="normal">1015</span>
<span class="normal">1016</span>
<span class="normal">1017</span>
<span class="normal">1018</span>
<span class="normal">1019</span>
<span class="normal">1020</span>
<span class="normal">1021</span>
<span class="normal">1022</span>
<span class="normal">1023</span>
<span class="normal">1024</span>
<span class="normal">1025</span>
<span class="normal">1026</span>
<span class="normal">1027</span>
<span class="normal">1028</span>
<span class="normal">1029</span>
<span class="normal">1030</span>
<span class="normal">1031</span>
<span class="normal">1032</span>
<span class="normal">1033</span>
<span class="normal">1034</span>
<span class="normal">1035</span>
<span class="normal">1036</span>
<span class="normal">1037</span>
<span class="normal">1038</span>
<span class="normal">1039</span>
<span class="normal">1040</span>
<span class="normal">1041</span>
<span class="normal">1042</span>
<span class="normal">1043</span>
<span class="normal">1044</span>
<span class="normal">1045</span>
<span class="normal">1046</span>
<span class="normal">1047</span>
<span class="normal">1048</span>
<span class="normal">1049</span>
<span class="normal">1050</span>
<span class="normal">1051</span>
<span class="normal">1052</span>
<span class="normal">1053</span>
<span class="normal">1054</span>
<span class="normal">1055</span>
<span class="normal">1056</span>
<span class="normal">1057</span>
<span class="normal">1058</span>
<span class="normal">1059</span>
<span class="normal">1060</span>
<span class="normal">1061</span>
<span class="normal">1062</span>
<span class="normal">1063</span>
<span class="normal">1064</span>
<span class="normal">1065</span>
<span class="normal">1066</span>
<span class="normal">1067</span>
<span class="normal">1068</span>
<span class="normal">1069</span>
<span class="normal">1070</span>
<span class="normal">1071</span>
<span class="normal">1072</span>
<span class="normal">1073</span>
<span class="normal">1074</span>
<span class="normal">1075</span>
<span class="normal">1076</span>
<span class="normal">1077</span>
<span class="normal">1078</span>
<span class="normal">1079</span>
<span class="normal">1080</span>
<span class="normal">1081</span>
<span class="normal">1082</span>
<span class="normal">1083</span>
<span class="normal">1084</span>
<span class="normal">1085</span>
<span class="normal">1086</span>
<span class="normal">1087</span>
<span class="normal">1088</span>
<span class="normal">1089</span>
<span class="normal">1090</span>
<span class="normal">1091</span>
<span class="normal">1092</span>
<span class="normal">1093</span>
<span class="normal">1094</span>
<span class="normal">1095</span>
<span class="normal">1096</span>
<span class="normal">1097</span>
<span class="normal">1098</span>
<span class="normal">1099</span>
<span class="normal">1100</span>
<span class="normal">1101</span>
<span class="normal">1102</span>
<span class="normal">1103</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">Brain</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Class definition for storing brain data and rendering information.</span>

<span class="sd">    Examples:</span>
<span class="sd">        This example loads `fsaverage` brain from FreeSurfer (if you have installed) and renders it.</span>

<span class="sd">        &gt;&gt;&gt; import os</span>
<span class="sd">        &gt;&gt;&gt; from threebrainpy.core import Brain</span>
<span class="sd">        &gt;&gt;&gt; fs_home = os.environ.get(&quot;FREESURFER_HOME&quot;, None)</span>
<span class="sd">        &gt;&gt;&gt; if fs_home is not None:</span>
<span class="sd">        &gt;&gt;&gt;     brain = Brain(&quot;fsaverage&quot;, os.path.join(fs_home, &quot;subjects&quot;, &quot;fsaverage&quot;))</span>
<span class="sd">        &gt;&gt;&gt;     print(brain)</span>
<span class="sd">        &gt;&gt;&gt;     brain.build()</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">def</span> <span class="nf">_update_matrices</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">volume_files</span> <span class="o">=</span> <span class="p">[],</span> <span class="n">update</span> <span class="o">=</span> <span class="mi">1</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Internal method to update voxel-to-ras and voxel-to-tkrRAS matrices.</span>
<span class="sd">        Args:</span>
<span class="sd">            volume_files: A list of volume files to be used to update the matrices.</span>
<span class="sd">                Each volume file must be a path to a volume file (nii, nii.gz, mgz).</span>
<span class="sd">            update: update policy, see below.</span>
<span class="sd">                - 0: do not update, but will initialize if not exists;</span>
<span class="sd">                - 1: update if there is a better one;</span>
<span class="sd">                - 2: force update.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">volume_files</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>
        <span class="k">for</span> <span class="n">volume_file</span> <span class="ow">in</span> <span class="n">volume_files</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">volume_file</span><span class="p">):</span>
                <span class="n">vox2ras_needs_update</span> <span class="o">=</span> <span class="n">update</span> <span class="o">&gt;=</span> <span class="mi">2</span>
                <span class="n">vox2ras_tkr_needs_update</span> <span class="o">=</span> <span class="n">update</span> <span class="o">&gt;=</span> <span class="mi">2</span>
                <span class="c1"># check if _vox2ras needs update</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_vox2ras</span><span class="p">,</span> <span class="n">Mat44</span><span class="p">):</span>
                    <span class="n">vox2ras_needs_update</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_vox2ras_tkr</span><span class="p">,</span> <span class="n">Mat44</span><span class="p">):</span>
                    <span class="n">vox2ras_tkr_needs_update</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="k">elif</span> <span class="n">update</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">_vox2ras_tkr</span><span class="o">.</span><span class="n">extra</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;source_format&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span> <span class="o">!=</span> <span class="s2">&quot;mgz&quot;</span> <span class="ow">and</span> <span class="n">volume_file</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot;.mgz&quot;</span><span class="p">):</span>
                    <span class="n">vox2ras_tkr_needs_update</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="k">if</span> <span class="n">vox2ras_needs_update</span> <span class="ow">or</span> <span class="n">vox2ras_tkr_needs_update</span><span class="p">:</span>
                    <span class="n">volume</span> <span class="o">=</span> <span class="n">VolumeWrapper</span><span class="p">(</span><span class="n">volume_file</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">vox2ras_needs_update</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">_vox2ras</span> <span class="o">=</span> <span class="n">volume</span><span class="o">.</span><span class="n">vox2ras</span>
                    <span class="k">if</span> <span class="n">vox2ras_tkr_needs_update</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">_vox2ras_tkr</span> <span class="o">=</span> <span class="n">volume</span><span class="o">.</span><span class="n">vox2ras_tkr</span>
                <span class="c1"># early stop</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">vox2ras_needs_update</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">vox2ras_tkr_needs_update</span> <span class="ow">and</span> <span class="n">update</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">:</span>
                    <span class="c1"># this means the matrices are all up-to-date and need no further update</span>
                    <span class="k">return</span> <span class="kc">None</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">subject_code</span> <span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">path</span> <span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">work_dir</span> <span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;Constructor for Brain.</span>
<span class="sd">        Args:</span>
<span class="sd">            subject_code: The subject code of the brain.</span>
<span class="sd">            path: The path to the FreeSurfer or FreeSurfer-like folder (with MRI stored at `mri` and surfaces at `surf`).</span>
<span class="sd">            work_dir: The path to the working directory. If not specified, a temporary directory will be created.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">FileNotFoundError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Brain path </span><span class="si">{</span><span class="n">path</span><span class="si">}</span><span class="s2"> not found.&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;^[a-zA-Z][a-zA-Z0-9_-]{0,}$&quot;</span><span class="p">,</span> <span class="n">subject_code</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Invalid subject code: </span><span class="si">{</span><span class="n">subject_code</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_subject_code</span> <span class="o">=</span> <span class="n">subject_code</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_template_subject</span> <span class="o">=</span> <span class="s2">&quot;N27&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_storage</span> <span class="o">=</span> <span class="n">temporary_directory</span><span class="p">(</span><span class="n">prefix</span> <span class="o">=</span> <span class="n">subject_code</span><span class="p">)</span>
        <span class="c1"># set up geoms</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_groups</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_geoms</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_slices</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_surfaces</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_volumes</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_electrode_contacts</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_electrode_cmaps</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="c1"># set up global data, this must run prior to _update_matrices</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_initialize_global_data</span><span class="p">()</span>
        <span class="c1"># Basic information </span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_vox2ras</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_vox2ras_tkr</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_ras2mni_305</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="c1"># using CONSTANT.DEFAULT_SLICE_PREFIXIES and CONSTANT.DEFAULT_ATLAS_PREFIXIES to find the matrices</span>
        <span class="n">volume_prefixies</span> <span class="o">=</span> <span class="p">[</span><span class="o">*</span><span class="n">CONSTANTS</span><span class="o">.</span><span class="n">DEFAULT_SLICE_PREFIXIES</span><span class="p">,</span> <span class="o">*</span><span class="n">CONSTANTS</span><span class="o">.</span><span class="n">DEFAULT_ATLAS_PREFIXIES</span><span class="p">]</span>
        <span class="n">mgz_files</span> <span class="o">=</span> <span class="p">[</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">x</span><span class="si">}</span><span class="s2">.mgz&quot;</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">volume_prefixies</span><span class="p">]</span>
        <span class="n">nii_gz_files</span> <span class="o">=</span> <span class="p">[</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">x</span><span class="si">}</span><span class="s2">.nii.gz&quot;</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">volume_prefixies</span><span class="p">]</span>
        <span class="n">nii_files</span> <span class="o">=</span> <span class="p">[</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">x</span><span class="si">}</span><span class="s2">.nii&quot;</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">volume_prefixies</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_update_matrices</span><span class="p">(</span><span class="n">volume_files</span> <span class="o">=</span> <span class="p">[</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">path_mri</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="p">[</span><span class="o">*</span><span class="n">mgz_files</span><span class="p">,</span> <span class="o">*</span><span class="n">nii_gz_files</span><span class="p">,</span> <span class="o">*</span><span class="n">nii_files</span><span class="p">]])</span>
        <span class="c1"># get ras to mni-305 matrix</span>
        <span class="n">xfm_file</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">path_mri</span><span class="p">,</span> <span class="s2">&quot;transforms&quot;</span><span class="p">,</span> <span class="s2">&quot;talairach.xfm&quot;</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">xfm</span> <span class="o">=</span> <span class="n">read_xfm</span><span class="p">(</span><span class="n">xfm_file</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_ras2mni_305</span> <span class="o">=</span> <span class="n">Mat44</span><span class="p">(</span><span class="n">xfm</span><span class="p">[</span><span class="s1">&#39;transform&#39;</span><span class="p">],</span> <span class="n">space_from</span><span class="o">=</span><span class="n">xfm</span><span class="p">[</span><span class="s1">&#39;space_from&#39;</span><span class="p">],</span> <span class="n">space_to</span><span class="o">=</span><span class="n">xfm</span><span class="p">[</span><span class="s1">&#39;space_to&#39;</span><span class="p">])</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_ras2mni_305</span> <span class="o">=</span> <span class="n">Mat44</span><span class="p">(</span><span class="n">space_from</span><span class="o">=</span><span class="s2">&quot;ras&quot;</span><span class="p">,</span> <span class="n">space_to</span><span class="o">=</span><span class="s2">&quot;mni305&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__del__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_storage</span><span class="o">.</span><span class="n">cleanup</span><span class="p">()</span>
    <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;Brain(</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_subject_code</span><span class="si">}</span><span class="s2"> @ </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_path</span><span class="si">}</span><span class="s2">)&quot;</span>
    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;Brain(</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_subject_code</span><span class="si">}</span><span class="s2"> @ </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_path</span><span class="si">}</span><span class="s2">)&quot;</span>
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">subject_code</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Subject code string.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_subject_code</span>
    <span class="c1"># region &lt;paths&gt;</span>
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">path</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        The root path to the imaging files.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_path</span>
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">path_mri</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        The path to the MRI and atlas files.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">return</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_path</span><span class="p">,</span> <span class="s2">&quot;mri&quot;</span><span class="p">)</span>
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">path_surf</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        The path to the surface mesh files.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">return</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_path</span><span class="p">,</span> <span class="s2">&quot;surf&quot;</span><span class="p">)</span>
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">storage</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        The path to a temporary directory for storing intermediate files and viewers.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_storage</span>
    <span class="c1"># endregion</span>

    <span class="c1"># region &lt;transforms&gt;</span>
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">vox2ras</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Mat44</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        A `4x4` voxel (indexing) to T1 scanner RAS (right-anterior-superior coordinate) transform matrix.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_vox2ras</span><span class="p">,</span> <span class="n">Mat44</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_vox2ras</span>
        <span class="n">m</span> <span class="o">=</span> <span class="n">Mat44</span><span class="p">(</span><span class="n">space_from</span><span class="o">=</span><span class="s2">&quot;voxel&quot;</span><span class="p">,</span> <span class="n">space_to</span><span class="o">=</span><span class="s2">&quot;ras&quot;</span><span class="p">)</span>
        <span class="n">m</span><span class="o">.</span><span class="n">extra</span><span class="p">[</span><span class="s2">&quot;missing&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">return</span> <span class="n">m</span>
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">vox2ras_tkr</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Mat44</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        A `4x4` voxel (indexing) to viewer (or FreeSurfer) tkrRAS (tk-registered right-anterior-superior coordinate) transform matrix.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_vox2ras_tkr</span><span class="p">,</span> <span class="n">Mat44</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_vox2ras_tkr</span>
        <span class="n">m</span> <span class="o">=</span> <span class="n">Mat44</span><span class="p">(</span><span class="n">space_from</span><span class="o">=</span><span class="s2">&quot;voxel&quot;</span><span class="p">,</span> <span class="n">space_to</span><span class="o">=</span><span class="s2">&quot;ras_tkr&quot;</span><span class="p">)</span>
        <span class="n">m</span><span class="o">.</span><span class="n">extra</span><span class="p">[</span><span class="s2">&quot;missing&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">return</span> <span class="n">m</span>
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">ras2ras_tkr</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Mat44</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        A `4x4` T1 scanner RAS (right-anterior-superior coordinate) to viewer (or FreeSurfer tk-registered) tkrRAS transform matrix.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">vox2ras_tkr</span> <span class="o">*</span> <span class="p">(</span><span class="o">~</span><span class="bp">self</span><span class="o">.</span><span class="n">vox2ras</span><span class="p">)</span>
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">ras2mni_305</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Mat44</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        A `4x4` transform matrix from T1 scanner RAS (right-anterior-superior coordinate) to MNI305 template space using FreeSurfer affine transform (generated during `recon-all`).</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_ras2mni_305</span><span class="p">,</span> <span class="n">Mat44</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ras2mni_305</span>
        <span class="n">m</span> <span class="o">=</span> <span class="n">Mat44</span><span class="p">(</span><span class="n">space_from</span><span class="o">=</span><span class="s2">&quot;ras&quot;</span><span class="p">,</span> <span class="n">space_to</span><span class="o">=</span><span class="s2">&quot;mni305&quot;</span><span class="p">)</span>
        <span class="n">m</span><span class="o">.</span><span class="n">extra</span><span class="p">[</span><span class="s2">&quot;missing&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">return</span> <span class="n">m</span>
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">ras2mni_152</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Mat44</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        A `4x4` transform matrix from T1 scanner RAS (right-anterior-superior coordinate) to MNI152 template space using FreeSurfer affine transform (generated during `recon-all`).</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">return</span> <span class="n">MNI305_TO_MNI152</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">ras2mni_305</span>
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">ras_tkr2mni_305</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Mat44</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        A `4x4` transform matrix from tkrRAS to MNI305 template space using FreeSurfer affine transform (generated during `recon-all`).</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">ras2mni_305</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">vox2ras</span> <span class="o">*</span> <span class="p">(</span><span class="o">~</span><span class="bp">self</span><span class="o">.</span><span class="n">vox2ras_tkr</span><span class="p">)</span>
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">ras_tkr2mni_152</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Mat44</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        A `4x4` transform matrix from tkrRAS to MNI152 template space using FreeSurfer affine transform (generated during `recon-all`).</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">return</span> <span class="n">MNI305_TO_MNI152</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">ras_tkr2mni_305</span>
    <span class="k">def</span> <span class="nf">get_transform</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">space_from</span> <span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">space_to</span> <span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Mat44</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Get transform matrix from `space_from` to `space_to`. </span>
<span class="sd">        Args:</span>
<span class="sd">            space_from: The space from which the transform matrix is defined.</span>
<span class="sd">                choices are `voxel`, `ras`, `ras_tkr`, `mni305`, `mni152`.</span>
<span class="sd">            space_to: The space to which the transform matrix is defined.</span>
<span class="sd">                see `space_from` for choices.</span>
<span class="sd">        Examples:</span>
<span class="sd">            &gt;&gt;&gt; brain.get_transform(space_from = &quot;voxel&quot;, space_to = &quot;ras_tkr&quot;)</span>
<span class="sd">            Mat44 (T1.voxel -&gt; T1.ras_tkr): </span>
<span class="sd">            array([[  -1.,    0.,    0.,  128.],</span>
<span class="sd">                [   0.,    0.,    1., -128.],</span>
<span class="sd">                [   0.,   -1.,    0.,  128.],</span>
<span class="sd">                [   0.,    0.,    0.,    1.]])</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="n">space_from</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">CONSTANTS</span><span class="o">.</span><span class="n">SUPPORTED_SPACES</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Invalid space_from: </span><span class="si">{</span><span class="n">space_from</span><span class="si">}</span><span class="s2">, supported spaces are: </span><span class="si">{</span><span class="n">CONSTANTS</span><span class="o">.</span><span class="n">SUPPORTED_SPACES</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">space_to</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">CONSTANTS</span><span class="o">.</span><span class="n">SUPPORTED_SPACES</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Invalid space_to: </span><span class="si">{</span><span class="n">space_to</span><span class="si">}</span><span class="s2">, supported spaces are: </span><span class="si">{</span><span class="n">CONSTANTS</span><span class="o">.</span><span class="n">SUPPORTED_SPACES</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">space_from</span> <span class="o">==</span> <span class="n">space_to</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">Mat44</span><span class="p">(</span><span class="n">space_from</span><span class="o">=</span><span class="n">space_from</span><span class="p">,</span> <span class="n">space_to</span><span class="o">=</span><span class="n">space_to</span><span class="p">,</span> <span class="n">modality_from</span><span class="o">=</span><span class="s2">&quot;T1&quot;</span><span class="p">,</span> <span class="n">modality_to</span><span class="o">=</span><span class="s2">&quot;T1&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">space_from</span> <span class="o">==</span> <span class="s2">&quot;ras&quot;</span><span class="p">:</span>
            <span class="n">transform</span> <span class="o">=</span> <span class="n">Mat44</span><span class="p">(</span><span class="n">space_from</span><span class="o">=</span><span class="s2">&quot;ras&quot;</span><span class="p">,</span> <span class="n">space_to</span><span class="o">=</span><span class="s2">&quot;ras&quot;</span><span class="p">,</span> <span class="n">modality_from</span><span class="o">=</span><span class="s2">&quot;T1&quot;</span><span class="p">,</span> <span class="n">modality_to</span><span class="o">=</span><span class="s2">&quot;T1&quot;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">space_from</span> <span class="o">==</span> <span class="s2">&quot;ras_tkr&quot;</span><span class="p">:</span>
            <span class="n">transform</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="o">~</span><span class="bp">self</span><span class="o">.</span><span class="n">ras2ras_tkr</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">space_from</span> <span class="o">==</span> <span class="s2">&quot;mni305&quot;</span><span class="p">:</span>
            <span class="n">transform</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="o">~</span><span class="bp">self</span><span class="o">.</span><span class="n">ras2mni_305</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">space_from</span> <span class="o">==</span> <span class="s2">&quot;mni152&quot;</span><span class="p">:</span>
            <span class="n">transform</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="o">~</span><span class="bp">self</span><span class="o">.</span><span class="n">ras2mni_152</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">transform</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">vox2ras</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">space_to</span> <span class="o">==</span> <span class="s2">&quot;ras&quot;</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">transform</span>
        <span class="k">elif</span> <span class="n">space_to</span> <span class="o">==</span> <span class="s2">&quot;ras_tkr&quot;</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">ras2ras_tkr</span> <span class="o">*</span> <span class="n">transform</span>
        <span class="k">elif</span> <span class="n">space_to</span> <span class="o">==</span> <span class="s2">&quot;mni305&quot;</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">ras2mni_305</span> <span class="o">*</span> <span class="n">transform</span>
        <span class="k">elif</span> <span class="n">space_to</span> <span class="o">==</span> <span class="s2">&quot;mni152&quot;</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">ras2mni_152</span> <span class="o">*</span> <span class="n">transform</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">(</span><span class="o">~</span><span class="bp">self</span><span class="o">.</span><span class="n">vox2ras</span><span class="p">)</span> <span class="o">*</span> <span class="n">transform</span>

    <span class="k">def</span> <span class="nf">set_transform_space</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">transform</span> <span class="p">:</span> <span class="n">Mat44</span><span class="p">,</span> <span class="n">space_from</span> <span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">space_to</span> <span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Mat44</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Returns a copy of `transform`, but with space transformed. </span>
<span class="sd">        Args:</span>
<span class="sd">            transform: The transform matrix of class `Mat44`. If `transform` is not specified, then the transform will be identity matrix.</span>
<span class="sd">            space_from: The space from which the transform matrix will be defined.</span>
<span class="sd">                choices are `voxel`, `ras`, `ras_tkr`, `mni305`, `mni152`.</span>
<span class="sd">            space_to: The space to which the transform matrix will be defined.</span>
<span class="sd">        Returns:</span>
<span class="sd">            The new transform matrix with given spaces and inherited modalities.</span>
<span class="sd">        Examples:</span>
<span class="sd">            If you have a matrix that switch the column and row indexes in the voxel space,</span>
<span class="sd">                what&#39;s the matrix in the ras space?</span>
<span class="sd">            &gt;&gt;&gt; from threebrainpy.core import Mat44</span>
<span class="sd">            &gt;&gt;&gt; idx_transform = Mat44([0,1,0,0,1,0,0,0,0,0,1,0], space_from = &quot;voxel&quot;, space_to = &quot;voxel&quot;)</span>
<span class="sd">            &gt;&gt;&gt; idx_transform</span>
<span class="sd">            Mat44 (T1.voxel -&gt; T1.voxel): </span>
<span class="sd">            array([[0., 1., 0., 0.],</span>
<span class="sd">                [1., 0., 0., 0.],</span>
<span class="sd">                [0., 0., 1., 0.],</span>
<span class="sd">                [0., 0., 0., 1.]])</span>
<span class="sd">            &gt;&gt;&gt; # Applies idx_transform first then vox-to-ras</span>
<span class="sd">            &gt;&gt;&gt; brain.set_transform_space(transform = idx_transform, space_from = &quot;voxel&quot;, space_to = &quot;ras&quot;)</span>
<span class="sd">            Mat44 (T1.voxel -&gt; T1.ras): </span>
<span class="sd">            array([[   0.        ,   -1.        ,    0.        ,  131.61447144],</span>
<span class="sd">                [   0.        ,    0.        ,    1.        , -127.5       ],</span>
<span class="sd">                [  -1.        ,    0.        ,    0.        ,  127.5       ],</span>
<span class="sd">                [   0.        ,    0.        ,    0.        ,    1.        ]])</span>
<span class="sd">            &gt;&gt;&gt; # To validate the transform</span>
<span class="sd">            &gt;&gt;&gt; brain.vox2ras * idx_transform</span>
<span class="sd">            Mat44 (T1.voxel -&gt; T1.ras): </span>
<span class="sd">            array([[   0.        ,   -1.        ,    0.        ,  131.61447144],</span>
<span class="sd">                [   0.        ,    0.        ,    1.        , -127.5       ],</span>
<span class="sd">                [  -1.        ,    0.        ,    0.        ,  127.5       ],</span>
<span class="sd">                [   0.        ,    0.        ,    0.        ,    1.        ]])</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">transform</span><span class="p">,</span> <span class="n">Mat44</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Invalid transform matrix: </span><span class="si">{</span><span class="n">transform</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">space_from</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">CONSTANTS</span><span class="o">.</span><span class="n">SUPPORTED_SPACES</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Invalid space_from: </span><span class="si">{</span><span class="n">space_from</span><span class="si">}</span><span class="s2">, supported spaces are: </span><span class="si">{</span><span class="n">CONSTANTS</span><span class="o">.</span><span class="n">SUPPORTED_SPACES</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">space_to</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">CONSTANTS</span><span class="o">.</span><span class="n">SUPPORTED_SPACES</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Invalid space_to: </span><span class="si">{</span><span class="n">space_to</span><span class="si">}</span><span class="s2">, supported spaces are: </span><span class="si">{</span><span class="n">CONSTANTS</span><span class="o">.</span><span class="n">SUPPORTED_SPACES</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="c1"># check modalities</span>
        <span class="k">if</span> <span class="n">transform</span><span class="o">.</span><span class="n">modality_from</span> <span class="o">!=</span> <span class="s2">&quot;T1&quot;</span> <span class="ow">and</span> <span class="n">transform</span><span class="o">.</span><span class="n">space_from</span> <span class="o">!=</span> <span class="n">space_from</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Invalid transform matrix: </span><span class="si">{</span><span class="n">transform</span><span class="si">}</span><span class="s2">, modality_from must be &#39;T1&#39; or space_from must be </span><span class="si">{</span><span class="n">space_from</span><span class="si">}</span><span class="s2">.&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">transform</span><span class="o">.</span><span class="n">modality_to</span> <span class="o">!=</span> <span class="s2">&quot;T1&quot;</span> <span class="ow">and</span> <span class="n">transform</span><span class="o">.</span><span class="n">space_to</span> <span class="o">!=</span> <span class="n">space_to</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Invalid transform matrix: </span><span class="si">{</span><span class="n">transform</span><span class="si">}</span><span class="s2">, modality_to must be &#39;T1&#39; or space_to must be </span><span class="si">{</span><span class="n">space_to</span><span class="si">}</span><span class="s2">.&quot;</span><span class="p">)</span>
        <span class="n">re</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="n">transform</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">transform</span><span class="o">.</span><span class="n">modality_from</span> <span class="o">==</span> <span class="s2">&quot;T1&quot;</span><span class="p">:</span>
            <span class="n">re</span> <span class="o">=</span> <span class="n">re</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_transform</span><span class="p">(</span><span class="n">space_to</span> <span class="o">=</span> <span class="n">transform</span><span class="o">.</span><span class="n">space_from</span><span class="p">,</span> <span class="n">space_from</span> <span class="o">=</span> <span class="n">space_from</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">transform</span><span class="o">.</span><span class="n">modality_to</span> <span class="o">==</span> <span class="s2">&quot;T1&quot;</span><span class="p">:</span>
            <span class="n">re</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_transform</span><span class="p">(</span><span class="n">space_from</span> <span class="o">=</span> <span class="n">transform</span><span class="o">.</span><span class="n">space_to</span><span class="p">,</span> <span class="n">space_to</span> <span class="o">=</span> <span class="n">space_to</span><span class="p">)</span> <span class="o">*</span> <span class="n">re</span>
        <span class="k">return</span> <span class="n">re</span>
    <span class="c1"># endregion</span>

    <span class="c1"># region &lt;Group operations&gt;</span>
    <span class="k">def</span> <span class="nf">_initialize_global_data</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">global_placeholder</span> <span class="o">=</span> <span class="n">BlankPlaceholder</span><span class="p">(</span><span class="n">brain</span> <span class="o">=</span> <span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_globals</span> <span class="o">=</span> <span class="n">global_placeholder</span><span class="o">.</span><span class="n">group</span>
    <span class="k">def</span> <span class="nf">add_global_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span> <span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">value</span> <span class="p">:</span> <span class="nb">any</span><span class="p">,</span> <span class="n">is_cache</span> <span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">absolute_path</span> <span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Internal method to add global data to the brain.</span>
<span class="sd">        Args:</span>
<span class="sd">            name: The name of the global data.</span>
<span class="sd">            value: If `is_cache=False`, the value of the global data, can be any JSON-serializable object.</span>
<span class="sd">                If `is_cache=True`, the path to, or the file name of the cached JSON file.</span>
<span class="sd">            is_cache: Whether the `value` is a cached JSON file.</span>
<span class="sd">            absolute_path: The absolute path to the cached JSON file.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_globals</span><span class="o">.</span><span class="n">set_group_data</span><span class="p">(</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span><span class="p">,</span> <span class="n">value</span> <span class="o">=</span> <span class="n">value</span><span class="p">,</span> <span class="n">is_cache</span> <span class="o">=</span> <span class="n">is_cache</span><span class="p">,</span> <span class="n">absolute_path</span> <span class="o">=</span> <span class="n">absolute_path</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">get_global_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Get global data from the brain instance.</span>
<span class="sd">        Args:</span>
<span class="sd">            name: The name of the global data.</span>
<span class="sd">        Returns:</span>
<span class="sd">            The value of the global data.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_globals</span><span class="o">.</span><span class="n">get_group_data</span><span class="p">(</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">add_group</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span> <span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">exists_ok</span> <span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">GeomWrapper</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Internal method to add a geometry groups to the brain.</span>
<span class="sd">        Args:</span>
<span class="sd">            name: The name of the group.</span>
<span class="sd">            exists_ok: Whether to overwrite the existing group if the group already exists.</span>
<span class="sd">        Returns:</span>
<span class="sd">            The group instance.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">group</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_groups</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">group</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">group</span> <span class="o">=</span> <span class="n">GeomWrapper</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span> <span class="o">=</span> <span class="n">name</span><span class="p">,</span> <span class="n">position</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">],</span> <span class="n">layers</span> <span class="o">=</span> <span class="p">[</span><span class="n">CONSTANTS</span><span class="o">.</span><span class="n">LAYER_USER_MAIN_CAMERA_0</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_groups</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">group</span>
        <span class="k">elif</span> <span class="ow">not</span> <span class="n">exists_ok</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Group </span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2"> already exists.&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">group</span>
    <span class="k">def</span> <span class="nf">get_group</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span> <span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">GeomWrapper</span> <span class="o">|</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Get a geometry group from the brain.</span>
<span class="sd">        Args:</span>
<span class="sd">            name: The name of the group.</span>
<span class="sd">        Returns:</span>
<span class="sd">            The group instance or `None` if the group does not exist.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_groups</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">has_group</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span> <span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Check if the brain has a geometry group.</span>
<span class="sd">        Args:</span>
<span class="sd">            name: The name of the group.</span>
<span class="sd">        Returns:</span>
<span class="sd">            `True` if the group exists, `False` otherwise.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">return</span> <span class="n">name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_groups</span>
    <span class="k">def</span> <span class="nf">ensure_group</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span> <span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span> <span class="p">:</span> <span class="nb">dict</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">GeomWrapper</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Ensure that a geometry group exists, if not, create one.</span>
<span class="sd">        Args:</span>
<span class="sd">            name: The name of the group.</span>
<span class="sd">            kwargs: Other arguments to be passed to `add_group`.</span>
<span class="sd">        Returns:</span>
<span class="sd">            The group instance.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">has_group</span><span class="p">(</span><span class="n">name</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_group</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">add_group</span><span class="p">(</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span><span class="p">,</span> <span class="n">exists_ok</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">set_group_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span> <span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">value</span> <span class="p">:</span> <span class="nb">any</span><span class="p">,</span> <span class="n">is_cache</span> <span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">absolute_path</span> <span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">auto_create</span> <span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Set group data to the brain so the JavaScript engine will have access to the data. </span>
<span class="sd">            This method is a low-level function</span>
<span class="sd">        Args:</span>
<span class="sd">            name: The name of the group data.</span>
<span class="sd">            value: If `is_cache=False`, the value of the group data, can be any JSON-serializable object.</span>
<span class="sd">                If `is_cache=True`, the path to, or the file name of the cached JSON file.</span>
<span class="sd">            is_cache: Whether the `value` is a cached JSON file.</span>
<span class="sd">            absolute_path: The absolute path to the cached JSON file.</span>
<span class="sd">            auto_create: Whether to create a group if the group does not exist.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="n">auto_create</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ensure_group</span><span class="p">(</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span><span class="p">)</span>
        <span class="n">group</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_group</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">group</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Group </span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2"> not found.&quot;</span><span class="p">)</span>
        <span class="n">group</span><span class="o">.</span><span class="n">set_group_data</span><span class="p">(</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span><span class="p">,</span> <span class="n">value</span> <span class="o">=</span> <span class="n">value</span><span class="p">,</span> <span class="n">is_cache</span> <span class="o">=</span> <span class="n">is_cache</span><span class="p">,</span> <span class="n">absolute_path</span> <span class="o">=</span> <span class="n">absolute_path</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">None</span>
    <span class="k">def</span> <span class="nf">get_global_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span> <span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">force_reload</span> <span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">ifnotfound</span> <span class="p">:</span> <span class="nb">any</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">any</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Get group data from the brain instance.</span>
<span class="sd">        Args:</span>
<span class="sd">            name: The name of the group data.</span>
<span class="sd">            force_reload: Whether to force reload the group data.</span>
<span class="sd">            ifnotfound: If the group data is not found, return this value.</span>
<span class="sd">        Returns:</span>
<span class="sd">            The value of the group data, or `ifnotfound`.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">group</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_group</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">group</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">ifnotfound</span>
        <span class="k">return</span> <span class="n">group</span><span class="o">.</span><span class="n">get_group_data</span><span class="p">(</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span><span class="p">,</span> <span class="n">force_reload</span> <span class="o">=</span> <span class="n">force_reload</span><span class="p">,</span> <span class="n">ifnotfound</span> <span class="o">=</span> <span class="n">ifnotfound</span><span class="p">)</span>
    <span class="c1"># endregion</span>

    <span class="c1"># region &lt;Geometries&gt;</span>
    <span class="k">def</span> <span class="nf">get_geometry</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span> <span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">GeometryTemplate</span> <span class="o">|</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Get a geometry instance from the brain.</span>
<span class="sd">        Args:</span>
<span class="sd">            name: The name of the geometry template.</span>
<span class="sd">        Returns:</span>
<span class="sd">            The geometry instance or `None` if the geometry instance does not exist.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_geoms</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">has_geometry</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span> <span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Check if the brain has a geometry instance.</span>
<span class="sd">        Args:</span>
<span class="sd">            name: The name of the geometry template.</span>
<span class="sd">        Returns:</span>
<span class="sd">            `True` if the geometry instance exists, `False` otherwise.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">return</span> <span class="n">name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_geoms</span>
    <span class="c1"># endregion</span>

    <span class="c1"># region &lt;MRI slices&gt;</span>
    <span class="k">def</span> <span class="nf">add_slice</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">slice_prefix</span> <span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;brain.finalsurfs&quot;</span><span class="p">,</span> <span class="n">name</span> <span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;T1&quot;</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Add a (MRI) volume slice to the brain. The slices will be rendered in side canvas using datacube (JavaScript class).</span>
<span class="sd">        Args:</span>
<span class="sd">            slice_prefix: The prefix of the slice file in the `mri` folder. (default: &quot;brain.finalsurfs&quot;)</span>
<span class="sd">            name: The name of the slice, currently only &quot;T1&quot; is supported. (default: &quot;T1&quot;)</span>
<span class="sd">        Examples:</span>
<span class="sd">            Adds `brain.finalsurfs.mgz` or `brain.finalsurfs.nii[.gz]` to the brain slices</span>
<span class="sd">            &gt;&gt;&gt; brain.add_slice(slice_prefix = &quot;brain.finalsurfs&quot;, name = &quot;T1&quot;)</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="c1"># In geoms, the name needs to be appended with the subject code</span>
        <span class="c1"># possible file names</span>
        <span class="n">slice_prefix</span> <span class="o">=</span> <span class="n">slice_prefix</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
        <span class="n">candidates</span> <span class="o">=</span> <span class="p">[</span>
            <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">slice_prefix</span><span class="si">}</span><span class="s2">.mgz&quot;</span><span class="p">,</span>
            <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">slice_prefix</span><span class="si">}</span><span class="s2">.nii.gz&quot;</span><span class="p">,</span>
            <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">slice_prefix</span><span class="si">}</span><span class="s2">.nii&quot;</span><span class="p">,</span>
        <span class="p">]</span>
        <span class="n">slice_files</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">path_mri</span><span class="p">)</span> <span class="k">if</span> <span class="n">x</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="n">candidates</span><span class="p">]</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">slice_files</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>
        <span class="n">slice_file</span> <span class="o">=</span> <span class="n">slice_files</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">slice_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">path_mri</span><span class="p">,</span> <span class="n">slice_file</span><span class="p">))</span>
        <span class="nb">slice</span> <span class="o">=</span> <span class="n">VolumeSlice</span><span class="p">(</span><span class="n">brain</span> <span class="o">=</span> <span class="bp">self</span><span class="p">,</span> <span class="n">name</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2"> (</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">subject_code</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">,</span> <span class="n">volume</span> <span class="o">=</span> <span class="n">slice_path</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_slices</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="nb">slice</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_update_matrices</span><span class="p">(</span><span class="n">volume_files</span> <span class="o">=</span> <span class="p">[</span><span class="n">slice_path</span><span class="p">])</span>
        <span class="k">return</span> <span class="nb">slice</span>
    <span class="k">def</span> <span class="nf">get_slice</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span> <span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">VolumeSlice</span> <span class="o">|</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Get MRI slices from the brain.</span>
<span class="sd">        Args:</span>
<span class="sd">            name: The name of the slice.</span>
<span class="sd">        Returns:</span>
<span class="sd">            The slice instance or `None` if the slice does not exist.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_slices</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">get_slices</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="n">VolumeSlice</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Get all MRI slices from the brain.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_slices</span>
    <span class="k">def</span> <span class="nf">has_slice</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span> <span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Check if the brain has MRI slices with given name.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">return</span> <span class="n">name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_slices</span>
    <span class="c1"># endregion</span>

    <span class="c1"># region &lt;Atlases/CT/3D voxels&gt;</span>
    <span class="k">def</span> <span class="nf">add_volume</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">volume_prefix</span> <span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">is_continuous</span> <span class="p">:</span> <span class="nb">bool</span><span class="p">,</span> <span class="n">name</span> <span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span> <span class="o">|</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Add a (Atlas/CT/3D voxel) volume cube to the brain. The VolumeCube will be rendered in main canvas using datacube2 (JavaScript class).</span>
<span class="sd">        Args:</span>
<span class="sd">            volume_prefix: The prefix of the volume file in the `mri` folder. (e.g. &quot;aparc+aseg&quot;, &quot;CT_raw&quot;)</span>
<span class="sd">            is_continuous: Whether the volume is continuous or discrete. </span>
<span class="sd">                The color map for continuous and discrete values are set separately.</span>
<span class="sd">                For continuous values, the volume will be rendered using RedFormat (single-channel shader). </span>
<span class="sd">                    The color will be assgined according to the volume value (density).</span>
<span class="sd">                For discrete values, the volume will be rendered using RGBAFormat (four-channel shader). </span>
<span class="sd">                    The volume data will be used as the color index, and the color map will be set separately.</span>
<span class="sd">                    The color index must be integer, and the color map must be a list of RGBA colors.</span>
<span class="sd">            name: The name of the volume, default is to automatically derived from the volume_prefix. </span>
<span class="sd">                Please set name to &quot;CT&quot; is the volume file is CT for localization</span>
<span class="sd">        Examples:</span>
<span class="sd">            Adds `aparc+aseg.mgz` or `aparc+aseg.nii[.gz]` to the brain volumes</span>
<span class="sd">            &gt;&gt;&gt; brain.add_volume(volume_prefix = &quot;aparc+aseg&quot;, is_continuous = False)</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="c1"># In geoms, the name needs to be appended with the subject code</span>
        <span class="c1"># possible file names</span>
        <span class="n">volume_prefix</span> <span class="o">=</span> <span class="n">volume_prefix</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">name</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">name</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;[^a-zA-Z0-9_]&quot;</span><span class="p">,</span> <span class="s2">&quot;_&quot;</span><span class="p">,</span> <span class="n">volume_prefix</span><span class="p">)</span>
        <span class="n">candidates</span> <span class="o">=</span> <span class="p">[</span>
            <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">volume_prefix</span><span class="si">}</span><span class="s2">.mgz&quot;</span><span class="p">,</span>
            <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">volume_prefix</span><span class="si">}</span><span class="s2">.nii.gz&quot;</span><span class="p">,</span>
            <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">volume_prefix</span><span class="si">}</span><span class="s2">.nii&quot;</span><span class="p">,</span>
        <span class="p">]</span>
        <span class="n">volume_files</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">path_mri</span><span class="p">)</span> <span class="k">if</span> <span class="n">x</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="n">candidates</span><span class="p">]</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">volume_files</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>
        <span class="n">volume_file</span> <span class="o">=</span> <span class="n">volume_files</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">volume_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">path_mri</span><span class="p">,</span> <span class="n">volume_file</span><span class="p">))</span>
        <span class="n">volume</span> <span class="o">=</span> <span class="n">VolumeWrapper</span><span class="p">(</span><span class="n">volume_path</span><span class="p">)</span>
        <span class="n">volume_cube</span> <span class="o">=</span> <span class="n">VolumeCube</span><span class="p">(</span><span class="n">brain</span> <span class="o">=</span> <span class="bp">self</span><span class="p">,</span> <span class="n">name</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Atlas - </span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2"> (</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">subject_code</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">,</span> <span class="n">volume</span> <span class="o">=</span> <span class="n">volume</span><span class="p">,</span>
                                 <span class="n">color_format</span> <span class="o">=</span> <span class="s2">&quot;RedFormat&quot;</span> <span class="k">if</span> <span class="n">is_continuous</span> <span class="k">else</span> <span class="s2">&quot;RGBAFormat&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_update_matrices</span><span class="p">(</span><span class="n">volume_files</span> <span class="o">=</span> <span class="p">[</span><span class="n">volume_path</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_volumes</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">volume_cube</span>
        <span class="k">return</span> <span class="n">volume_cube</span>
    <span class="c1"># endregion</span>

    <span class="c1"># region &lt;Surfaces&gt;</span>
    <span class="k">def</span> <span class="nf">_surface_morph_paths</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">hemesphere</span> <span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;both&quot;</span><span class="p">,</span> <span class="n">morph_types</span> <span class="p">:</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">|</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">|</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span> <span class="o">|</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">hemesphere</span><span class="o">.</span><span class="n">lower</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;l&#39;</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">]:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Invalid hemesphere: </span><span class="si">{</span><span class="n">hemesphere</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">hemesphere</span> <span class="o">=</span> <span class="n">hemesphere</span><span class="o">.</span><span class="n">lower</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">hemesphere</span> <span class="o">==</span> <span class="s2">&quot;b&quot;</span><span class="p">:</span>
            <span class="n">hemesphere</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;lh&quot;</span><span class="p">,</span> <span class="s2">&quot;rh&quot;</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">hemesphere</span> <span class="o">=</span> <span class="p">[</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="w"> </span><span class="n">hemesphere</span><span class="w"> </span><span class="si">}</span><span class="s2">h&quot;</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">morph_types</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">morph_types</span> <span class="o">=</span> <span class="n">CONSTANTS</span><span class="o">.</span><span class="n">SURFACE_BASE_TEXTURE_TYPES</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">morph_types</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="n">morph_types</span> <span class="o">=</span> <span class="p">[</span><span class="n">morph_types</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">morph_type</span> <span class="ow">in</span> <span class="n">morph_types</span><span class="p">:</span>
            <span class="n">not_found</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="n">re</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">([(</span><span class="n">h</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">path_surf</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">h</span><span class="si">}</span><span class="s2">.</span><span class="si">{</span><span class="n">morph_type</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">))</span> <span class="k">for</span> <span class="n">h</span> <span class="ow">in</span> <span class="n">hemesphere</span><span class="p">])</span>
            <span class="k">for</span> <span class="n">h</span><span class="p">,</span> <span class="n">morph_path</span> <span class="ow">in</span> <span class="n">re</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">morph_path</span><span class="p">):</span>
                    <span class="n">not_found</span> <span class="o">=</span> <span class="kc">True</span>
                    <span class="k">break</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">not_found</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">re</span>
        <span class="k">return</span> <span class="kc">None</span>

    <span class="k">def</span> <span class="nf">add_surfaces</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">surface_type</span> <span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">hemesphere</span> <span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;both&quot;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span> <span class="o">|</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Add a surface to the brain. The surface will be rendered in main canvas using surface (JavaScript class).</span>
<span class="sd">        Args:</span>
<span class="sd">            surface_type: The type of the surface, e.g. &quot;pial&quot;, &quot;white&quot;, &quot;inflated&quot;, &quot;sphere&quot; (see `surf/` folder, usually `[lr]h.&lt;surface_type&gt;`).</span>
<span class="sd">            hemesphere: The hemesphere of the surface, can be &quot;l&quot;, &quot;r&quot;, &quot;b&quot; (both). (default: &quot;both&quot;)</span>
<span class="sd">        Returns:</span>
<span class="sd">            A dictionary of surface instances if exist, with keys being the hemesphere.</span>
<span class="sd">        Examples:</span>
<span class="sd">            Adds `lh.pial` and `rh.pial` to the brain surfaces</span>
<span class="sd">            &gt;&gt;&gt; brain.add_surfaces(surface_type = &quot;pial&quot;, hemesphere = &quot;both&quot;)</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">hemesphere_prefix</span> <span class="o">=</span> <span class="n">hemesphere</span><span class="o">.</span><span class="n">lower</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">hemesphere_prefix</span> <span class="o">==</span> <span class="s2">&quot;b&quot;</span><span class="p">:</span>
            <span class="n">hemesphere_prefix</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;lh&quot;</span><span class="p">,</span> <span class="s2">&quot;rh&quot;</span><span class="p">]</span>
        <span class="k">elif</span> <span class="n">hemesphere_prefix</span> <span class="o">==</span> <span class="s2">&quot;l&quot;</span><span class="p">:</span>
            <span class="n">hemesphere_prefix</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;lh&quot;</span><span class="p">]</span>
        <span class="k">elif</span> <span class="n">hemesphere_prefix</span> <span class="o">==</span> <span class="s2">&quot;r&quot;</span><span class="p">:</span>
            <span class="n">hemesphere_prefix</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;rh&quot;</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Invalid hemesphere: </span><span class="si">{</span><span class="n">hemesphere</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">surface_type0</span> <span class="o">=</span> <span class="n">surface_type</span>
        <span class="n">surface_type</span> <span class="o">=</span> <span class="n">surface_type</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">surface_type</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;pial&quot;</span><span class="p">,</span> <span class="s2">&quot;pial.t1&quot;</span><span class="p">,):</span>
            <span class="c1"># Newer freesurfer versions use &quot;pial.T1&quot; as the surface type, while older versions use &quot;pial&quot;</span>
            <span class="n">surface_type</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;pial&quot;</span><span class="p">,</span> <span class="s2">&quot;pial.t1&quot;</span><span class="p">]</span>
            <span class="n">surface_type0</span> <span class="o">=</span> <span class="s2">&quot;pial&quot;</span>
        <span class="c1"># construct possible file names</span>
        <span class="n">file_names_lower</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">h</span> <span class="ow">in</span> <span class="n">hemesphere_prefix</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">surface_type</span><span class="p">:</span>
                <span class="n">file_names_lower</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">h</span><span class="si">}</span><span class="s2">.</span><span class="si">{</span><span class="n">s</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="c1"># search for the file</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">path_surf</span><span class="p">):</span>
            <span class="k">return</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">path_surf</span><span class="p">):</span>
            <span class="k">return</span> <span class="kc">None</span>
        <span class="n">surface_files</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">path_surf</span><span class="p">)</span> <span class="k">if</span> <span class="n">x</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="n">file_names_lower</span><span class="p">]</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">surface_files</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>
        <span class="n">surface_dict</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_surfaces</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">surface_type0</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">surface_dict</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
            <span class="n">surface_dict</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_surfaces</span><span class="p">[</span><span class="n">surface_type0</span><span class="p">]</span> <span class="o">=</span> <span class="n">surface_dict</span>
        <span class="c1"># check base vertex colors</span>
        <span class="n">base_vertex_colors</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_surface_morph_paths</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">surface_filename</span> <span class="ow">in</span> <span class="n">surface_files</span><span class="p">:</span>
            <span class="n">surface_file</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">path_surf</span><span class="p">,</span> <span class="n">surface_filename</span><span class="p">)</span>
            <span class="n">surface</span> <span class="o">=</span> <span class="n">CorticalSurface</span><span class="p">(</span><span class="n">brain</span> <span class="o">=</span> <span class="bp">self</span><span class="p">,</span> <span class="n">surface_type</span> <span class="o">=</span> <span class="n">surface_type0</span><span class="p">,</span> <span class="n">surface_file</span> <span class="o">=</span> <span class="n">surface_file</span><span class="p">,</span> <span class="n">hemesphere</span> <span class="o">=</span> <span class="n">surface_filename</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="n">surface_dict</span><span class="p">[</span> <span class="n">surface</span><span class="o">.</span><span class="n">hemesphere</span> <span class="p">]</span> <span class="o">=</span> <span class="n">surface</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">base_vertex_colors</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
                <span class="n">surface</span><span class="o">.</span><span class="n">group</span><span class="o">.</span><span class="n">set_group_data</span><span class="p">(</span>
                    <span class="n">name</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">surface</span><span class="o">.</span><span class="n">hemesphere</span><span class="si">}</span><span class="s2">_primary_vertex_color&quot;</span><span class="p">,</span> 
                    <span class="n">value</span> <span class="o">=</span> <span class="n">base_vertex_colors</span><span class="p">[</span><span class="n">surface</span><span class="o">.</span><span class="n">hemesphere</span><span class="p">],</span> <span class="n">is_cache</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">surface_dict</span>
    <span class="k">def</span> <span class="nf">get_surfaces</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">surface_type</span> <span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span> <span class="o">|</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Get surfaces from the brain.</span>
<span class="sd">        Args:</span>
<span class="sd">            surface_type: The type of the surface, e.g. &quot;pial&quot;, &quot;white&quot;, &quot;inflated&quot;, &quot;sphere&quot; (see `surf/` folder, usually `[lr]h.&lt;surface_type&gt;`).</span>
<span class="sd">        Returns:</span>
<span class="sd">            A dictionary of surface instances if exist, with keys being the hemesphere.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_surfaces</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">surface_type</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">has_surface_type</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">surface_type</span> <span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Check if the brain has surfaces with given type.</span>
<span class="sd">        Args:</span>
<span class="sd">            surface_type: The type of the surface, e.g. &quot;pial&quot;, &quot;white&quot;, &quot;inflated&quot;, &quot;sphere&quot; (see `surf/` folder, usually `[lr]h.&lt;surface_type&gt;`).</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">return</span> <span class="n">surface_type</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_surfaces</span>
    <span class="c1"># endregion</span>

    <span class="c1"># region &lt;Electrode contacts&gt;</span>
    <span class="k">def</span> <span class="nf">add_electrode_contact</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span> <span class="n">number</span> <span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">label</span> <span class="p">:</span> <span class="nb">str</span><span class="p">,</span> 
            <span class="n">position</span> <span class="p">:</span> <span class="n">Vec3</span> <span class="o">|</span> <span class="nb">list</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> 
            <span class="n">is_surface</span> <span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> 
            <span class="n">radius</span> <span class="p">:</span> <span class="nb">float</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
            <span class="n">mni_position</span> <span class="p">:</span> <span class="n">Vec3</span> <span class="o">|</span> <span class="nb">list</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> 
            <span class="n">sphere_position</span> <span class="p">:</span> <span class="n">Vec3</span> <span class="o">|</span> <span class="nb">list</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
            <span class="o">**</span><span class="n">kwargs</span> <span class="p">:</span> <span class="nb">dict</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ElectrodeSphere</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Add an electrode contact to the brain. The electrode contact will be rendered in main canvas using sphere (JavaScript class).</span>
<span class="sd">        Args:</span>
<span class="sd">            number: The integer number of the electrode contact, starting from 1.</span>
<span class="sd">            label: The label of the electrode contact.</span>
<span class="sd">            position: The position of the electrode contact in the native space of the brain, or a `Vec3` instance with given spaces.</span>
<span class="sd">            is_surface: Whether the electrode contact is a surface electrode.</span>
<span class="sd">            radius: The radius of the electrode contact, default is 2.0 for surface electrodes and 1.0 for depth electrodes.</span>
<span class="sd">            mni_position: The position of the electrode contact in MNI space, overrides the default affine MNI calculation; </span>
<span class="sd">                often used if you have advanced/more accurate MNI estimation</span>
<span class="sd">            sphere_position: The position of the electrode contact in the sphere space; surface electrodes only.</span>
<span class="sd">            kwargs: Other arguments to be passed to `ElectrodeSphere`.</span>
<span class="sd">        Returns:</span>
<span class="sd">            The electrode contact instance.</span>
<span class="sd">        Examples:</span>
<span class="sd">            Adds an electrode contact to the brain</span>
<span class="sd">            &gt;&gt;&gt; e1 = brain.add_electrode_contact(number = 1, label = &quot;LA1&quot;, position = [35,10,10], is_surface = False)</span>
<span class="sd">            &gt;&gt;&gt; e1.get_position(&quot;ras&quot;)</span>
<span class="sd">            Vec3(35.0, 10.0, 10.0) [ras]</span>
<span class="sd">            &gt;&gt;&gt; e2 = brain.add_electrode_contact(number = 2, label = &quot;LA2&quot;, position = Vec3([5,10,10], space = &quot;voxel&quot;), is_surface = False)</span>
<span class="sd">            &gt;&gt;&gt; # Automatically transform position to RAS space</span>
<span class="sd">            &gt;&gt;&gt; e2.get_position(&quot;ras&quot;)</span>
<span class="sd">            Vec3(126.61447143554688, -117.5, 117.5) [ras]</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">is_surface</span> <span class="o">=</span> <span class="kc">True</span> <span class="k">if</span> <span class="n">is_surface</span> <span class="k">else</span> <span class="kc">False</span>
        <span class="k">if</span> <span class="n">radius</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">radius</span> <span class="o">=</span> <span class="mf">2.0</span> <span class="k">if</span> <span class="n">is_surface</span> <span class="k">else</span> <span class="mf">1.0</span>
        <span class="n">contact</span> <span class="o">=</span> <span class="n">ElectrodeSphere</span><span class="p">(</span>
            <span class="n">brain</span> <span class="o">=</span> <span class="bp">self</span><span class="p">,</span>
            <span class="n">number</span> <span class="o">=</span> <span class="n">number</span><span class="p">,</span> 
            <span class="n">label</span> <span class="o">=</span> <span class="n">label</span><span class="p">,</span> 
            <span class="n">position</span> <span class="o">=</span> <span class="n">position</span><span class="p">,</span> 
            <span class="n">radius</span> <span class="o">=</span> <span class="n">radius</span><span class="p">,</span>
            <span class="n">is_surface</span> <span class="o">=</span> <span class="n">is_surface</span><span class="p">,</span>
            <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">mni_position</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">contact</span><span class="o">.</span><span class="n">set_mni_position</span><span class="p">(</span><span class="n">mni_position</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">sphere_position</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">contact</span><span class="o">.</span><span class="n">set_sphere_position</span><span class="p">(</span><span class="n">sphere_position</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_electrode_contacts</span><span class="p">[</span> <span class="n">contact</span><span class="o">.</span><span class="n">number</span> <span class="p">]</span> <span class="o">=</span> <span class="n">contact</span>
        <span class="k">return</span> <span class="n">contact</span>
    <span class="k">def</span> <span class="nf">set_electrode_keyframe</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">number</span> <span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">value</span> <span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">|</span> <span class="nb">list</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">|</span> <span class="nb">list</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">|</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">|</span> <span class="nb">float</span> <span class="o">|</span> <span class="nb">int</span> <span class="o">|</span> <span class="nb">str</span><span class="p">,</span> 
                               <span class="n">time</span> <span class="p">:</span> <span class="nb">float</span> <span class="o">|</span> <span class="nb">list</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">|</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">|</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> 
                               <span class="n">name</span> <span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;value&quot;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">SimpleKeyframe</span> <span class="o">|</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Low-level method to set electrode contacts keyframe (values).</span>
<span class="sd">        Args:</span>
<span class="sd">            number: The integer number of the electrode contact, starting from 1.</span>
<span class="sd">            value: The value of the keyframe, can be numerical or characters.</span>
<span class="sd">            time: The time (second) of the keyframe, default is `None` which means 0.</span>
<span class="sd">            name: The name of the keyframe, default is &quot;value&quot;.</span>
<span class="sd">        Returns:</span>
<span class="sd">            The keyframe created</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">contact</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_electrode_contacts</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">number</span><span class="p">),</span> <span class="kc">None</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">contact</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>
        <span class="k">return</span> <span class="n">contact</span><span class="o">.</span><span class="n">set_keyframe</span><span class="p">(</span><span class="n">value</span> <span class="o">=</span> <span class="n">value</span><span class="p">,</span> <span class="n">time</span> <span class="o">=</span> <span class="n">time</span><span class="p">,</span> <span class="n">name</span> <span class="o">=</span> <span class="n">name</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">get_electrode_contact</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">number</span> <span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ElectrodeSphere</span> <span class="o">|</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Get an electrode contact from the brain.</span>
<span class="sd">        Args:</span>
<span class="sd">            number: The integer number of the electrode contact, starting from 1.</span>
<span class="sd">        Returns:</span>
<span class="sd">            The electrode contact instance or `None` if the electrode contact does not exist.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_electrode_contacts</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">number</span><span class="p">),</span> <span class="kc">None</span><span class="p">)</span>
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">electrode_contacts</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="n">ElectrodeSphere</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Get all electrode contacts from the brain.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_electrode_contacts</span>
    <span class="k">def</span> <span class="nf">clean_electrodes</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Remove all electrode contacts from the brain.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">contact_names</span> <span class="o">=</span> <span class="p">[</span><span class="n">contact</span><span class="o">.</span><span class="n">name</span> <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">contact</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_electrode_contacts</span><span class="o">.</span><span class="n">items</span><span class="p">()]</span>
        <span class="k">for</span> <span class="n">contact_name</span> <span class="ow">in</span> <span class="n">contact_names</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_geoms</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">contact_name</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_electrode_contacts</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">contact_name</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">add_electrodes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">table</span> <span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="n">DataFrame</span><span class="p">,</span> <span class="n">space</span> <span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="s1">&#39;ras&#39;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Add electrodes to the brain.</span>
<span class="sd">        Args:</span>
<span class="sd">            table: A pandas table containing the electrode information, or the path to the table. (See &#39;Details:&#39;)</span>
<span class="sd">            space: The space of the electrode coordinates, default is &quot;ras&quot;.</span>
<span class="sd">        Returns:</span>
<span class="sd">            The number of electrodes added.</span>

<span class="sd">        Details:</span>
<span class="sd">            The table (or table file) must contains at least the following columns (**case-sensitive**):</span>

<span class="sd">            * `Electrode` (int, mandatory): electrode contact number, starting from 1</span>

<span class="sd">            * `Label` (str, mandatory): electrode label string, must not be empty string</span>

<span class="sd">            * `x`, `y`, `z` (float): the coordinates of the electrode contact in the space specified by `space`.</span>

<span class="sd">                If `space` is not specified, then the coordinates are assumed to be in the T1 space (&quot;ras&quot;).</span>

<span class="sd">                &gt; If x=y=z=0, then the electrode will be hidden. (This is the default behavior of R package threeBrain)</span>

<span class="sd">                If `x`, `y`, `z` is not specified, then the following columns will be used in order:</span>

<span class="sd">                * `Coord_x`, `Coord_y`, `Coord_z`: electrode coordinates in tkrRAS space (FreeSurfer space)</span>
<span class="sd">                * `T1R`, `T1A`, `T1S`: electrode coordinates in T1 RAS space (scanner space)</span>
<span class="sd">                * `MNI305_x`, `MNI305_y`, `MNI305_z`: electrode coordinates in MNI305 space</span>
<span class="sd">                * `MNI152_x`, `MNI152_y`, `MNI152_z`: electrode coordinates in MNI152 space</span>

<span class="sd">                The order will be Coord_* &gt; T1* &gt; MNI305_* &gt; MNI152_* to be consistent with R package threeBrain.</span>

<span class="sd">                &gt; xyz in native (subject brain) space and MNI space can co-exist in the same table. In this case,</span>
<span class="sd">                &gt; the native space coordinates will be used to show the electrodes in the native brain,</span>
<span class="sd">                &gt; and the MNI space coordinates will be used to show the electrodes on the template brain.</span>

<span class="sd">            The following columns are optional:</span>

<span class="sd">            * `Radius` (float): the radius of the electrode contact, default is 1.0 for sEEG and 2.0 for ECoG</span>
<span class="sd">            * `Hemisphere` (str, [&quot;auto&quot;, &quot;left&quot;, &quot;right&quot;]): the hemisphere of the electrode contact, default is &quot;auto&quot;</span>
<span class="sd">                If &quot;auto&quot;, then the hemisphere will be determined by the `FSLabel` column.</span>
<span class="sd">            * `Sphere_x`, `Sphere_y`, `Sphere_z` (float): the coordinates of the electrode contact in the sphere space (surface electrodes only)</span>
<span class="sd">            * `SurfaceElectrode` (bool): whether the electrode is a surface electrode, default is False</span>
<span class="sd">            * `FSLabel` (str): the FreeSurfer label of the electrode contact.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="n">space</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">space</span> <span class="o">=</span> <span class="s2">&quot;ras&quot;</span>
        <span class="k">elif</span> <span class="ow">not</span> <span class="n">space</span> <span class="ow">in</span> <span class="n">CONSTANTS</span><span class="o">.</span><span class="n">SUPPORTED_SPACES</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Invalid space: </span><span class="si">{</span><span class="n">space</span><span class="si">}</span><span class="s2">, supported spaces are: </span><span class="si">{</span><span class="n">CONSTANTS</span><span class="o">.</span><span class="n">SUPPORTED_SPACES</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="c1"># table = &quot;/Users/dipterix/Dropbox (PennNeurosurgery)/RAVE/Samples/data/demo/PAV006/rave/meta/electrodes.csv&quot;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">table</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
            <span class="n">table</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">table</span><span class="p">,</span> <span class="n">sep</span> <span class="o">=</span> <span class="s2">&quot;,&quot;</span><span class="p">)</span>
        <span class="c1"># assume table is pandas since we don&#39;t want to import pandas here</span>
        <span class="n">nrows</span> <span class="o">=</span> <span class="n">table</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">valid_length</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">l</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">isfinite</span><span class="p">(</span><span class="n">l</span><span class="p">)</span> <span class="ow">and</span> <span class="n">l</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">l</span> <span class="o">&lt;</span> <span class="mi">500</span>
        <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nrows</span><span class="p">):</span>
            <span class="n">row</span> <span class="o">=</span> <span class="n">table</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span><span class="o">.</span><span class="n">to_dict</span><span class="p">()</span>
            <span class="n">electrode</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="s2">&quot;Electrode&quot;</span><span class="p">]</span>
            <span class="n">label</span> <span class="o">=</span> <span class="n">row</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;Label&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">label</span> <span class="o">==</span> <span class="s2">&quot;&quot;</span><span class="p">:</span>
                <span class="n">label</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;NoLabel</span><span class="si">{</span><span class="w"> </span><span class="n">electrode</span><span class="w"> </span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="n">x</span> <span class="o">=</span> <span class="n">row</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
            <span class="n">y</span> <span class="o">=</span> <span class="n">row</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
            <span class="n">z</span> <span class="o">=</span> <span class="n">row</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;z&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
            <span class="n">xyz</span> <span class="o">=</span> <span class="n">Vec3</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="n">space</span><span class="o">=</span><span class="n">space</span><span class="p">)</span>
            <span class="n">tkr_x</span> <span class="o">=</span> <span class="n">row</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;Coord_x&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
            <span class="n">tkr_y</span> <span class="o">=</span> <span class="n">row</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;Coord_y&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
            <span class="n">tkr_z</span> <span class="o">=</span> <span class="n">row</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;Coord_z&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
            <span class="n">tkr_ras</span> <span class="o">=</span> <span class="n">Vec3</span><span class="p">(</span><span class="n">tkr_x</span><span class="p">,</span> <span class="n">tkr_y</span><span class="p">,</span> <span class="n">tkr_z</span><span class="p">,</span> <span class="n">space</span><span class="o">=</span><span class="s2">&quot;ras_tkr&quot;</span><span class="p">)</span>
            <span class="n">t1_x</span> <span class="o">=</span> <span class="n">row</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;T1R&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
            <span class="n">t1_y</span> <span class="o">=</span> <span class="n">row</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;T1A&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
            <span class="n">t1_z</span> <span class="o">=</span> <span class="n">row</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;T1S&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
            <span class="n">ras</span> <span class="o">=</span> <span class="n">Vec3</span><span class="p">(</span><span class="n">t1_x</span><span class="p">,</span> <span class="n">t1_y</span><span class="p">,</span> <span class="n">t1_z</span><span class="p">,</span> <span class="n">space</span><span class="o">=</span><span class="s2">&quot;ras&quot;</span><span class="p">)</span>
            <span class="n">mni305_x</span> <span class="o">=</span> <span class="n">row</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;MNI305_x&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
            <span class="n">mni305_y</span> <span class="o">=</span> <span class="n">row</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;MNI305_y&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
            <span class="n">mni305_z</span> <span class="o">=</span> <span class="n">row</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;MNI305_z&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
            <span class="n">mni305</span> <span class="o">=</span> <span class="n">Vec3</span><span class="p">(</span><span class="n">mni305_x</span><span class="p">,</span> <span class="n">mni305_y</span><span class="p">,</span> <span class="n">mni305_z</span><span class="p">,</span> <span class="n">space</span><span class="o">=</span><span class="s2">&quot;mni305&quot;</span><span class="p">)</span>
            <span class="n">mni152_x</span> <span class="o">=</span> <span class="n">row</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;MNI152_x&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
            <span class="n">mni152_y</span> <span class="o">=</span> <span class="n">row</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;MNI152_y&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
            <span class="n">mni152_z</span> <span class="o">=</span> <span class="n">row</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;MNI152_z&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
            <span class="n">mni152</span> <span class="o">=</span> <span class="n">Vec3</span><span class="p">(</span><span class="n">mni152_x</span><span class="p">,</span> <span class="n">mni152_y</span><span class="p">,</span> <span class="n">mni152_z</span><span class="p">,</span> <span class="n">space</span><span class="o">=</span><span class="s2">&quot;mni152&quot;</span><span class="p">)</span>
            <span class="n">mni_position</span> <span class="o">=</span> <span class="n">mni305</span>
            <span class="k">if</span> <span class="n">valid_length</span><span class="p">(</span> <span class="n">xyz</span><span class="o">.</span><span class="n">length</span><span class="p">()</span> <span class="p">):</span>
                <span class="n">position</span> <span class="o">=</span> <span class="n">xyz</span>
            <span class="k">elif</span> <span class="n">valid_length</span><span class="p">(</span> <span class="n">tkr_ras</span><span class="o">.</span><span class="n">length</span><span class="p">()</span> <span class="p">):</span>
                <span class="n">position</span> <span class="o">=</span> <span class="n">tkr_ras</span>
            <span class="k">elif</span> <span class="n">valid_length</span><span class="p">(</span> <span class="n">ras</span><span class="o">.</span><span class="n">length</span><span class="p">()</span> <span class="p">):</span>
                <span class="n">position</span> <span class="o">=</span> <span class="n">ras</span>
            <span class="k">elif</span> <span class="n">valid_length</span><span class="p">(</span> <span class="n">mni305</span><span class="o">.</span><span class="n">length</span><span class="p">()</span> <span class="p">):</span>
                <span class="n">position</span> <span class="o">=</span> <span class="n">mni305</span>
            <span class="k">elif</span> <span class="n">valid_length</span><span class="p">(</span> <span class="n">mni152</span><span class="o">.</span><span class="n">length</span><span class="p">()</span> <span class="p">):</span>
                <span class="n">position</span> <span class="o">=</span> <span class="n">mni152</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">position</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">valid_length</span><span class="p">(</span> <span class="n">mni_position</span><span class="o">.</span><span class="n">length</span><span class="p">()</span> <span class="p">):</span>
                <span class="n">mni_position</span> <span class="o">=</span> <span class="n">mni152</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">valid_length</span><span class="p">(</span> <span class="n">mni_position</span><span class="o">.</span><span class="n">length</span><span class="p">()</span> <span class="p">):</span>
                <span class="n">mni_position</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="n">sphere_x</span> <span class="o">=</span> <span class="n">row</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;Sphere_x&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
            <span class="n">sphere_y</span> <span class="o">=</span> <span class="n">row</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;Sphere_y&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
            <span class="n">sphere_z</span> <span class="o">=</span> <span class="n">row</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;Sphere_z&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
            <span class="n">sphere_position</span> <span class="o">=</span> <span class="n">Vec3</span><span class="p">(</span><span class="n">sphere_x</span><span class="p">,</span> <span class="n">sphere_y</span><span class="p">,</span> <span class="n">sphere_z</span><span class="p">,</span> <span class="n">space</span><span class="o">=</span><span class="s2">&quot;sphere&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">valid_length</span><span class="p">(</span> <span class="n">sphere_position</span><span class="o">.</span><span class="n">length</span><span class="p">()</span> <span class="p">):</span>
                <span class="n">sphere_position</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="n">radius</span> <span class="o">=</span> <span class="n">row</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;Radius&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
            <span class="n">is_surface</span> <span class="o">=</span> <span class="n">row</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;SurfaceElectrode&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
            <span class="n">fs_label</span> <span class="o">=</span> <span class="n">row</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;FSLabel&quot;</span><span class="p">,</span> <span class="s2">&quot;Unknown&quot;</span><span class="p">)</span>
            <span class="n">hemisphere</span> <span class="o">=</span> <span class="n">row</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;Hemisphere&quot;</span><span class="p">,</span> <span class="s2">&quot;auto&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">hemisphere</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">hemisphere</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;l&quot;</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">]:</span>
                <span class="n">hemisphere</span> <span class="o">=</span> <span class="s2">&quot;auto&quot;</span>
                <span class="c1"># also guess the hemisphere from the FSLabel</span>
                <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;^(left|(ctx|wm)[_-]lh)&quot;</span><span class="p">,</span> <span class="n">fs_label</span><span class="p">,</span> <span class="n">re</span><span class="o">.</span><span class="n">IGNORECASE</span><span class="p">):</span>
                    <span class="n">hemisphere</span> <span class="o">=</span> <span class="s2">&quot;left&quot;</span>
                <span class="k">elif</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;^(right|(ctx|wm)[_-]rh)&quot;</span><span class="p">,</span> <span class="n">fs_label</span><span class="p">,</span> <span class="n">re</span><span class="o">.</span><span class="n">IGNORECASE</span><span class="p">):</span>
                    <span class="n">hemisphere</span> <span class="o">=</span> <span class="s2">&quot;right&quot;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">hemisphere</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;l&quot;</span><span class="p">:</span>
                    <span class="n">hemisphere</span> <span class="o">=</span> <span class="s2">&quot;left&quot;</span>
                <span class="k">elif</span> <span class="n">hemisphere</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;r&quot;</span><span class="p">:</span>
                    <span class="n">hemisphere</span> <span class="o">=</span> <span class="s2">&quot;right&quot;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">add_electrode_contact</span><span class="p">(</span>
                <span class="n">number</span> <span class="o">=</span> <span class="n">electrode</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="n">label</span><span class="p">,</span> <span class="n">position</span> <span class="o">=</span> <span class="n">position</span><span class="p">,</span>
                <span class="n">is_surface</span> <span class="o">=</span> <span class="n">is_surface</span><span class="p">,</span> <span class="n">radius</span> <span class="o">=</span> <span class="n">radius</span><span class="p">,</span>
                <span class="n">mni_position</span> <span class="o">=</span> <span class="n">mni_position</span><span class="p">,</span> <span class="n">sphere_position</span> <span class="o">=</span> <span class="n">sphere_position</span><span class="p">,</span>
                <span class="n">hemisphere</span> <span class="o">=</span> <span class="n">hemisphere</span><span class="p">)</span>
        <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_electrode_contacts</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">set_electrode_value</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">number</span> <span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">name</span> <span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">value</span> <span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">|</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">|</span> <span class="nb">dict</span> <span class="o">|</span> <span class="nb">float</span> <span class="o">|</span> <span class="nb">str</span><span class="p">,</span> 
                            <span class="n">time</span> <span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">|</span> <span class="nb">float</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">SimpleKeyframe</span> <span class="o">|</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Set value to a electrode contact.</span>
<span class="sd">        Args:</span>
<span class="sd">            number: The electrode contact number.</span>
<span class="sd">            name: The data name of the value.</span>
<span class="sd">            value: The value to set, can be a list of values or a single value.</span>
<span class="sd">            time: The time of the value, can be a list of times (in seconds) or a single time.</span>
<span class="sd">        Returns: </span>
<span class="sd">            The keyframe object or None if the electrode contact is not found.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">contact</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_electrode_contacts</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">number</span><span class="p">),</span> <span class="kc">None</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">contact</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>
        <span class="k">return</span> <span class="n">contact</span><span class="o">.</span><span class="n">set_keyframe</span><span class="p">(</span><span class="n">value</span> <span class="o">=</span> <span class="n">value</span><span class="p">,</span> <span class="n">time</span> <span class="o">=</span> <span class="n">time</span><span class="p">,</span> <span class="n">name</span> <span class="o">=</span> <span class="n">name</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">set_electrode_values</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">table</span> <span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="n">DataFrame</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Set single or multiple values to multiple electrode contacts.</span>
<span class="sd">        Args: </span>
<span class="sd">            table: A pandas or a path to a csv file. The see &#39;Details&#39; for table contents</span>
<span class="sd">        Details:</span>
<span class="sd">            The table (or table file) contains the following columns (**case-sensitive**):</span>

<span class="sd">            * `Electrode` (mandatory): The electrode contact number, starting from 1</span>
<span class="sd">            * `Subject` (optional): The subject code of the value, default is the current subject code</span>
<span class="sd">            * `Time` (optional): The numeric time of the value, in seconds</span>
<span class="sd">            * All other columns: The the column names are the data names of the values, can </span>
<span class="sd">                be combinations of letters `[a-zA-Z]`, numbers `[0-9]`, dots `.`, and underscores `_`</span>
<span class="sd">        Examples:</span>
<span class="sd">            The minimal table contains only the electrode contact number and the value:</span>

<span class="sd">            | Electrode | brain.response |</span>
<span class="sd">            |-----------|----------------|</span>
<span class="sd">            | 1         | 0.1            |</span>
<span class="sd">            | 2         | 0.2            |</span>
<span class="sd">            | 3         | 0.3            |</span>


<span class="sd">            Here&#39;s an example of the table with two variables `brain.response` and `classifier`, </span>
<span class="sd">            and two electrodes `1` and `2`. The time range is `0~1` seconds.</span>

<span class="sd">            | Electrode | Time | brain.response | classifier |</span>
<span class="sd">            |-----------|------|----------------|------------|</span>
<span class="sd">            | 1         | 0    | 0.1            | A          |</span>
<span class="sd">            | 1         | 1    | 0.2            | A          |</span>
<span class="sd">            | 2         | 0    | 0.3            | A          |</span>
<span class="sd">            | 2         | 1    | 0.4            | B          |</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">table</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="c1"># table = &quot;/Users/dipterix/rave_data/data_dir/demo/DemoSubject/rave/meta/electrodes.csv&quot;</span>
            <span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
            <span class="n">table</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">table</span><span class="p">,</span> <span class="n">sep</span> <span class="o">=</span> <span class="s2">&quot;,&quot;</span><span class="p">)</span>
        <span class="c1"># assume table is pandas since we don&#39;t want to import pandas here</span>
        <span class="k">if</span> <span class="s2">&quot;Electrode&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">table</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">LookupError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Invalid table, must contain column &#39;Electrode&#39;.&quot;</span><span class="p">)</span>
        <span class="n">time</span> <span class="o">=</span> <span class="n">table</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;Time&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="n">subjects</span> <span class="o">=</span> <span class="n">table</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;Subject&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="n">electrodes</span> <span class="o">=</span> <span class="n">table</span><span class="p">[</span><span class="s2">&quot;Electrode&quot;</span><span class="p">]</span>
        <span class="n">electrode_numbers</span> <span class="o">=</span> <span class="n">electrodes</span><span class="o">.</span><span class="n">unique</span><span class="p">()</span>
        <span class="n">var_names</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">table</span><span class="o">.</span><span class="n">columns</span> <span class="k">if</span> <span class="n">x</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;Electrode&quot;</span><span class="p">,</span> <span class="s2">&quot;Time&quot;</span><span class="p">]]</span>
        <span class="k">if</span> <span class="n">subjects</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">subjects</span> <span class="o">=</span> <span class="n">subjects</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">subject_code</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">subjects</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">for</span> <span class="n">electrode</span> <span class="ow">in</span> <span class="n">electrode_numbers</span><span class="p">:</span>
            <span class="n">sel</span> <span class="o">=</span> <span class="p">(</span><span class="n">electrodes</span> <span class="o">==</span> <span class="n">electrode</span><span class="p">)</span> <span class="o">&amp;</span> <span class="n">subjects</span>
            <span class="k">if</span> <span class="n">sel</span><span class="o">.</span><span class="n">size</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">sel</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">var_names</span><span class="p">:</span>
                    <span class="n">keyframe</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">set_electrode_value</span><span class="p">(</span>
                        <span class="n">number</span> <span class="o">=</span> <span class="n">electrode</span><span class="p">,</span> <span class="n">name</span> <span class="o">=</span> <span class="n">name</span><span class="p">,</span> <span class="n">value</span> <span class="o">=</span> <span class="n">table</span><span class="p">[</span><span class="n">name</span><span class="p">][</span><span class="n">sel</span><span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">(),</span> 
                        <span class="n">time</span> <span class="o">=</span> <span class="kc">None</span> <span class="k">if</span> <span class="n">time</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">time</span><span class="p">[</span><span class="n">sel</span><span class="p">])</span>
                    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">keyframe</span><span class="p">,</span> <span class="n">SimpleKeyframe</span><span class="p">):</span>
                        <span class="c1"># get colormap</span>
                        <span class="n">colormap</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_electrode_cmaps</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
                        <span class="k">if</span> <span class="n">colormap</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                            <span class="n">colormap</span> <span class="o">=</span> <span class="n">ElectrodeColormap</span><span class="p">(</span><span class="n">keyframe_name</span> <span class="o">=</span> <span class="n">keyframe</span><span class="p">,</span> <span class="n">value_type</span> <span class="o">=</span> <span class="s2">&quot;continuous&quot;</span> <span class="k">if</span> <span class="n">keyframe</span><span class="o">.</span><span class="n">is_continuous</span> <span class="k">else</span> <span class="s2">&quot;discrete&quot;</span><span class="p">)</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">_electrode_cmaps</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">colormap</span>
                        <span class="n">colormap</span><span class="o">.</span><span class="n">update_from_keyframe</span><span class="p">(</span> <span class="n">keyframe</span> <span class="o">=</span> <span class="n">keyframe</span> <span class="p">)</span>
        <span class="k">return</span> 
    <span class="k">def</span> <span class="nf">get_electrode_colormap</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span> <span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ElectrodeColormap</span> <span class="o">|</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Get the colormap of an electrode contact.</span>
<span class="sd">        Args:</span>
<span class="sd">            name: The name of the electrode keyframe (which is also the color-map name).</span>
<span class="sd">        Returns:</span>
<span class="sd">            The colormap instance or `None` if the colormap does not exist.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_electrode_cmaps</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
    <span class="c1"># endregion</span>

    <span class="k">def</span> <span class="nf">to_dict</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Convert the brain to a dict.</span>
<span class="sd">        Returns: </span>
<span class="sd">            A dict containing the brain data.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="c1"># global_data needs to be rebuilt</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_globals</span><span class="o">.</span><span class="n">set_group_data</span><span class="p">(</span>
            <span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;subject_data&quot;</span><span class="p">,</span> 
            <span class="n">is_cache</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
            <span class="n">value</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s1">&#39;subject_code&#39;</span> <span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">subject_code</span><span class="p">,</span>
                <span class="s1">&#39;Norig&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">vox2ras</span><span class="o">.</span><span class="n">mat</span><span class="o">.</span><span class="n">tolist</span><span class="p">(),</span>
                <span class="s1">&#39;Torig&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">vox2ras_tkr</span><span class="o">.</span><span class="n">mat</span><span class="o">.</span><span class="n">tolist</span><span class="p">(),</span>
                <span class="s1">&#39;xfm&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">ras2mni_305</span><span class="o">.</span><span class="n">mat</span><span class="o">.</span><span class="n">tolist</span><span class="p">(),</span>
                <span class="c1"># FreeSurfer RAS to MNI305, should be ras_tkr2mni_305, but for compatibility, vox2vox_MNI305</span>
                <span class="s1">&#39;vox2vox_MNI305&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">ras_tkr2mni_305</span><span class="o">.</span><span class="n">mat</span><span class="o">.</span><span class="n">tolist</span><span class="p">(),</span>
                <span class="c1"># -(self$Norig %*% solve( self$Torig ) %*% c(0,0,0,1))[1:3]</span>
                <span class="s1">&#39;volume_types&#39;</span> <span class="p">:</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_slices</span><span class="o">.</span><span class="n">keys</span><span class="p">()),</span>
                <span class="s1">&#39;atlas_types&#39;</span> <span class="p">:</span> <span class="p">[],</span> <span class="c1"># self._atlases.keys()</span>
            <span class="p">})</span>
        <span class="n">geom_list</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">group_list</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">geom</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_geoms</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">geom_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">geom</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">group</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_groups</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">group_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">group</span><span class="p">)</span>
        <span class="c1"># The config file should contain groups and geoms</span>
        <span class="k">return</span> <span class="p">{</span>
            <span class="s1">&#39;subject_code&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">subject_code</span><span class="p">,</span>
            <span class="s1">&#39;storage&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">storage</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
            <span class="s1">&#39;path&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="p">,</span>
            <span class="s2">&quot;settings&quot;</span><span class="p">:</span> <span class="p">{},</span>
            <span class="s2">&quot;groups&quot;</span><span class="p">:</span> <span class="n">group_list</span><span class="p">,</span>
            <span class="s2">&quot;geoms&quot;</span><span class="p">:</span> <span class="n">geom_list</span><span class="p">,</span>
        <span class="p">}</span>
    <span class="k">def</span> <span class="nf">build</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span> <span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">dry_run</span> <span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Build the brain cache. If `path` is not specified, the cache will be built under the temporary directory.</span>
<span class="sd">        Args:</span>
<span class="sd">            path: The path to build the cache; default is using the `self._storage` path.</span>
<span class="sd">            dry_run: If True, the cache will not be built, instead, the build process will be printed to the console.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">config</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">to_dict</span><span class="p">()</span>
        <span class="c1"># Needs to generate a global data dict to include all global data for compatibility</span>
        <span class="n">build_global</span> <span class="o">=</span> <span class="n">BlankPlaceholder</span><span class="p">(</span><span class="n">brain</span> <span class="o">=</span> <span class="bp">self</span><span class="p">,</span> <span class="n">is_global</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
        <span class="n">build_group</span> <span class="o">=</span> <span class="n">GeomWrapper</span><span class="p">(</span><span class="n">brain</span> <span class="o">=</span> <span class="bp">self</span><span class="p">,</span> <span class="n">name</span> <span class="o">=</span> <span class="n">build_global</span><span class="o">.</span><span class="n">group_name</span><span class="p">)</span>
        <span class="n">config</span><span class="p">[</span><span class="s1">&#39;geoms&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">build_global</span><span class="p">)</span>
        <span class="n">config</span><span class="p">[</span><span class="s1">&#39;groups&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">build_group</span><span class="p">)</span>
        <span class="n">build_group</span><span class="o">.</span><span class="n">set_group_data</span><span class="p">(</span><span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;__global_data__.subject_codes&#39;</span><span class="p">,</span> <span class="n">value</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">subject_code</span><span class="p">],</span> <span class="n">is_cache</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span>

        <span class="c1"># Construct colormaps</span>
        <span class="n">cmaps</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">colormap</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_electrode_cmaps</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">cmap_data</span> <span class="o">=</span> <span class="n">colormap</span><span class="o">.</span><span class="n">to_dict</span><span class="p">()</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">cmap_data</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
                <span class="n">cmaps</span><span class="p">[</span> <span class="n">colormap</span><span class="o">.</span><span class="n">name</span> <span class="p">]</span> <span class="o">=</span> <span class="n">cmap_data</span>
        <span class="n">default_cmap</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">cmaps</span><span class="o">.</span><span class="n">keys</span><span class="p">())[</span><span class="mi">0</span><span class="p">]</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">cmaps</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="kc">None</span>

        <span class="c1"># Hard-code for now</span>
        <span class="n">build_group</span><span class="o">.</span><span class="n">set_group_data</span><span class="p">(</span>
            <span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;__global_data__.SurfaceColorLUT&#39;</span><span class="p">,</span> 
            <span class="n">value</span> <span class="o">=</span> <span class="n">template_path</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;lib/threeBrain_data-0/</span><span class="si">{</span><span class="w"> </span><span class="n">build_group</span><span class="o">.</span><span class="n">cache_name</span><span class="w"> </span><span class="si">}</span><span class="s2">/ContinuousSample.json&quot;</span><span class="p">),</span>
            <span class="n">is_cache</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="p">)</span>
        <span class="n">build_group</span><span class="o">.</span><span class="n">set_group_data</span><span class="p">(</span>
            <span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;__global_data__.VolumeColorLUT&#39;</span><span class="p">,</span> 
            <span class="n">value</span> <span class="o">=</span> <span class="n">template_path</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;lib/threeBrain_data-0/</span><span class="si">{</span><span class="w"> </span><span class="n">build_group</span><span class="o">.</span><span class="n">cache_name</span><span class="w"> </span><span class="si">}</span><span class="s2">/FreeSurferColorLUT.json&quot;</span><span class="p">),</span>
            <span class="n">is_cache</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="p">)</span>
        <span class="n">build_group</span><span class="o">.</span><span class="n">set_group_data</span><span class="p">(</span>
            <span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;__global_data__.FSColorLUT&#39;</span><span class="p">,</span> 
            <span class="n">value</span> <span class="o">=</span> <span class="n">template_path</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;lib/threeBrain_data-0/</span><span class="si">{</span><span class="w"> </span><span class="n">build_group</span><span class="o">.</span><span class="n">cache_name</span><span class="w"> </span><span class="si">}</span><span class="s2">/FSColorLUT.json&quot;</span><span class="p">),</span>
            <span class="n">is_cache</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="p">)</span>

        <span class="n">settings</span> <span class="o">=</span> <span class="n">config</span><span class="p">[</span><span class="s1">&#39;settings&#39;</span><span class="p">]</span>
        <span class="n">settings</span><span class="p">[</span><span class="s1">&#39;title&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        <span class="n">settings</span><span class="p">[</span><span class="s1">&#39;side_camera&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="n">settings</span><span class="p">[</span><span class="s1">&#39;side_canvas_zoom&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="n">settings</span><span class="p">[</span><span class="s1">&#39;side_canvas_width&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">250</span>
        <span class="n">settings</span><span class="p">[</span><span class="s1">&#39;side_canvas_shift&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
        <span class="n">settings</span><span class="p">[</span><span class="s1">&#39;color_maps&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">cmaps</span>
        <span class="n">settings</span><span class="p">[</span><span class="s1">&#39;default_colormap&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">default_cmap</span>
        <span class="n">settings</span><span class="p">[</span><span class="s1">&#39;hide_controls&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">settings</span><span class="p">[</span><span class="s1">&#39;control_center&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
        <span class="n">settings</span><span class="p">[</span><span class="s1">&#39;camera_pos&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="mi">500</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
        <span class="n">settings</span><span class="p">[</span><span class="s1">&#39;font_magnification&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="n">settings</span><span class="p">[</span><span class="s1">&#39;start_zoom&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="n">settings</span><span class="p">[</span><span class="s1">&#39;show_legend&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="n">settings</span><span class="p">[</span><span class="s1">&#39;render_timestamp&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="n">settings</span><span class="p">[</span><span class="s1">&#39;control_presets&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span>
            <span class="s2">&quot;subject2&quot;</span><span class="p">,</span> <span class="s2">&quot;surface_type2&quot;</span><span class="p">,</span> <span class="s2">&quot;hemisphere_material&quot;</span><span class="p">,</span> <span class="s2">&quot;surface_color&quot;</span><span class="p">,</span> <span class="s2">&quot;map_template&quot;</span><span class="p">,</span>
            <span class="s2">&quot;electrodes&quot;</span><span class="p">,</span> <span class="s2">&quot;voxel&quot;</span><span class="p">,</span> <span class="s2">&quot;animation&quot;</span><span class="p">,</span> <span class="s2">&quot;display_highlights&quot;</span>
        <span class="p">]</span>
        <span class="n">settings</span><span class="p">[</span><span class="s1">&#39;cache_folder&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;lib/threebrain_data-0/&quot;</span>
        <span class="n">settings</span><span class="p">[</span><span class="s1">&#39;lib_path&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;lib/&quot;</span>
        <span class="n">settings</span><span class="p">[</span><span class="s1">&#39;default_controllers&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">settings</span><span class="p">[</span><span class="s1">&#39;debug&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">settings</span><span class="p">[</span><span class="s1">&#39;background&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;#FFFFFF&quot;</span>
        <span class="n">settings</span><span class="p">[</span><span class="s1">&#39;token&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">settings</span><span class="p">[</span><span class="s1">&#39;show_inactive_electrodes&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="n">settings</span><span class="p">[</span><span class="s1">&#39;side_display&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="n">settings</span><span class="p">[</span><span class="s1">&#39;control_display&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="n">settings</span><span class="p">[</span><span class="s1">&#39;custom_javascript&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="c1"># write files</span>
        <span class="c1"># dry_run = False</span>
        <span class="c1"># path=os.path.join(ensure_default_temporary_directory(), &quot;test&quot;)</span>
        <span class="k">if</span> <span class="n">path</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_storage</span><span class="o">.</span><span class="n">name</span>
        <span class="n">init_skeleton</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">dry_run</span> <span class="o">=</span> <span class="n">dry_run</span><span class="p">)</span>
        <span class="c1"># for each group data, check if is_cache, if so, copy the file to the cache folder</span>
        <span class="k">for</span> <span class="n">group</span> <span class="ow">in</span> <span class="n">config</span><span class="p">[</span><span class="s1">&#39;groups&#39;</span><span class="p">]:</span>
            <span class="n">group</span><span class="o">.</span><span class="n">build</span><span class="p">(</span><span class="n">path</span> <span class="o">=</span> <span class="n">path</span><span class="p">,</span> <span class="n">dry_run</span> <span class="o">=</span> <span class="n">dry_run</span><span class="p">)</span>
        <span class="c1"># construct config.json</span>
        <span class="n">config_fname</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;config_</span><span class="si">{</span><span class="n">rand_string</span><span class="p">(</span><span class="mi">16</span><span class="p">)</span><span class="si">}</span><span class="s2">.json&quot;</span>
        <span class="k">if</span> <span class="n">dry_run</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Writing </span><span class="si">{</span><span class="n">config_fname</span><span class="si">}</span><span class="s2">...&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="kn">import</span> <span class="nn">json</span>
            <span class="n">s</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">({</span>
                <span class="s2">&quot;groups&quot;</span><span class="p">:</span> <span class="n">config</span><span class="p">[</span><span class="s1">&#39;groups&#39;</span><span class="p">],</span>
                <span class="s2">&quot;geoms&quot;</span><span class="p">:</span> <span class="n">config</span><span class="p">[</span><span class="s1">&#39;geoms&#39;</span><span class="p">],</span>
            <span class="p">},</span> <span class="bp">cls</span> <span class="o">=</span> <span class="n">GeomEncoder</span><span class="p">)</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="s2">&quot;lib&quot;</span><span class="p">,</span> <span class="s2">&quot;threebrain_data-0&quot;</span><span class="p">,</span> <span class="n">config_fname</span><span class="p">),</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>

        <span class="n">widget_data</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;data_filename&#39;</span> <span class="p">:</span> <span class="n">config_fname</span><span class="p">,</span>
            <span class="s2">&quot;force_render&quot;</span><span class="p">:</span><span class="kc">True</span><span class="p">,</span>
            <span class="s1">&#39;settings&#39;</span> <span class="p">:</span> <span class="n">settings</span><span class="p">,</span>
        <span class="p">}</span>

        <span class="c1"># construct index.html</span>
        <span class="k">if</span> <span class="n">dry_run</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Writing index.html...&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">template_path</span><span class="p">(</span><span class="s2">&quot;index.html&quot;</span><span class="p">),</span> <span class="s2">&quot;r&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                <span class="n">index_content</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">readlines</span><span class="p">())</span>
            <span class="n">index_content</span> <span class="o">=</span> <span class="n">index_content</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;WIDGET_ID&quot;</span><span class="p">,</span> <span class="s2">&quot;threebrainpy-viewer&quot;</span><span class="p">)</span>
            <span class="n">index_content</span> <span class="o">=</span> <span class="n">index_content</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span>
                <span class="s2">&quot;WIDGET_DATA&quot;</span><span class="p">,</span>
                <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">({</span>
                    <span class="s1">&#39;x&#39;</span> <span class="p">:</span> <span class="n">widget_data</span><span class="p">,</span>
                    <span class="s2">&quot;evals&quot;</span><span class="p">:[],</span><span class="s2">&quot;jsHooks&quot;</span><span class="p">:[]</span>
                <span class="p">},</span> <span class="bp">cls</span> <span class="o">=</span> <span class="n">GeomEncoder</span><span class="p">)</span>
            <span class="p">)</span>
            <span class="n">index_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="s2">&quot;index.html&quot;</span><span class="p">)</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">index_path</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">index_content</span><span class="p">)</span>
        <span class="c1"># set global data</span>
        <span class="c1"># dict_keys([&#39;__global_data__DemoSubject&#39;, &#39;__global_data__.VolumeColorLUT&#39;, &#39;__global_data__.FSColorLUT&#39;])</span>
        <span class="c1"># config[&#39;groups&#39;][0][&#39;group_data&#39;][&#39;__global_data__DemoSubject&#39;]</span>
        <span class="k">return</span> <span class="n">widget_data</span>

    <span class="k">def</span> <span class="nf">render</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">launch_browser</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">host</span> <span class="o">=</span> <span class="s2">&quot;localhost&quot;</span><span class="p">,</span> <span class="n">port</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span> <span class="p">:</span> <span class="nb">dict</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Render the brain cache. If `path` is not specified, the cache will be rendered under the temporary directory.</span>
<span class="sd">        Args:</span>
<span class="sd">            path: The path to render the cache; default is using the `self._storage` path.</span>
<span class="sd">            kwargs: Other arguments to be passed to `subprocess.call`.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">build</span><span class="p">(</span><span class="n">dry_run</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">path</span><span class="o">=</span><span class="n">ensure_temporary_directory</span><span class="p">(</span><span class="s2">&quot;_threebrainpy-viewers&quot;</span><span class="p">),</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;dry_run&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">):</span>
            <span class="n">server</span> <span class="o">=</span> <span class="n">start_service</span><span class="p">(</span><span class="n">host</span> <span class="o">=</span> <span class="n">host</span><span class="p">,</span> <span class="n">port</span> <span class="o">=</span> <span class="n">port</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;[threebrainpy] viewer is running at: http://</span><span class="si">{}</span><span class="s2">:</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">server</span><span class="o">.</span><span class="n">host</span><span class="p">,</span> <span class="n">server</span><span class="o">.</span><span class="n">port</span><span class="p">))</span>
            <span class="k">if</span> <span class="n">launch_browser</span><span class="p">:</span>
                <span class="n">server</span><span class="o">.</span><span class="n">browse</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
            </details>

  

  <div class="doc doc-children">







<div class="doc doc-object doc-attribute">




<h2 id="threebrainpy.core.brain.Brain.electrode_contacts" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">electrode_contacts</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="n">ElectrodeSphere</span><span class="p">]</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

</h2>


  <div class="doc doc-contents ">
  
      <p>Get all electrode contacts from the brain.</p>
  </div>

</div>

<div class="doc doc-object doc-attribute">




<h2 id="threebrainpy.core.brain.Brain.path" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">path</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

</h2>


  <div class="doc doc-contents ">
  
      <p>The root path to the imaging files.</p>
  </div>

</div>

<div class="doc doc-object doc-attribute">




<h2 id="threebrainpy.core.brain.Brain.path_mri" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">path_mri</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

</h2>


  <div class="doc doc-contents ">
  
      <p>The path to the MRI and atlas files.</p>
  </div>

</div>

<div class="doc doc-object doc-attribute">




<h2 id="threebrainpy.core.brain.Brain.path_surf" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">path_surf</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

</h2>


  <div class="doc doc-contents ">
  
      <p>The path to the surface mesh files.</p>
  </div>

</div>

<div class="doc doc-object doc-attribute">




<h2 id="threebrainpy.core.brain.Brain.ras2mni_152" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">ras2mni_152</span><span class="p">:</span> <span class="n">Mat44</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

</h2>


  <div class="doc doc-contents ">
  
      <p>A <code>4x4</code> transform matrix from T1 scanner RAS (right-anterior-superior coordinate) to MNI152 template space using FreeSurfer affine transform (generated during <code>recon-all</code>).</p>
  </div>

</div>

<div class="doc doc-object doc-attribute">




<h2 id="threebrainpy.core.brain.Brain.ras2mni_305" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">ras2mni_305</span><span class="p">:</span> <span class="n">Mat44</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

</h2>


  <div class="doc doc-contents ">
  
      <p>A <code>4x4</code> transform matrix from T1 scanner RAS (right-anterior-superior coordinate) to MNI305 template space using FreeSurfer affine transform (generated during <code>recon-all</code>).</p>
  </div>

</div>

<div class="doc doc-object doc-attribute">




<h2 id="threebrainpy.core.brain.Brain.ras2ras_tkr" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">ras2ras_tkr</span><span class="p">:</span> <span class="n">Mat44</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

</h2>


  <div class="doc doc-contents ">
  
      <p>A <code>4x4</code> T1 scanner RAS (right-anterior-superior coordinate) to viewer (or FreeSurfer tk-registered) tkrRAS transform matrix.</p>
  </div>

</div>

<div class="doc doc-object doc-attribute">




<h2 id="threebrainpy.core.brain.Brain.ras_tkr2mni_152" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">ras_tkr2mni_152</span><span class="p">:</span> <span class="n">Mat44</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

</h2>


  <div class="doc doc-contents ">
  
      <p>A <code>4x4</code> transform matrix from tkrRAS to MNI152 template space using FreeSurfer affine transform (generated during <code>recon-all</code>).</p>
  </div>

</div>

<div class="doc doc-object doc-attribute">




<h2 id="threebrainpy.core.brain.Brain.ras_tkr2mni_305" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">ras_tkr2mni_305</span><span class="p">:</span> <span class="n">Mat44</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

</h2>


  <div class="doc doc-contents ">
  
      <p>A <code>4x4</code> transform matrix from tkrRAS to MNI305 template space using FreeSurfer affine transform (generated during <code>recon-all</code>).</p>
  </div>

</div>

<div class="doc doc-object doc-attribute">




<h2 id="threebrainpy.core.brain.Brain.storage" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">storage</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

</h2>


  <div class="doc doc-contents ">
  
      <p>The path to a temporary directory for storing intermediate files and viewers.</p>
  </div>

</div>

<div class="doc doc-object doc-attribute">




<h2 id="threebrainpy.core.brain.Brain.subject_code" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">subject_code</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

</h2>


  <div class="doc doc-contents ">
  
      <p>Subject code string.</p>
  </div>

</div>

<div class="doc doc-object doc-attribute">




<h2 id="threebrainpy.core.brain.Brain.vox2ras" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">vox2ras</span><span class="p">:</span> <span class="n">Mat44</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

</h2>


  <div class="doc doc-contents ">
  
      <p>A <code>4x4</code> voxel (indexing) to T1 scanner RAS (right-anterior-superior coordinate) transform matrix.</p>
  </div>

</div>

<div class="doc doc-object doc-attribute">




<h2 id="threebrainpy.core.brain.Brain.vox2ras_tkr" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">vox2ras_tkr</span><span class="p">:</span> <span class="n">Mat44</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

</h2>


  <div class="doc doc-contents ">
  
      <p>A <code>4x4</code> voxel (indexing) to viewer (or FreeSurfer) tkrRAS (tk-registered right-anterior-superior coordinate) transform matrix.</p>
  </div>

</div>




<div class="doc doc-object doc-function">




<h2 id="threebrainpy.core.brain.Brain.__init__" class="doc doc-heading">
          <code class="highlight language-python"><span class="fm">__init__</span><span class="p">(</span><span class="n">subject_code</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="n">work_dir</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>Constructor for Brain.
Args:
    subject_code: The subject code of the brain.
    path: The path to the FreeSurfer or FreeSurfer-like folder (with MRI stored at <code>mri</code> and surfaces at <code>surf</code>).
    work_dir: The path to the working directory. If not specified, a temporary directory will be created.</p>

          <details class="quote">
            <summary>Source code in <code>threebrainpy/core/brain.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">subject_code</span> <span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">path</span> <span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">work_dir</span> <span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;Constructor for Brain.</span>
<span class="sd">    Args:</span>
<span class="sd">        subject_code: The subject code of the brain.</span>
<span class="sd">        path: The path to the FreeSurfer or FreeSurfer-like folder (with MRI stored at `mri` and surfaces at `surf`).</span>
<span class="sd">        work_dir: The path to the working directory. If not specified, a temporary directory will be created.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">FileNotFoundError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Brain path </span><span class="si">{</span><span class="n">path</span><span class="si">}</span><span class="s2"> not found.&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;^[a-zA-Z][a-zA-Z0-9_-]{0,}$&quot;</span><span class="p">,</span> <span class="n">subject_code</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Invalid subject code: </span><span class="si">{</span><span class="n">subject_code</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_subject_code</span> <span class="o">=</span> <span class="n">subject_code</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_template_subject</span> <span class="o">=</span> <span class="s2">&quot;N27&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_storage</span> <span class="o">=</span> <span class="n">temporary_directory</span><span class="p">(</span><span class="n">prefix</span> <span class="o">=</span> <span class="n">subject_code</span><span class="p">)</span>
    <span class="c1"># set up geoms</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_groups</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_geoms</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_slices</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_surfaces</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_volumes</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_electrode_contacts</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_electrode_cmaps</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="c1"># set up global data, this must run prior to _update_matrices</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_initialize_global_data</span><span class="p">()</span>
    <span class="c1"># Basic information </span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_vox2ras</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_vox2ras_tkr</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_ras2mni_305</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="c1"># using CONSTANT.DEFAULT_SLICE_PREFIXIES and CONSTANT.DEFAULT_ATLAS_PREFIXIES to find the matrices</span>
    <span class="n">volume_prefixies</span> <span class="o">=</span> <span class="p">[</span><span class="o">*</span><span class="n">CONSTANTS</span><span class="o">.</span><span class="n">DEFAULT_SLICE_PREFIXIES</span><span class="p">,</span> <span class="o">*</span><span class="n">CONSTANTS</span><span class="o">.</span><span class="n">DEFAULT_ATLAS_PREFIXIES</span><span class="p">]</span>
    <span class="n">mgz_files</span> <span class="o">=</span> <span class="p">[</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">x</span><span class="si">}</span><span class="s2">.mgz&quot;</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">volume_prefixies</span><span class="p">]</span>
    <span class="n">nii_gz_files</span> <span class="o">=</span> <span class="p">[</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">x</span><span class="si">}</span><span class="s2">.nii.gz&quot;</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">volume_prefixies</span><span class="p">]</span>
    <span class="n">nii_files</span> <span class="o">=</span> <span class="p">[</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">x</span><span class="si">}</span><span class="s2">.nii&quot;</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">volume_prefixies</span><span class="p">]</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_update_matrices</span><span class="p">(</span><span class="n">volume_files</span> <span class="o">=</span> <span class="p">[</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">path_mri</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="p">[</span><span class="o">*</span><span class="n">mgz_files</span><span class="p">,</span> <span class="o">*</span><span class="n">nii_gz_files</span><span class="p">,</span> <span class="o">*</span><span class="n">nii_files</span><span class="p">]])</span>
    <span class="c1"># get ras to mni-305 matrix</span>
    <span class="n">xfm_file</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">path_mri</span><span class="p">,</span> <span class="s2">&quot;transforms&quot;</span><span class="p">,</span> <span class="s2">&quot;talairach.xfm&quot;</span><span class="p">)</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">xfm</span> <span class="o">=</span> <span class="n">read_xfm</span><span class="p">(</span><span class="n">xfm_file</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_ras2mni_305</span> <span class="o">=</span> <span class="n">Mat44</span><span class="p">(</span><span class="n">xfm</span><span class="p">[</span><span class="s1">&#39;transform&#39;</span><span class="p">],</span> <span class="n">space_from</span><span class="o">=</span><span class="n">xfm</span><span class="p">[</span><span class="s1">&#39;space_from&#39;</span><span class="p">],</span> <span class="n">space_to</span><span class="o">=</span><span class="n">xfm</span><span class="p">[</span><span class="s1">&#39;space_to&#39;</span><span class="p">])</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_ras2mni_305</span> <span class="o">=</span> <span class="n">Mat44</span><span class="p">(</span><span class="n">space_from</span><span class="o">=</span><span class="s2">&quot;ras&quot;</span><span class="p">,</span> <span class="n">space_to</span><span class="o">=</span><span class="s2">&quot;mni305&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">




<h2 id="threebrainpy.core.brain.Brain.add_electrode_contact" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">add_electrode_contact</span><span class="p">(</span><span class="n">number</span><span class="p">,</span> <span class="n">label</span><span class="p">,</span> <span class="n">position</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">is_surface</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">radius</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">mni_position</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">sphere_position</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>Add an electrode contact to the brain. The electrode contact will be rendered in main canvas using sphere (JavaScript class).
Args:
    number: The integer number of the electrode contact, starting from 1.
    label: The label of the electrode contact.
    position: The position of the electrode contact in the native space of the brain, or a <code>Vec3</code> instance with given spaces.
    is_surface: Whether the electrode contact is a surface electrode.
    radius: The radius of the electrode contact, default is 2.0 for surface electrodes and 1.0 for depth electrodes.
    mni_position: The position of the electrode contact in MNI space, overrides the default affine MNI calculation; 
        often used if you have advanced/more accurate MNI estimation
    sphere_position: The position of the electrode contact in the sphere space; surface electrodes only.
    kwargs: Other arguments to be passed to <code>ElectrodeSphere</code>.
Returns:
    The electrode contact instance.
Examples:
    Adds an electrode contact to the brain
    &gt;&gt;&gt; e1 = brain.add_electrode_contact(number = 1, label = "LA1", position = [35,10,10], is_surface = False)
    &gt;&gt;&gt; e1.get_position("ras")
    Vec3(35.0, 10.0, 10.0) [ras]
    &gt;&gt;&gt; e2 = brain.add_electrode_contact(number = 2, label = "LA2", position = Vec3([5,10,10], space = "voxel"), is_surface = False)
    &gt;&gt;&gt; # Automatically transform position to RAS space
    &gt;&gt;&gt; e2.get_position("ras")
    Vec3(126.61447143554688, -117.5, 117.5) [ras]</p>

          <details class="quote">
            <summary>Source code in <code>threebrainpy/core/brain.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">629</span>
<span class="normal">630</span>
<span class="normal">631</span>
<span class="normal">632</span>
<span class="normal">633</span>
<span class="normal">634</span>
<span class="normal">635</span>
<span class="normal">636</span>
<span class="normal">637</span>
<span class="normal">638</span>
<span class="normal">639</span>
<span class="normal">640</span>
<span class="normal">641</span>
<span class="normal">642</span>
<span class="normal">643</span>
<span class="normal">644</span>
<span class="normal">645</span>
<span class="normal">646</span>
<span class="normal">647</span>
<span class="normal">648</span>
<span class="normal">649</span>
<span class="normal">650</span>
<span class="normal">651</span>
<span class="normal">652</span>
<span class="normal">653</span>
<span class="normal">654</span>
<span class="normal">655</span>
<span class="normal">656</span>
<span class="normal">657</span>
<span class="normal">658</span>
<span class="normal">659</span>
<span class="normal">660</span>
<span class="normal">661</span>
<span class="normal">662</span>
<span class="normal">663</span>
<span class="normal">664</span>
<span class="normal">665</span>
<span class="normal">666</span>
<span class="normal">667</span>
<span class="normal">668</span>
<span class="normal">669</span>
<span class="normal">670</span>
<span class="normal">671</span>
<span class="normal">672</span>
<span class="normal">673</span>
<span class="normal">674</span>
<span class="normal">675</span>
<span class="normal">676</span>
<span class="normal">677</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">add_electrode_contact</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">number</span> <span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">label</span> <span class="p">:</span> <span class="nb">str</span><span class="p">,</span> 
        <span class="n">position</span> <span class="p">:</span> <span class="n">Vec3</span> <span class="o">|</span> <span class="nb">list</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> 
        <span class="n">is_surface</span> <span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> 
        <span class="n">radius</span> <span class="p">:</span> <span class="nb">float</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">mni_position</span> <span class="p">:</span> <span class="n">Vec3</span> <span class="o">|</span> <span class="nb">list</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> 
        <span class="n">sphere_position</span> <span class="p">:</span> <span class="n">Vec3</span> <span class="o">|</span> <span class="nb">list</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="o">**</span><span class="n">kwargs</span> <span class="p">:</span> <span class="nb">dict</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ElectrodeSphere</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Add an electrode contact to the brain. The electrode contact will be rendered in main canvas using sphere (JavaScript class).</span>
<span class="sd">    Args:</span>
<span class="sd">        number: The integer number of the electrode contact, starting from 1.</span>
<span class="sd">        label: The label of the electrode contact.</span>
<span class="sd">        position: The position of the electrode contact in the native space of the brain, or a `Vec3` instance with given spaces.</span>
<span class="sd">        is_surface: Whether the electrode contact is a surface electrode.</span>
<span class="sd">        radius: The radius of the electrode contact, default is 2.0 for surface electrodes and 1.0 for depth electrodes.</span>
<span class="sd">        mni_position: The position of the electrode contact in MNI space, overrides the default affine MNI calculation; </span>
<span class="sd">            often used if you have advanced/more accurate MNI estimation</span>
<span class="sd">        sphere_position: The position of the electrode contact in the sphere space; surface electrodes only.</span>
<span class="sd">        kwargs: Other arguments to be passed to `ElectrodeSphere`.</span>
<span class="sd">    Returns:</span>
<span class="sd">        The electrode contact instance.</span>
<span class="sd">    Examples:</span>
<span class="sd">        Adds an electrode contact to the brain</span>
<span class="sd">        &gt;&gt;&gt; e1 = brain.add_electrode_contact(number = 1, label = &quot;LA1&quot;, position = [35,10,10], is_surface = False)</span>
<span class="sd">        &gt;&gt;&gt; e1.get_position(&quot;ras&quot;)</span>
<span class="sd">        Vec3(35.0, 10.0, 10.0) [ras]</span>
<span class="sd">        &gt;&gt;&gt; e2 = brain.add_electrode_contact(number = 2, label = &quot;LA2&quot;, position = Vec3([5,10,10], space = &quot;voxel&quot;), is_surface = False)</span>
<span class="sd">        &gt;&gt;&gt; # Automatically transform position to RAS space</span>
<span class="sd">        &gt;&gt;&gt; e2.get_position(&quot;ras&quot;)</span>
<span class="sd">        Vec3(126.61447143554688, -117.5, 117.5) [ras]</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">is_surface</span> <span class="o">=</span> <span class="kc">True</span> <span class="k">if</span> <span class="n">is_surface</span> <span class="k">else</span> <span class="kc">False</span>
    <span class="k">if</span> <span class="n">radius</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">radius</span> <span class="o">=</span> <span class="mf">2.0</span> <span class="k">if</span> <span class="n">is_surface</span> <span class="k">else</span> <span class="mf">1.0</span>
    <span class="n">contact</span> <span class="o">=</span> <span class="n">ElectrodeSphere</span><span class="p">(</span>
        <span class="n">brain</span> <span class="o">=</span> <span class="bp">self</span><span class="p">,</span>
        <span class="n">number</span> <span class="o">=</span> <span class="n">number</span><span class="p">,</span> 
        <span class="n">label</span> <span class="o">=</span> <span class="n">label</span><span class="p">,</span> 
        <span class="n">position</span> <span class="o">=</span> <span class="n">position</span><span class="p">,</span> 
        <span class="n">radius</span> <span class="o">=</span> <span class="n">radius</span><span class="p">,</span>
        <span class="n">is_surface</span> <span class="o">=</span> <span class="n">is_surface</span><span class="p">,</span>
        <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">mni_position</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">contact</span><span class="o">.</span><span class="n">set_mni_position</span><span class="p">(</span><span class="n">mni_position</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">sphere_position</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">contact</span><span class="o">.</span><span class="n">set_sphere_position</span><span class="p">(</span><span class="n">sphere_position</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_electrode_contacts</span><span class="p">[</span> <span class="n">contact</span><span class="o">.</span><span class="n">number</span> <span class="p">]</span> <span class="o">=</span> <span class="n">contact</span>
    <span class="k">return</span> <span class="n">contact</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">




<h2 id="threebrainpy.core.brain.Brain.add_electrodes" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">add_electrodes</span><span class="p">(</span><span class="n">table</span><span class="p">,</span> <span class="n">space</span><span class="o">=</span><span class="s1">&#39;ras&#39;</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>Add electrodes to the brain.
Args:
    table: A pandas table containing the electrode information, or the path to the table. (See 'Details:')
    space: The space of the electrode coordinates, default is "ras".
Returns:
    The number of electrodes added.</p>

<details class="details" open>
  <summary>Details</summary>
  <p>The table (or table file) must contains at least the following columns (<strong>case-sensitive</strong>):</p>
<ul>
<li>
<p><code>Electrode</code> (int, mandatory): electrode contact number, starting from 1</p>
</li>
<li>
<p><code>Label</code> (str, mandatory): electrode label string, must not be empty string</p>
</li>
<li>
<p><code>x</code>, <code>y</code>, <code>z</code> (float): the coordinates of the electrode contact in the space specified by <code>space</code>.</p>
<p>If <code>space</code> is not specified, then the coordinates are assumed to be in the T1 space ("ras").</p>
<blockquote>
<p>If x=y=z=0, then the electrode will be hidden. (This is the default behavior of R package threeBrain)</p>
</blockquote>
<p>If <code>x</code>, <code>y</code>, <code>z</code> is not specified, then the following columns will be used in order:</p>
<ul>
<li><code>Coord_x</code>, <code>Coord_y</code>, <code>Coord_z</code>: electrode coordinates in tkrRAS space (FreeSurfer space)</li>
<li><code>T1R</code>, <code>T1A</code>, <code>T1S</code>: electrode coordinates in T1 RAS space (scanner space)</li>
<li><code>MNI305_x</code>, <code>MNI305_y</code>, <code>MNI305_z</code>: electrode coordinates in MNI305 space</li>
<li><code>MNI152_x</code>, <code>MNI152_y</code>, <code>MNI152_z</code>: electrode coordinates in MNI152 space</li>
</ul>
<p>The order will be Coord_<em> &gt; T1</em> &gt; MNI305_<em> &gt; MNI152_</em> to be consistent with R package threeBrain.</p>
<blockquote>
<p>xyz in native (subject brain) space and MNI space can co-exist in the same table. In this case,
the native space coordinates will be used to show the electrodes in the native brain,
and the MNI space coordinates will be used to show the electrodes on the template brain.</p>
</blockquote>
</li>
</ul>
<p>The following columns are optional:</p>
<ul>
<li><code>Radius</code> (float): the radius of the electrode contact, default is 1.0 for sEEG and 2.0 for ECoG</li>
<li><code>Hemisphere</code> (str, ["auto", "left", "right"]): the hemisphere of the electrode contact, default is "auto"
    If "auto", then the hemisphere will be determined by the <code>FSLabel</code> column.</li>
<li><code>Sphere_x</code>, <code>Sphere_y</code>, <code>Sphere_z</code> (float): the coordinates of the electrode contact in the sphere space (surface electrodes only)</li>
<li><code>SurfaceElectrode</code> (bool): whether the electrode is a surface electrode, default is False</li>
<li><code>FSLabel</code> (str): the FreeSurfer label of the electrode contact.</li>
</ul>
</details>
          <details class="quote">
            <summary>Source code in <code>threebrainpy/core/brain.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">718</span>
<span class="normal">719</span>
<span class="normal">720</span>
<span class="normal">721</span>
<span class="normal">722</span>
<span class="normal">723</span>
<span class="normal">724</span>
<span class="normal">725</span>
<span class="normal">726</span>
<span class="normal">727</span>
<span class="normal">728</span>
<span class="normal">729</span>
<span class="normal">730</span>
<span class="normal">731</span>
<span class="normal">732</span>
<span class="normal">733</span>
<span class="normal">734</span>
<span class="normal">735</span>
<span class="normal">736</span>
<span class="normal">737</span>
<span class="normal">738</span>
<span class="normal">739</span>
<span class="normal">740</span>
<span class="normal">741</span>
<span class="normal">742</span>
<span class="normal">743</span>
<span class="normal">744</span>
<span class="normal">745</span>
<span class="normal">746</span>
<span class="normal">747</span>
<span class="normal">748</span>
<span class="normal">749</span>
<span class="normal">750</span>
<span class="normal">751</span>
<span class="normal">752</span>
<span class="normal">753</span>
<span class="normal">754</span>
<span class="normal">755</span>
<span class="normal">756</span>
<span class="normal">757</span>
<span class="normal">758</span>
<span class="normal">759</span>
<span class="normal">760</span>
<span class="normal">761</span>
<span class="normal">762</span>
<span class="normal">763</span>
<span class="normal">764</span>
<span class="normal">765</span>
<span class="normal">766</span>
<span class="normal">767</span>
<span class="normal">768</span>
<span class="normal">769</span>
<span class="normal">770</span>
<span class="normal">771</span>
<span class="normal">772</span>
<span class="normal">773</span>
<span class="normal">774</span>
<span class="normal">775</span>
<span class="normal">776</span>
<span class="normal">777</span>
<span class="normal">778</span>
<span class="normal">779</span>
<span class="normal">780</span>
<span class="normal">781</span>
<span class="normal">782</span>
<span class="normal">783</span>
<span class="normal">784</span>
<span class="normal">785</span>
<span class="normal">786</span>
<span class="normal">787</span>
<span class="normal">788</span>
<span class="normal">789</span>
<span class="normal">790</span>
<span class="normal">791</span>
<span class="normal">792</span>
<span class="normal">793</span>
<span class="normal">794</span>
<span class="normal">795</span>
<span class="normal">796</span>
<span class="normal">797</span>
<span class="normal">798</span>
<span class="normal">799</span>
<span class="normal">800</span>
<span class="normal">801</span>
<span class="normal">802</span>
<span class="normal">803</span>
<span class="normal">804</span>
<span class="normal">805</span>
<span class="normal">806</span>
<span class="normal">807</span>
<span class="normal">808</span>
<span class="normal">809</span>
<span class="normal">810</span>
<span class="normal">811</span>
<span class="normal">812</span>
<span class="normal">813</span>
<span class="normal">814</span>
<span class="normal">815</span>
<span class="normal">816</span>
<span class="normal">817</span>
<span class="normal">818</span>
<span class="normal">819</span>
<span class="normal">820</span>
<span class="normal">821</span>
<span class="normal">822</span>
<span class="normal">823</span>
<span class="normal">824</span>
<span class="normal">825</span>
<span class="normal">826</span>
<span class="normal">827</span>
<span class="normal">828</span>
<span class="normal">829</span>
<span class="normal">830</span>
<span class="normal">831</span>
<span class="normal">832</span>
<span class="normal">833</span>
<span class="normal">834</span>
<span class="normal">835</span>
<span class="normal">836</span>
<span class="normal">837</span>
<span class="normal">838</span>
<span class="normal">839</span>
<span class="normal">840</span>
<span class="normal">841</span>
<span class="normal">842</span>
<span class="normal">843</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">add_electrodes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">table</span> <span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="n">DataFrame</span><span class="p">,</span> <span class="n">space</span> <span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="s1">&#39;ras&#39;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Add electrodes to the brain.</span>
<span class="sd">    Args:</span>
<span class="sd">        table: A pandas table containing the electrode information, or the path to the table. (See &#39;Details:&#39;)</span>
<span class="sd">        space: The space of the electrode coordinates, default is &quot;ras&quot;.</span>
<span class="sd">    Returns:</span>
<span class="sd">        The number of electrodes added.</span>

<span class="sd">    Details:</span>
<span class="sd">        The table (or table file) must contains at least the following columns (**case-sensitive**):</span>

<span class="sd">        * `Electrode` (int, mandatory): electrode contact number, starting from 1</span>

<span class="sd">        * `Label` (str, mandatory): electrode label string, must not be empty string</span>

<span class="sd">        * `x`, `y`, `z` (float): the coordinates of the electrode contact in the space specified by `space`.</span>

<span class="sd">            If `space` is not specified, then the coordinates are assumed to be in the T1 space (&quot;ras&quot;).</span>

<span class="sd">            &gt; If x=y=z=0, then the electrode will be hidden. (This is the default behavior of R package threeBrain)</span>

<span class="sd">            If `x`, `y`, `z` is not specified, then the following columns will be used in order:</span>

<span class="sd">            * `Coord_x`, `Coord_y`, `Coord_z`: electrode coordinates in tkrRAS space (FreeSurfer space)</span>
<span class="sd">            * `T1R`, `T1A`, `T1S`: electrode coordinates in T1 RAS space (scanner space)</span>
<span class="sd">            * `MNI305_x`, `MNI305_y`, `MNI305_z`: electrode coordinates in MNI305 space</span>
<span class="sd">            * `MNI152_x`, `MNI152_y`, `MNI152_z`: electrode coordinates in MNI152 space</span>

<span class="sd">            The order will be Coord_* &gt; T1* &gt; MNI305_* &gt; MNI152_* to be consistent with R package threeBrain.</span>

<span class="sd">            &gt; xyz in native (subject brain) space and MNI space can co-exist in the same table. In this case,</span>
<span class="sd">            &gt; the native space coordinates will be used to show the electrodes in the native brain,</span>
<span class="sd">            &gt; and the MNI space coordinates will be used to show the electrodes on the template brain.</span>

<span class="sd">        The following columns are optional:</span>

<span class="sd">        * `Radius` (float): the radius of the electrode contact, default is 1.0 for sEEG and 2.0 for ECoG</span>
<span class="sd">        * `Hemisphere` (str, [&quot;auto&quot;, &quot;left&quot;, &quot;right&quot;]): the hemisphere of the electrode contact, default is &quot;auto&quot;</span>
<span class="sd">            If &quot;auto&quot;, then the hemisphere will be determined by the `FSLabel` column.</span>
<span class="sd">        * `Sphere_x`, `Sphere_y`, `Sphere_z` (float): the coordinates of the electrode contact in the sphere space (surface electrodes only)</span>
<span class="sd">        * `SurfaceElectrode` (bool): whether the electrode is a surface electrode, default is False</span>
<span class="sd">        * `FSLabel` (str): the FreeSurfer label of the electrode contact.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">if</span> <span class="n">space</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">space</span> <span class="o">=</span> <span class="s2">&quot;ras&quot;</span>
    <span class="k">elif</span> <span class="ow">not</span> <span class="n">space</span> <span class="ow">in</span> <span class="n">CONSTANTS</span><span class="o">.</span><span class="n">SUPPORTED_SPACES</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Invalid space: </span><span class="si">{</span><span class="n">space</span><span class="si">}</span><span class="s2">, supported spaces are: </span><span class="si">{</span><span class="n">CONSTANTS</span><span class="o">.</span><span class="n">SUPPORTED_SPACES</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="c1"># table = &quot;/Users/dipterix/Dropbox (PennNeurosurgery)/RAVE/Samples/data/demo/PAV006/rave/meta/electrodes.csv&quot;</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">table</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
        <span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
        <span class="n">table</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">table</span><span class="p">,</span> <span class="n">sep</span> <span class="o">=</span> <span class="s2">&quot;,&quot;</span><span class="p">)</span>
    <span class="c1"># assume table is pandas since we don&#39;t want to import pandas here</span>
    <span class="n">nrows</span> <span class="o">=</span> <span class="n">table</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">valid_length</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">l</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">isfinite</span><span class="p">(</span><span class="n">l</span><span class="p">)</span> <span class="ow">and</span> <span class="n">l</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">l</span> <span class="o">&lt;</span> <span class="mi">500</span>
    <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nrows</span><span class="p">):</span>
        <span class="n">row</span> <span class="o">=</span> <span class="n">table</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span><span class="o">.</span><span class="n">to_dict</span><span class="p">()</span>
        <span class="n">electrode</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="s2">&quot;Electrode&quot;</span><span class="p">]</span>
        <span class="n">label</span> <span class="o">=</span> <span class="n">row</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;Label&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">label</span> <span class="o">==</span> <span class="s2">&quot;&quot;</span><span class="p">:</span>
            <span class="n">label</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;NoLabel</span><span class="si">{</span><span class="w"> </span><span class="n">electrode</span><span class="w"> </span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">row</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="n">y</span> <span class="o">=</span> <span class="n">row</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="n">z</span> <span class="o">=</span> <span class="n">row</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;z&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="n">xyz</span> <span class="o">=</span> <span class="n">Vec3</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="n">space</span><span class="o">=</span><span class="n">space</span><span class="p">)</span>
        <span class="n">tkr_x</span> <span class="o">=</span> <span class="n">row</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;Coord_x&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="n">tkr_y</span> <span class="o">=</span> <span class="n">row</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;Coord_y&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="n">tkr_z</span> <span class="o">=</span> <span class="n">row</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;Coord_z&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="n">tkr_ras</span> <span class="o">=</span> <span class="n">Vec3</span><span class="p">(</span><span class="n">tkr_x</span><span class="p">,</span> <span class="n">tkr_y</span><span class="p">,</span> <span class="n">tkr_z</span><span class="p">,</span> <span class="n">space</span><span class="o">=</span><span class="s2">&quot;ras_tkr&quot;</span><span class="p">)</span>
        <span class="n">t1_x</span> <span class="o">=</span> <span class="n">row</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;T1R&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="n">t1_y</span> <span class="o">=</span> <span class="n">row</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;T1A&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="n">t1_z</span> <span class="o">=</span> <span class="n">row</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;T1S&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="n">ras</span> <span class="o">=</span> <span class="n">Vec3</span><span class="p">(</span><span class="n">t1_x</span><span class="p">,</span> <span class="n">t1_y</span><span class="p">,</span> <span class="n">t1_z</span><span class="p">,</span> <span class="n">space</span><span class="o">=</span><span class="s2">&quot;ras&quot;</span><span class="p">)</span>
        <span class="n">mni305_x</span> <span class="o">=</span> <span class="n">row</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;MNI305_x&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="n">mni305_y</span> <span class="o">=</span> <span class="n">row</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;MNI305_y&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="n">mni305_z</span> <span class="o">=</span> <span class="n">row</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;MNI305_z&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="n">mni305</span> <span class="o">=</span> <span class="n">Vec3</span><span class="p">(</span><span class="n">mni305_x</span><span class="p">,</span> <span class="n">mni305_y</span><span class="p">,</span> <span class="n">mni305_z</span><span class="p">,</span> <span class="n">space</span><span class="o">=</span><span class="s2">&quot;mni305&quot;</span><span class="p">)</span>
        <span class="n">mni152_x</span> <span class="o">=</span> <span class="n">row</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;MNI152_x&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="n">mni152_y</span> <span class="o">=</span> <span class="n">row</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;MNI152_y&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="n">mni152_z</span> <span class="o">=</span> <span class="n">row</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;MNI152_z&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="n">mni152</span> <span class="o">=</span> <span class="n">Vec3</span><span class="p">(</span><span class="n">mni152_x</span><span class="p">,</span> <span class="n">mni152_y</span><span class="p">,</span> <span class="n">mni152_z</span><span class="p">,</span> <span class="n">space</span><span class="o">=</span><span class="s2">&quot;mni152&quot;</span><span class="p">)</span>
        <span class="n">mni_position</span> <span class="o">=</span> <span class="n">mni305</span>
        <span class="k">if</span> <span class="n">valid_length</span><span class="p">(</span> <span class="n">xyz</span><span class="o">.</span><span class="n">length</span><span class="p">()</span> <span class="p">):</span>
            <span class="n">position</span> <span class="o">=</span> <span class="n">xyz</span>
        <span class="k">elif</span> <span class="n">valid_length</span><span class="p">(</span> <span class="n">tkr_ras</span><span class="o">.</span><span class="n">length</span><span class="p">()</span> <span class="p">):</span>
            <span class="n">position</span> <span class="o">=</span> <span class="n">tkr_ras</span>
        <span class="k">elif</span> <span class="n">valid_length</span><span class="p">(</span> <span class="n">ras</span><span class="o">.</span><span class="n">length</span><span class="p">()</span> <span class="p">):</span>
            <span class="n">position</span> <span class="o">=</span> <span class="n">ras</span>
        <span class="k">elif</span> <span class="n">valid_length</span><span class="p">(</span> <span class="n">mni305</span><span class="o">.</span><span class="n">length</span><span class="p">()</span> <span class="p">):</span>
            <span class="n">position</span> <span class="o">=</span> <span class="n">mni305</span>
        <span class="k">elif</span> <span class="n">valid_length</span><span class="p">(</span> <span class="n">mni152</span><span class="o">.</span><span class="n">length</span><span class="p">()</span> <span class="p">):</span>
            <span class="n">position</span> <span class="o">=</span> <span class="n">mni152</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">position</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">valid_length</span><span class="p">(</span> <span class="n">mni_position</span><span class="o">.</span><span class="n">length</span><span class="p">()</span> <span class="p">):</span>
            <span class="n">mni_position</span> <span class="o">=</span> <span class="n">mni152</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">valid_length</span><span class="p">(</span> <span class="n">mni_position</span><span class="o">.</span><span class="n">length</span><span class="p">()</span> <span class="p">):</span>
            <span class="n">mni_position</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">sphere_x</span> <span class="o">=</span> <span class="n">row</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;Sphere_x&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="n">sphere_y</span> <span class="o">=</span> <span class="n">row</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;Sphere_y&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="n">sphere_z</span> <span class="o">=</span> <span class="n">row</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;Sphere_z&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="n">sphere_position</span> <span class="o">=</span> <span class="n">Vec3</span><span class="p">(</span><span class="n">sphere_x</span><span class="p">,</span> <span class="n">sphere_y</span><span class="p">,</span> <span class="n">sphere_z</span><span class="p">,</span> <span class="n">space</span><span class="o">=</span><span class="s2">&quot;sphere&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">valid_length</span><span class="p">(</span> <span class="n">sphere_position</span><span class="o">.</span><span class="n">length</span><span class="p">()</span> <span class="p">):</span>
            <span class="n">sphere_position</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">radius</span> <span class="o">=</span> <span class="n">row</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;Radius&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="n">is_surface</span> <span class="o">=</span> <span class="n">row</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;SurfaceElectrode&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
        <span class="n">fs_label</span> <span class="o">=</span> <span class="n">row</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;FSLabel&quot;</span><span class="p">,</span> <span class="s2">&quot;Unknown&quot;</span><span class="p">)</span>
        <span class="n">hemisphere</span> <span class="o">=</span> <span class="n">row</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;Hemisphere&quot;</span><span class="p">,</span> <span class="s2">&quot;auto&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">hemisphere</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">hemisphere</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;l&quot;</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">]:</span>
            <span class="n">hemisphere</span> <span class="o">=</span> <span class="s2">&quot;auto&quot;</span>
            <span class="c1"># also guess the hemisphere from the FSLabel</span>
            <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;^(left|(ctx|wm)[_-]lh)&quot;</span><span class="p">,</span> <span class="n">fs_label</span><span class="p">,</span> <span class="n">re</span><span class="o">.</span><span class="n">IGNORECASE</span><span class="p">):</span>
                <span class="n">hemisphere</span> <span class="o">=</span> <span class="s2">&quot;left&quot;</span>
            <span class="k">elif</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;^(right|(ctx|wm)[_-]rh)&quot;</span><span class="p">,</span> <span class="n">fs_label</span><span class="p">,</span> <span class="n">re</span><span class="o">.</span><span class="n">IGNORECASE</span><span class="p">):</span>
                <span class="n">hemisphere</span> <span class="o">=</span> <span class="s2">&quot;right&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">hemisphere</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;l&quot;</span><span class="p">:</span>
                <span class="n">hemisphere</span> <span class="o">=</span> <span class="s2">&quot;left&quot;</span>
            <span class="k">elif</span> <span class="n">hemisphere</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;r&quot;</span><span class="p">:</span>
                <span class="n">hemisphere</span> <span class="o">=</span> <span class="s2">&quot;right&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_electrode_contact</span><span class="p">(</span>
            <span class="n">number</span> <span class="o">=</span> <span class="n">electrode</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="n">label</span><span class="p">,</span> <span class="n">position</span> <span class="o">=</span> <span class="n">position</span><span class="p">,</span>
            <span class="n">is_surface</span> <span class="o">=</span> <span class="n">is_surface</span><span class="p">,</span> <span class="n">radius</span> <span class="o">=</span> <span class="n">radius</span><span class="p">,</span>
            <span class="n">mni_position</span> <span class="o">=</span> <span class="n">mni_position</span><span class="p">,</span> <span class="n">sphere_position</span> <span class="o">=</span> <span class="n">sphere_position</span><span class="p">,</span>
            <span class="n">hemisphere</span> <span class="o">=</span> <span class="n">hemisphere</span><span class="p">)</span>
    <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_electrode_contacts</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">




<h2 id="threebrainpy.core.brain.Brain.add_global_data" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">add_global_data</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">is_cache</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">absolute_path</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>Internal method to add global data to the brain.
Args:
    name: The name of the global data.
    value: If <code>is_cache=False</code>, the value of the global data, can be any JSON-serializable object.
        If <code>is_cache=True</code>, the path to, or the file name of the cached JSON file.
    is_cache: Whether the <code>value</code> is a cached JSON file.
    absolute_path: The absolute path to the cached JSON file.</p>

          <details class="quote">
            <summary>Source code in <code>threebrainpy/core/brain.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">add_global_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span> <span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">value</span> <span class="p">:</span> <span class="nb">any</span><span class="p">,</span> <span class="n">is_cache</span> <span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">absolute_path</span> <span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Internal method to add global data to the brain.</span>
<span class="sd">    Args:</span>
<span class="sd">        name: The name of the global data.</span>
<span class="sd">        value: If `is_cache=False`, the value of the global data, can be any JSON-serializable object.</span>
<span class="sd">            If `is_cache=True`, the path to, or the file name of the cached JSON file.</span>
<span class="sd">        is_cache: Whether the `value` is a cached JSON file.</span>
<span class="sd">        absolute_path: The absolute path to the cached JSON file.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_globals</span><span class="o">.</span><span class="n">set_group_data</span><span class="p">(</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span><span class="p">,</span> <span class="n">value</span> <span class="o">=</span> <span class="n">value</span><span class="p">,</span> <span class="n">is_cache</span> <span class="o">=</span> <span class="n">is_cache</span><span class="p">,</span> <span class="n">absolute_path</span> <span class="o">=</span> <span class="n">absolute_path</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">




<h2 id="threebrainpy.core.brain.Brain.add_group" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">add_group</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">exists_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>Internal method to add a geometry groups to the brain.
Args:
    name: The name of the group.
    exists_ok: Whether to overwrite the existing group if the group already exists.
Returns:
    The group instance.</p>

          <details class="quote">
            <summary>Source code in <code>threebrainpy/core/brain.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">add_group</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span> <span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">exists_ok</span> <span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">GeomWrapper</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Internal method to add a geometry groups to the brain.</span>
<span class="sd">    Args:</span>
<span class="sd">        name: The name of the group.</span>
<span class="sd">        exists_ok: Whether to overwrite the existing group if the group already exists.</span>
<span class="sd">    Returns:</span>
<span class="sd">        The group instance.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">group</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_groups</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">group</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">group</span> <span class="o">=</span> <span class="n">GeomWrapper</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span> <span class="o">=</span> <span class="n">name</span><span class="p">,</span> <span class="n">position</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">],</span> <span class="n">layers</span> <span class="o">=</span> <span class="p">[</span><span class="n">CONSTANTS</span><span class="o">.</span><span class="n">LAYER_USER_MAIN_CAMERA_0</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_groups</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">group</span>
    <span class="k">elif</span> <span class="ow">not</span> <span class="n">exists_ok</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Group </span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2"> already exists.&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">group</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">




<h2 id="threebrainpy.core.brain.Brain.add_slice" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">add_slice</span><span class="p">(</span><span class="n">slice_prefix</span><span class="o">=</span><span class="s1">&#39;brain.finalsurfs&#39;</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;T1&#39;</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>Add a (MRI) volume slice to the brain. The slices will be rendered in side canvas using datacube (JavaScript class).
Args:
    slice_prefix: The prefix of the slice file in the <code>mri</code> folder. (default: "brain.finalsurfs")
    name: The name of the slice, currently only "T1" is supported. (default: "T1")
Examples:
    Adds <code>brain.finalsurfs.mgz</code> or <code>brain.finalsurfs.nii[.gz]</code> to the brain slices
    &gt;&gt;&gt; brain.add_slice(slice_prefix = "brain.finalsurfs", name = "T1")</p>

          <details class="quote">
            <summary>Source code in <code>threebrainpy/core/brain.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">441</span>
<span class="normal">442</span>
<span class="normal">443</span>
<span class="normal">444</span>
<span class="normal">445</span>
<span class="normal">446</span>
<span class="normal">447</span>
<span class="normal">448</span>
<span class="normal">449</span>
<span class="normal">450</span>
<span class="normal">451</span>
<span class="normal">452</span>
<span class="normal">453</span>
<span class="normal">454</span>
<span class="normal">455</span>
<span class="normal">456</span>
<span class="normal">457</span>
<span class="normal">458</span>
<span class="normal">459</span>
<span class="normal">460</span>
<span class="normal">461</span>
<span class="normal">462</span>
<span class="normal">463</span>
<span class="normal">464</span>
<span class="normal">465</span>
<span class="normal">466</span>
<span class="normal">467</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">add_slice</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">slice_prefix</span> <span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;brain.finalsurfs&quot;</span><span class="p">,</span> <span class="n">name</span> <span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;T1&quot;</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Add a (MRI) volume slice to the brain. The slices will be rendered in side canvas using datacube (JavaScript class).</span>
<span class="sd">    Args:</span>
<span class="sd">        slice_prefix: The prefix of the slice file in the `mri` folder. (default: &quot;brain.finalsurfs&quot;)</span>
<span class="sd">        name: The name of the slice, currently only &quot;T1&quot; is supported. (default: &quot;T1&quot;)</span>
<span class="sd">    Examples:</span>
<span class="sd">        Adds `brain.finalsurfs.mgz` or `brain.finalsurfs.nii[.gz]` to the brain slices</span>
<span class="sd">        &gt;&gt;&gt; brain.add_slice(slice_prefix = &quot;brain.finalsurfs&quot;, name = &quot;T1&quot;)</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="c1"># In geoms, the name needs to be appended with the subject code</span>
    <span class="c1"># possible file names</span>
    <span class="n">slice_prefix</span> <span class="o">=</span> <span class="n">slice_prefix</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
    <span class="n">candidates</span> <span class="o">=</span> <span class="p">[</span>
        <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">slice_prefix</span><span class="si">}</span><span class="s2">.mgz&quot;</span><span class="p">,</span>
        <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">slice_prefix</span><span class="si">}</span><span class="s2">.nii.gz&quot;</span><span class="p">,</span>
        <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">slice_prefix</span><span class="si">}</span><span class="s2">.nii&quot;</span><span class="p">,</span>
    <span class="p">]</span>
    <span class="n">slice_files</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">path_mri</span><span class="p">)</span> <span class="k">if</span> <span class="n">x</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="n">candidates</span><span class="p">]</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">slice_files</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">None</span>
    <span class="n">slice_file</span> <span class="o">=</span> <span class="n">slice_files</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">slice_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">path_mri</span><span class="p">,</span> <span class="n">slice_file</span><span class="p">))</span>
    <span class="nb">slice</span> <span class="o">=</span> <span class="n">VolumeSlice</span><span class="p">(</span><span class="n">brain</span> <span class="o">=</span> <span class="bp">self</span><span class="p">,</span> <span class="n">name</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2"> (</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">subject_code</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">,</span> <span class="n">volume</span> <span class="o">=</span> <span class="n">slice_path</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_slices</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="nb">slice</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_update_matrices</span><span class="p">(</span><span class="n">volume_files</span> <span class="o">=</span> <span class="p">[</span><span class="n">slice_path</span><span class="p">])</span>
    <span class="k">return</span> <span class="nb">slice</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">




<h2 id="threebrainpy.core.brain.Brain.add_surfaces" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">add_surfaces</span><span class="p">(</span><span class="n">surface_type</span><span class="p">,</span> <span class="n">hemesphere</span><span class="o">=</span><span class="s1">&#39;both&#39;</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>Add a surface to the brain. The surface will be rendered in main canvas using surface (JavaScript class).
Args:
    surface_type: The type of the surface, e.g. "pial", "white", "inflated", "sphere" (see <code>surf/</code> folder, usually <code>[lr]h.&lt;surface_type&gt;</code>).
    hemesphere: The hemesphere of the surface, can be "l", "r", "b" (both). (default: "both")
Returns:
    A dictionary of surface instances if exist, with keys being the hemesphere.
Examples:
    Adds <code>lh.pial</code> and <code>rh.pial</code> to the brain surfaces
    &gt;&gt;&gt; brain.add_surfaces(surface_type = "pial", hemesphere = "both")</p>

          <details class="quote">
            <summary>Source code in <code>threebrainpy/core/brain.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">555</span>
<span class="normal">556</span>
<span class="normal">557</span>
<span class="normal">558</span>
<span class="normal">559</span>
<span class="normal">560</span>
<span class="normal">561</span>
<span class="normal">562</span>
<span class="normal">563</span>
<span class="normal">564</span>
<span class="normal">565</span>
<span class="normal">566</span>
<span class="normal">567</span>
<span class="normal">568</span>
<span class="normal">569</span>
<span class="normal">570</span>
<span class="normal">571</span>
<span class="normal">572</span>
<span class="normal">573</span>
<span class="normal">574</span>
<span class="normal">575</span>
<span class="normal">576</span>
<span class="normal">577</span>
<span class="normal">578</span>
<span class="normal">579</span>
<span class="normal">580</span>
<span class="normal">581</span>
<span class="normal">582</span>
<span class="normal">583</span>
<span class="normal">584</span>
<span class="normal">585</span>
<span class="normal">586</span>
<span class="normal">587</span>
<span class="normal">588</span>
<span class="normal">589</span>
<span class="normal">590</span>
<span class="normal">591</span>
<span class="normal">592</span>
<span class="normal">593</span>
<span class="normal">594</span>
<span class="normal">595</span>
<span class="normal">596</span>
<span class="normal">597</span>
<span class="normal">598</span>
<span class="normal">599</span>
<span class="normal">600</span>
<span class="normal">601</span>
<span class="normal">602</span>
<span class="normal">603</span>
<span class="normal">604</span>
<span class="normal">605</span>
<span class="normal">606</span>
<span class="normal">607</span>
<span class="normal">608</span>
<span class="normal">609</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">add_surfaces</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">surface_type</span> <span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">hemesphere</span> <span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;both&quot;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span> <span class="o">|</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Add a surface to the brain. The surface will be rendered in main canvas using surface (JavaScript class).</span>
<span class="sd">    Args:</span>
<span class="sd">        surface_type: The type of the surface, e.g. &quot;pial&quot;, &quot;white&quot;, &quot;inflated&quot;, &quot;sphere&quot; (see `surf/` folder, usually `[lr]h.&lt;surface_type&gt;`).</span>
<span class="sd">        hemesphere: The hemesphere of the surface, can be &quot;l&quot;, &quot;r&quot;, &quot;b&quot; (both). (default: &quot;both&quot;)</span>
<span class="sd">    Returns:</span>
<span class="sd">        A dictionary of surface instances if exist, with keys being the hemesphere.</span>
<span class="sd">    Examples:</span>
<span class="sd">        Adds `lh.pial` and `rh.pial` to the brain surfaces</span>
<span class="sd">        &gt;&gt;&gt; brain.add_surfaces(surface_type = &quot;pial&quot;, hemesphere = &quot;both&quot;)</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">hemesphere_prefix</span> <span class="o">=</span> <span class="n">hemesphere</span><span class="o">.</span><span class="n">lower</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">hemesphere_prefix</span> <span class="o">==</span> <span class="s2">&quot;b&quot;</span><span class="p">:</span>
        <span class="n">hemesphere_prefix</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;lh&quot;</span><span class="p">,</span> <span class="s2">&quot;rh&quot;</span><span class="p">]</span>
    <span class="k">elif</span> <span class="n">hemesphere_prefix</span> <span class="o">==</span> <span class="s2">&quot;l&quot;</span><span class="p">:</span>
        <span class="n">hemesphere_prefix</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;lh&quot;</span><span class="p">]</span>
    <span class="k">elif</span> <span class="n">hemesphere_prefix</span> <span class="o">==</span> <span class="s2">&quot;r&quot;</span><span class="p">:</span>
        <span class="n">hemesphere_prefix</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;rh&quot;</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Invalid hemesphere: </span><span class="si">{</span><span class="n">hemesphere</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="n">surface_type0</span> <span class="o">=</span> <span class="n">surface_type</span>
    <span class="n">surface_type</span> <span class="o">=</span> <span class="n">surface_type</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">surface_type</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;pial&quot;</span><span class="p">,</span> <span class="s2">&quot;pial.t1&quot;</span><span class="p">,):</span>
        <span class="c1"># Newer freesurfer versions use &quot;pial.T1&quot; as the surface type, while older versions use &quot;pial&quot;</span>
        <span class="n">surface_type</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;pial&quot;</span><span class="p">,</span> <span class="s2">&quot;pial.t1&quot;</span><span class="p">]</span>
        <span class="n">surface_type0</span> <span class="o">=</span> <span class="s2">&quot;pial&quot;</span>
    <span class="c1"># construct possible file names</span>
    <span class="n">file_names_lower</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">h</span> <span class="ow">in</span> <span class="n">hemesphere_prefix</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">surface_type</span><span class="p">:</span>
            <span class="n">file_names_lower</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">h</span><span class="si">}</span><span class="s2">.</span><span class="si">{</span><span class="n">s</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="c1"># search for the file</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">path_surf</span><span class="p">):</span>
        <span class="k">return</span> <span class="kc">None</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">path_surf</span><span class="p">):</span>
        <span class="k">return</span> <span class="kc">None</span>
    <span class="n">surface_files</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">path_surf</span><span class="p">)</span> <span class="k">if</span> <span class="n">x</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="n">file_names_lower</span><span class="p">]</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">surface_files</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">None</span>
    <span class="n">surface_dict</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_surfaces</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">surface_type0</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">surface_dict</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
        <span class="n">surface_dict</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_surfaces</span><span class="p">[</span><span class="n">surface_type0</span><span class="p">]</span> <span class="o">=</span> <span class="n">surface_dict</span>
    <span class="c1"># check base vertex colors</span>
    <span class="n">base_vertex_colors</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_surface_morph_paths</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">surface_filename</span> <span class="ow">in</span> <span class="n">surface_files</span><span class="p">:</span>
        <span class="n">surface_file</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">path_surf</span><span class="p">,</span> <span class="n">surface_filename</span><span class="p">)</span>
        <span class="n">surface</span> <span class="o">=</span> <span class="n">CorticalSurface</span><span class="p">(</span><span class="n">brain</span> <span class="o">=</span> <span class="bp">self</span><span class="p">,</span> <span class="n">surface_type</span> <span class="o">=</span> <span class="n">surface_type0</span><span class="p">,</span> <span class="n">surface_file</span> <span class="o">=</span> <span class="n">surface_file</span><span class="p">,</span> <span class="n">hemesphere</span> <span class="o">=</span> <span class="n">surface_filename</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">surface_dict</span><span class="p">[</span> <span class="n">surface</span><span class="o">.</span><span class="n">hemesphere</span> <span class="p">]</span> <span class="o">=</span> <span class="n">surface</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">base_vertex_colors</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
            <span class="n">surface</span><span class="o">.</span><span class="n">group</span><span class="o">.</span><span class="n">set_group_data</span><span class="p">(</span>
                <span class="n">name</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">surface</span><span class="o">.</span><span class="n">hemesphere</span><span class="si">}</span><span class="s2">_primary_vertex_color&quot;</span><span class="p">,</span> 
                <span class="n">value</span> <span class="o">=</span> <span class="n">base_vertex_colors</span><span class="p">[</span><span class="n">surface</span><span class="o">.</span><span class="n">hemesphere</span><span class="p">],</span> <span class="n">is_cache</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">surface_dict</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">




<h2 id="threebrainpy.core.brain.Brain.add_volume" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">add_volume</span><span class="p">(</span><span class="n">volume_prefix</span><span class="p">,</span> <span class="n">is_continuous</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>Add a (Atlas/CT/3D voxel) volume cube to the brain. The VolumeCube will be rendered in main canvas using datacube2 (JavaScript class).
Args:
    volume_prefix: The prefix of the volume file in the <code>mri</code> folder. (e.g. "aparc+aseg", "CT_raw")
    is_continuous: Whether the volume is continuous or discrete. 
        The color map for continuous and discrete values are set separately.
        For continuous values, the volume will be rendered using RedFormat (single-channel shader). 
            The color will be assgined according to the volume value (density).
        For discrete values, the volume will be rendered using RGBAFormat (four-channel shader). 
            The volume data will be used as the color index, and the color map will be set separately.
            The color index must be integer, and the color map must be a list of RGBA colors.
    name: The name of the volume, default is to automatically derived from the volume_prefix. 
        Please set name to "CT" is the volume file is CT for localization
Examples:
    Adds <code>aparc+aseg.mgz</code> or <code>aparc+aseg.nii[.gz]</code> to the brain volumes
    &gt;&gt;&gt; brain.add_volume(volume_prefix = "aparc+aseg", is_continuous = False)</p>

          <details class="quote">
            <summary>Source code in <code>threebrainpy/core/brain.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">490</span>
<span class="normal">491</span>
<span class="normal">492</span>
<span class="normal">493</span>
<span class="normal">494</span>
<span class="normal">495</span>
<span class="normal">496</span>
<span class="normal">497</span>
<span class="normal">498</span>
<span class="normal">499</span>
<span class="normal">500</span>
<span class="normal">501</span>
<span class="normal">502</span>
<span class="normal">503</span>
<span class="normal">504</span>
<span class="normal">505</span>
<span class="normal">506</span>
<span class="normal">507</span>
<span class="normal">508</span>
<span class="normal">509</span>
<span class="normal">510</span>
<span class="normal">511</span>
<span class="normal">512</span>
<span class="normal">513</span>
<span class="normal">514</span>
<span class="normal">515</span>
<span class="normal">516</span>
<span class="normal">517</span>
<span class="normal">518</span>
<span class="normal">519</span>
<span class="normal">520</span>
<span class="normal">521</span>
<span class="normal">522</span>
<span class="normal">523</span>
<span class="normal">524</span>
<span class="normal">525</span>
<span class="normal">526</span>
<span class="normal">527</span>
<span class="normal">528</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">add_volume</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">volume_prefix</span> <span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">is_continuous</span> <span class="p">:</span> <span class="nb">bool</span><span class="p">,</span> <span class="n">name</span> <span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span> <span class="o">|</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Add a (Atlas/CT/3D voxel) volume cube to the brain. The VolumeCube will be rendered in main canvas using datacube2 (JavaScript class).</span>
<span class="sd">    Args:</span>
<span class="sd">        volume_prefix: The prefix of the volume file in the `mri` folder. (e.g. &quot;aparc+aseg&quot;, &quot;CT_raw&quot;)</span>
<span class="sd">        is_continuous: Whether the volume is continuous or discrete. </span>
<span class="sd">            The color map for continuous and discrete values are set separately.</span>
<span class="sd">            For continuous values, the volume will be rendered using RedFormat (single-channel shader). </span>
<span class="sd">                The color will be assgined according to the volume value (density).</span>
<span class="sd">            For discrete values, the volume will be rendered using RGBAFormat (four-channel shader). </span>
<span class="sd">                The volume data will be used as the color index, and the color map will be set separately.</span>
<span class="sd">                The color index must be integer, and the color map must be a list of RGBA colors.</span>
<span class="sd">        name: The name of the volume, default is to automatically derived from the volume_prefix. </span>
<span class="sd">            Please set name to &quot;CT&quot; is the volume file is CT for localization</span>
<span class="sd">    Examples:</span>
<span class="sd">        Adds `aparc+aseg.mgz` or `aparc+aseg.nii[.gz]` to the brain volumes</span>
<span class="sd">        &gt;&gt;&gt; brain.add_volume(volume_prefix = &quot;aparc+aseg&quot;, is_continuous = False)</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="c1"># In geoms, the name needs to be appended with the subject code</span>
    <span class="c1"># possible file names</span>
    <span class="n">volume_prefix</span> <span class="o">=</span> <span class="n">volume_prefix</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">name</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">name</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;[^a-zA-Z0-9_]&quot;</span><span class="p">,</span> <span class="s2">&quot;_&quot;</span><span class="p">,</span> <span class="n">volume_prefix</span><span class="p">)</span>
    <span class="n">candidates</span> <span class="o">=</span> <span class="p">[</span>
        <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">volume_prefix</span><span class="si">}</span><span class="s2">.mgz&quot;</span><span class="p">,</span>
        <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">volume_prefix</span><span class="si">}</span><span class="s2">.nii.gz&quot;</span><span class="p">,</span>
        <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">volume_prefix</span><span class="si">}</span><span class="s2">.nii&quot;</span><span class="p">,</span>
    <span class="p">]</span>
    <span class="n">volume_files</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">path_mri</span><span class="p">)</span> <span class="k">if</span> <span class="n">x</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="n">candidates</span><span class="p">]</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">volume_files</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">None</span>
    <span class="n">volume_file</span> <span class="o">=</span> <span class="n">volume_files</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">volume_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">path_mri</span><span class="p">,</span> <span class="n">volume_file</span><span class="p">))</span>
    <span class="n">volume</span> <span class="o">=</span> <span class="n">VolumeWrapper</span><span class="p">(</span><span class="n">volume_path</span><span class="p">)</span>
    <span class="n">volume_cube</span> <span class="o">=</span> <span class="n">VolumeCube</span><span class="p">(</span><span class="n">brain</span> <span class="o">=</span> <span class="bp">self</span><span class="p">,</span> <span class="n">name</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Atlas - </span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2"> (</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">subject_code</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">,</span> <span class="n">volume</span> <span class="o">=</span> <span class="n">volume</span><span class="p">,</span>
                             <span class="n">color_format</span> <span class="o">=</span> <span class="s2">&quot;RedFormat&quot;</span> <span class="k">if</span> <span class="n">is_continuous</span> <span class="k">else</span> <span class="s2">&quot;RGBAFormat&quot;</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_update_matrices</span><span class="p">(</span><span class="n">volume_files</span> <span class="o">=</span> <span class="p">[</span><span class="n">volume_path</span><span class="p">])</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_volumes</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">volume_cube</span>
    <span class="k">return</span> <span class="n">volume_cube</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">




<h2 id="threebrainpy.core.brain.Brain.build" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">build</span><span class="p">(</span><span class="n">path</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">dry_run</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>Build the brain cache. If <code>path</code> is not specified, the cache will be built under the temporary directory.
Args:
    path: The path to build the cache; default is using the <code>self._storage</code> path.
    dry_run: If True, the cache will not be built, instead, the build process will be printed to the console.</p>

          <details class="quote">
            <summary>Source code in <code>threebrainpy/core/brain.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 971</span>
<span class="normal"> 972</span>
<span class="normal"> 973</span>
<span class="normal"> 974</span>
<span class="normal"> 975</span>
<span class="normal"> 976</span>
<span class="normal"> 977</span>
<span class="normal"> 978</span>
<span class="normal"> 979</span>
<span class="normal"> 980</span>
<span class="normal"> 981</span>
<span class="normal"> 982</span>
<span class="normal"> 983</span>
<span class="normal"> 984</span>
<span class="normal"> 985</span>
<span class="normal"> 986</span>
<span class="normal"> 987</span>
<span class="normal"> 988</span>
<span class="normal"> 989</span>
<span class="normal"> 990</span>
<span class="normal"> 991</span>
<span class="normal"> 992</span>
<span class="normal"> 993</span>
<span class="normal"> 994</span>
<span class="normal"> 995</span>
<span class="normal"> 996</span>
<span class="normal"> 997</span>
<span class="normal"> 998</span>
<span class="normal"> 999</span>
<span class="normal">1000</span>
<span class="normal">1001</span>
<span class="normal">1002</span>
<span class="normal">1003</span>
<span class="normal">1004</span>
<span class="normal">1005</span>
<span class="normal">1006</span>
<span class="normal">1007</span>
<span class="normal">1008</span>
<span class="normal">1009</span>
<span class="normal">1010</span>
<span class="normal">1011</span>
<span class="normal">1012</span>
<span class="normal">1013</span>
<span class="normal">1014</span>
<span class="normal">1015</span>
<span class="normal">1016</span>
<span class="normal">1017</span>
<span class="normal">1018</span>
<span class="normal">1019</span>
<span class="normal">1020</span>
<span class="normal">1021</span>
<span class="normal">1022</span>
<span class="normal">1023</span>
<span class="normal">1024</span>
<span class="normal">1025</span>
<span class="normal">1026</span>
<span class="normal">1027</span>
<span class="normal">1028</span>
<span class="normal">1029</span>
<span class="normal">1030</span>
<span class="normal">1031</span>
<span class="normal">1032</span>
<span class="normal">1033</span>
<span class="normal">1034</span>
<span class="normal">1035</span>
<span class="normal">1036</span>
<span class="normal">1037</span>
<span class="normal">1038</span>
<span class="normal">1039</span>
<span class="normal">1040</span>
<span class="normal">1041</span>
<span class="normal">1042</span>
<span class="normal">1043</span>
<span class="normal">1044</span>
<span class="normal">1045</span>
<span class="normal">1046</span>
<span class="normal">1047</span>
<span class="normal">1048</span>
<span class="normal">1049</span>
<span class="normal">1050</span>
<span class="normal">1051</span>
<span class="normal">1052</span>
<span class="normal">1053</span>
<span class="normal">1054</span>
<span class="normal">1055</span>
<span class="normal">1056</span>
<span class="normal">1057</span>
<span class="normal">1058</span>
<span class="normal">1059</span>
<span class="normal">1060</span>
<span class="normal">1061</span>
<span class="normal">1062</span>
<span class="normal">1063</span>
<span class="normal">1064</span>
<span class="normal">1065</span>
<span class="normal">1066</span>
<span class="normal">1067</span>
<span class="normal">1068</span>
<span class="normal">1069</span>
<span class="normal">1070</span>
<span class="normal">1071</span>
<span class="normal">1072</span>
<span class="normal">1073</span>
<span class="normal">1074</span>
<span class="normal">1075</span>
<span class="normal">1076</span>
<span class="normal">1077</span>
<span class="normal">1078</span>
<span class="normal">1079</span>
<span class="normal">1080</span>
<span class="normal">1081</span>
<span class="normal">1082</span>
<span class="normal">1083</span>
<span class="normal">1084</span>
<span class="normal">1085</span>
<span class="normal">1086</span>
<span class="normal">1087</span>
<span class="normal">1088</span>
<span class="normal">1089</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">build</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span> <span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">dry_run</span> <span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Build the brain cache. If `path` is not specified, the cache will be built under the temporary directory.</span>
<span class="sd">    Args:</span>
<span class="sd">        path: The path to build the cache; default is using the `self._storage` path.</span>
<span class="sd">        dry_run: If True, the cache will not be built, instead, the build process will be printed to the console.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">config</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">to_dict</span><span class="p">()</span>
    <span class="c1"># Needs to generate a global data dict to include all global data for compatibility</span>
    <span class="n">build_global</span> <span class="o">=</span> <span class="n">BlankPlaceholder</span><span class="p">(</span><span class="n">brain</span> <span class="o">=</span> <span class="bp">self</span><span class="p">,</span> <span class="n">is_global</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
    <span class="n">build_group</span> <span class="o">=</span> <span class="n">GeomWrapper</span><span class="p">(</span><span class="n">brain</span> <span class="o">=</span> <span class="bp">self</span><span class="p">,</span> <span class="n">name</span> <span class="o">=</span> <span class="n">build_global</span><span class="o">.</span><span class="n">group_name</span><span class="p">)</span>
    <span class="n">config</span><span class="p">[</span><span class="s1">&#39;geoms&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">build_global</span><span class="p">)</span>
    <span class="n">config</span><span class="p">[</span><span class="s1">&#39;groups&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">build_group</span><span class="p">)</span>
    <span class="n">build_group</span><span class="o">.</span><span class="n">set_group_data</span><span class="p">(</span><span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;__global_data__.subject_codes&#39;</span><span class="p">,</span> <span class="n">value</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">subject_code</span><span class="p">],</span> <span class="n">is_cache</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span>

    <span class="c1"># Construct colormaps</span>
    <span class="n">cmaps</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">colormap</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_electrode_cmaps</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="n">cmap_data</span> <span class="o">=</span> <span class="n">colormap</span><span class="o">.</span><span class="n">to_dict</span><span class="p">()</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">cmap_data</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
            <span class="n">cmaps</span><span class="p">[</span> <span class="n">colormap</span><span class="o">.</span><span class="n">name</span> <span class="p">]</span> <span class="o">=</span> <span class="n">cmap_data</span>
    <span class="n">default_cmap</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">cmaps</span><span class="o">.</span><span class="n">keys</span><span class="p">())[</span><span class="mi">0</span><span class="p">]</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">cmaps</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="kc">None</span>

    <span class="c1"># Hard-code for now</span>
    <span class="n">build_group</span><span class="o">.</span><span class="n">set_group_data</span><span class="p">(</span>
        <span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;__global_data__.SurfaceColorLUT&#39;</span><span class="p">,</span> 
        <span class="n">value</span> <span class="o">=</span> <span class="n">template_path</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;lib/threeBrain_data-0/</span><span class="si">{</span><span class="w"> </span><span class="n">build_group</span><span class="o">.</span><span class="n">cache_name</span><span class="w"> </span><span class="si">}</span><span class="s2">/ContinuousSample.json&quot;</span><span class="p">),</span>
        <span class="n">is_cache</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="p">)</span>
    <span class="n">build_group</span><span class="o">.</span><span class="n">set_group_data</span><span class="p">(</span>
        <span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;__global_data__.VolumeColorLUT&#39;</span><span class="p">,</span> 
        <span class="n">value</span> <span class="o">=</span> <span class="n">template_path</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;lib/threeBrain_data-0/</span><span class="si">{</span><span class="w"> </span><span class="n">build_group</span><span class="o">.</span><span class="n">cache_name</span><span class="w"> </span><span class="si">}</span><span class="s2">/FreeSurferColorLUT.json&quot;</span><span class="p">),</span>
        <span class="n">is_cache</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="p">)</span>
    <span class="n">build_group</span><span class="o">.</span><span class="n">set_group_data</span><span class="p">(</span>
        <span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;__global_data__.FSColorLUT&#39;</span><span class="p">,</span> 
        <span class="n">value</span> <span class="o">=</span> <span class="n">template_path</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;lib/threeBrain_data-0/</span><span class="si">{</span><span class="w"> </span><span class="n">build_group</span><span class="o">.</span><span class="n">cache_name</span><span class="w"> </span><span class="si">}</span><span class="s2">/FSColorLUT.json&quot;</span><span class="p">),</span>
        <span class="n">is_cache</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="p">)</span>

    <span class="n">settings</span> <span class="o">=</span> <span class="n">config</span><span class="p">[</span><span class="s1">&#39;settings&#39;</span><span class="p">]</span>
    <span class="n">settings</span><span class="p">[</span><span class="s1">&#39;title&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
    <span class="n">settings</span><span class="p">[</span><span class="s1">&#39;side_camera&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="n">settings</span><span class="p">[</span><span class="s1">&#39;side_canvas_zoom&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="n">settings</span><span class="p">[</span><span class="s1">&#39;side_canvas_width&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">250</span>
    <span class="n">settings</span><span class="p">[</span><span class="s1">&#39;side_canvas_shift&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
    <span class="n">settings</span><span class="p">[</span><span class="s1">&#39;color_maps&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">cmaps</span>
    <span class="n">settings</span><span class="p">[</span><span class="s1">&#39;default_colormap&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">default_cmap</span>
    <span class="n">settings</span><span class="p">[</span><span class="s1">&#39;hide_controls&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="n">settings</span><span class="p">[</span><span class="s1">&#39;control_center&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
    <span class="n">settings</span><span class="p">[</span><span class="s1">&#39;camera_pos&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="mi">500</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
    <span class="n">settings</span><span class="p">[</span><span class="s1">&#39;font_magnification&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="n">settings</span><span class="p">[</span><span class="s1">&#39;start_zoom&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="n">settings</span><span class="p">[</span><span class="s1">&#39;show_legend&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="n">settings</span><span class="p">[</span><span class="s1">&#39;render_timestamp&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="n">settings</span><span class="p">[</span><span class="s1">&#39;control_presets&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span>
        <span class="s2">&quot;subject2&quot;</span><span class="p">,</span> <span class="s2">&quot;surface_type2&quot;</span><span class="p">,</span> <span class="s2">&quot;hemisphere_material&quot;</span><span class="p">,</span> <span class="s2">&quot;surface_color&quot;</span><span class="p">,</span> <span class="s2">&quot;map_template&quot;</span><span class="p">,</span>
        <span class="s2">&quot;electrodes&quot;</span><span class="p">,</span> <span class="s2">&quot;voxel&quot;</span><span class="p">,</span> <span class="s2">&quot;animation&quot;</span><span class="p">,</span> <span class="s2">&quot;display_highlights&quot;</span>
    <span class="p">]</span>
    <span class="n">settings</span><span class="p">[</span><span class="s1">&#39;cache_folder&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;lib/threebrain_data-0/&quot;</span>
    <span class="n">settings</span><span class="p">[</span><span class="s1">&#39;lib_path&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;lib/&quot;</span>
    <span class="n">settings</span><span class="p">[</span><span class="s1">&#39;default_controllers&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">settings</span><span class="p">[</span><span class="s1">&#39;debug&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="n">settings</span><span class="p">[</span><span class="s1">&#39;background&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;#FFFFFF&quot;</span>
    <span class="n">settings</span><span class="p">[</span><span class="s1">&#39;token&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">settings</span><span class="p">[</span><span class="s1">&#39;show_inactive_electrodes&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="n">settings</span><span class="p">[</span><span class="s1">&#39;side_display&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="n">settings</span><span class="p">[</span><span class="s1">&#39;control_display&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="n">settings</span><span class="p">[</span><span class="s1">&#39;custom_javascript&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="c1"># write files</span>
    <span class="c1"># dry_run = False</span>
    <span class="c1"># path=os.path.join(ensure_default_temporary_directory(), &quot;test&quot;)</span>
    <span class="k">if</span> <span class="n">path</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_storage</span><span class="o">.</span><span class="n">name</span>
    <span class="n">init_skeleton</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">dry_run</span> <span class="o">=</span> <span class="n">dry_run</span><span class="p">)</span>
    <span class="c1"># for each group data, check if is_cache, if so, copy the file to the cache folder</span>
    <span class="k">for</span> <span class="n">group</span> <span class="ow">in</span> <span class="n">config</span><span class="p">[</span><span class="s1">&#39;groups&#39;</span><span class="p">]:</span>
        <span class="n">group</span><span class="o">.</span><span class="n">build</span><span class="p">(</span><span class="n">path</span> <span class="o">=</span> <span class="n">path</span><span class="p">,</span> <span class="n">dry_run</span> <span class="o">=</span> <span class="n">dry_run</span><span class="p">)</span>
    <span class="c1"># construct config.json</span>
    <span class="n">config_fname</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;config_</span><span class="si">{</span><span class="n">rand_string</span><span class="p">(</span><span class="mi">16</span><span class="p">)</span><span class="si">}</span><span class="s2">.json&quot;</span>
    <span class="k">if</span> <span class="n">dry_run</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Writing </span><span class="si">{</span><span class="n">config_fname</span><span class="si">}</span><span class="s2">...&quot;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="kn">import</span> <span class="nn">json</span>
        <span class="n">s</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">({</span>
            <span class="s2">&quot;groups&quot;</span><span class="p">:</span> <span class="n">config</span><span class="p">[</span><span class="s1">&#39;groups&#39;</span><span class="p">],</span>
            <span class="s2">&quot;geoms&quot;</span><span class="p">:</span> <span class="n">config</span><span class="p">[</span><span class="s1">&#39;geoms&#39;</span><span class="p">],</span>
        <span class="p">},</span> <span class="bp">cls</span> <span class="o">=</span> <span class="n">GeomEncoder</span><span class="p">)</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="s2">&quot;lib&quot;</span><span class="p">,</span> <span class="s2">&quot;threebrain_data-0&quot;</span><span class="p">,</span> <span class="n">config_fname</span><span class="p">),</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>

    <span class="n">widget_data</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;data_filename&#39;</span> <span class="p">:</span> <span class="n">config_fname</span><span class="p">,</span>
        <span class="s2">&quot;force_render&quot;</span><span class="p">:</span><span class="kc">True</span><span class="p">,</span>
        <span class="s1">&#39;settings&#39;</span> <span class="p">:</span> <span class="n">settings</span><span class="p">,</span>
    <span class="p">}</span>

    <span class="c1"># construct index.html</span>
    <span class="k">if</span> <span class="n">dry_run</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Writing index.html...&quot;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">template_path</span><span class="p">(</span><span class="s2">&quot;index.html&quot;</span><span class="p">),</span> <span class="s2">&quot;r&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">index_content</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">readlines</span><span class="p">())</span>
        <span class="n">index_content</span> <span class="o">=</span> <span class="n">index_content</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;WIDGET_ID&quot;</span><span class="p">,</span> <span class="s2">&quot;threebrainpy-viewer&quot;</span><span class="p">)</span>
        <span class="n">index_content</span> <span class="o">=</span> <span class="n">index_content</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span>
            <span class="s2">&quot;WIDGET_DATA&quot;</span><span class="p">,</span>
            <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">({</span>
                <span class="s1">&#39;x&#39;</span> <span class="p">:</span> <span class="n">widget_data</span><span class="p">,</span>
                <span class="s2">&quot;evals&quot;</span><span class="p">:[],</span><span class="s2">&quot;jsHooks&quot;</span><span class="p">:[]</span>
            <span class="p">},</span> <span class="bp">cls</span> <span class="o">=</span> <span class="n">GeomEncoder</span><span class="p">)</span>
        <span class="p">)</span>
        <span class="n">index_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="s2">&quot;index.html&quot;</span><span class="p">)</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">index_path</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">index_content</span><span class="p">)</span>
    <span class="c1"># set global data</span>
    <span class="c1"># dict_keys([&#39;__global_data__DemoSubject&#39;, &#39;__global_data__.VolumeColorLUT&#39;, &#39;__global_data__.FSColorLUT&#39;])</span>
    <span class="c1"># config[&#39;groups&#39;][0][&#39;group_data&#39;][&#39;__global_data__DemoSubject&#39;]</span>
    <span class="k">return</span> <span class="n">widget_data</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">




<h2 id="threebrainpy.core.brain.Brain.clean_electrodes" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">clean_electrodes</span><span class="p">()</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>Remove all electrode contacts from the brain.</p>

          <details class="quote">
            <summary>Source code in <code>threebrainpy/core/brain.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">710</span>
<span class="normal">711</span>
<span class="normal">712</span>
<span class="normal">713</span>
<span class="normal">714</span>
<span class="normal">715</span>
<span class="normal">716</span>
<span class="normal">717</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">clean_electrodes</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Remove all electrode contacts from the brain.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">contact_names</span> <span class="o">=</span> <span class="p">[</span><span class="n">contact</span><span class="o">.</span><span class="n">name</span> <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">contact</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_electrode_contacts</span><span class="o">.</span><span class="n">items</span><span class="p">()]</span>
    <span class="k">for</span> <span class="n">contact_name</span> <span class="ow">in</span> <span class="n">contact_names</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_geoms</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">contact_name</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_electrode_contacts</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">contact_name</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">




<h2 id="threebrainpy.core.brain.Brain.ensure_group" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">ensure_group</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>Ensure that a geometry group exists, if not, create one.
Args:
    name: The name of the group.
    kwargs: Other arguments to be passed to <code>add_group</code>.
Returns:
    The group instance.</p>

          <details class="quote">
            <summary>Source code in <code>threebrainpy/core/brain.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">ensure_group</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span> <span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span> <span class="p">:</span> <span class="nb">dict</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">GeomWrapper</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Ensure that a geometry group exists, if not, create one.</span>
<span class="sd">    Args:</span>
<span class="sd">        name: The name of the group.</span>
<span class="sd">        kwargs: Other arguments to be passed to `add_group`.</span>
<span class="sd">    Returns:</span>
<span class="sd">        The group instance.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">has_group</span><span class="p">(</span><span class="n">name</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_group</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">add_group</span><span class="p">(</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span><span class="p">,</span> <span class="n">exists_ok</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">




<h2 id="threebrainpy.core.brain.Brain.get_electrode_colormap" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">get_electrode_colormap</span><span class="p">(</span><span class="n">name</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>Get the colormap of an electrode contact.
Args:
    name: The name of the electrode keyframe (which is also the color-map name).
Returns:
    The colormap instance or <code>None</code> if the colormap does not exist.</p>

          <details class="quote">
            <summary>Source code in <code>threebrainpy/core/brain.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">924</span>
<span class="normal">925</span>
<span class="normal">926</span>
<span class="normal">927</span>
<span class="normal">928</span>
<span class="normal">929</span>
<span class="normal">930</span>
<span class="normal">931</span>
<span class="normal">932</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">get_electrode_colormap</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span> <span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ElectrodeColormap</span> <span class="o">|</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Get the colormap of an electrode contact.</span>
<span class="sd">    Args:</span>
<span class="sd">        name: The name of the electrode keyframe (which is also the color-map name).</span>
<span class="sd">    Returns:</span>
<span class="sd">        The colormap instance or `None` if the colormap does not exist.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_electrode_cmaps</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">




<h2 id="threebrainpy.core.brain.Brain.get_electrode_contact" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">get_electrode_contact</span><span class="p">(</span><span class="n">number</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>Get an electrode contact from the brain.
Args:
    number: The integer number of the electrode contact, starting from 1.
Returns:
    The electrode contact instance or <code>None</code> if the electrode contact does not exist.</p>

          <details class="quote">
            <summary>Source code in <code>threebrainpy/core/brain.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">695</span>
<span class="normal">696</span>
<span class="normal">697</span>
<span class="normal">698</span>
<span class="normal">699</span>
<span class="normal">700</span>
<span class="normal">701</span>
<span class="normal">702</span>
<span class="normal">703</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">get_electrode_contact</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">number</span> <span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ElectrodeSphere</span> <span class="o">|</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Get an electrode contact from the brain.</span>
<span class="sd">    Args:</span>
<span class="sd">        number: The integer number of the electrode contact, starting from 1.</span>
<span class="sd">    Returns:</span>
<span class="sd">        The electrode contact instance or `None` if the electrode contact does not exist.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_electrode_contacts</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">number</span><span class="p">),</span> <span class="kc">None</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">




<h2 id="threebrainpy.core.brain.Brain.get_geometry" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">get_geometry</span><span class="p">(</span><span class="n">name</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>Get a geometry instance from the brain.
Args:
    name: The name of the geometry template.
Returns:
    The geometry instance or <code>None</code> if the geometry instance does not exist.</p>

          <details class="quote">
            <summary>Source code in <code>threebrainpy/core/brain.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">420</span>
<span class="normal">421</span>
<span class="normal">422</span>
<span class="normal">423</span>
<span class="normal">424</span>
<span class="normal">425</span>
<span class="normal">426</span>
<span class="normal">427</span>
<span class="normal">428</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">get_geometry</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span> <span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">GeometryTemplate</span> <span class="o">|</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Get a geometry instance from the brain.</span>
<span class="sd">    Args:</span>
<span class="sd">        name: The name of the geometry template.</span>
<span class="sd">    Returns:</span>
<span class="sd">        The geometry instance or `None` if the geometry instance does not exist.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_geoms</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">




<h2 id="threebrainpy.core.brain.Brain.get_global_data" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">get_global_data</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">force_reload</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">ifnotfound</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>Get group data from the brain instance.
Args:
    name: The name of the group data.
    force_reload: Whether to force reload the group data.
    ifnotfound: If the group data is not found, return this value.
Returns:
    The value of the group data, or <code>ifnotfound</code>.</p>

          <details class="quote">
            <summary>Source code in <code>threebrainpy/core/brain.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">403</span>
<span class="normal">404</span>
<span class="normal">405</span>
<span class="normal">406</span>
<span class="normal">407</span>
<span class="normal">408</span>
<span class="normal">409</span>
<span class="normal">410</span>
<span class="normal">411</span>
<span class="normal">412</span>
<span class="normal">413</span>
<span class="normal">414</span>
<span class="normal">415</span>
<span class="normal">416</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">get_global_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span> <span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">force_reload</span> <span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">ifnotfound</span> <span class="p">:</span> <span class="nb">any</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">any</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Get group data from the brain instance.</span>
<span class="sd">    Args:</span>
<span class="sd">        name: The name of the group data.</span>
<span class="sd">        force_reload: Whether to force reload the group data.</span>
<span class="sd">        ifnotfound: If the group data is not found, return this value.</span>
<span class="sd">    Returns:</span>
<span class="sd">        The value of the group data, or `ifnotfound`.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">group</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_group</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">group</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">ifnotfound</span>
    <span class="k">return</span> <span class="n">group</span><span class="o">.</span><span class="n">get_group_data</span><span class="p">(</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span><span class="p">,</span> <span class="n">force_reload</span> <span class="o">=</span> <span class="n">force_reload</span><span class="p">,</span> <span class="n">ifnotfound</span> <span class="o">=</span> <span class="n">ifnotfound</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">




<h2 id="threebrainpy.core.brain.Brain.get_group" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">get_group</span><span class="p">(</span><span class="n">name</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>Get a geometry group from the brain.
Args:
    name: The name of the group.
Returns:
    The group instance or <code>None</code> if the group does not exist.</p>

          <details class="quote">
            <summary>Source code in <code>threebrainpy/core/brain.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">get_group</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span> <span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">GeomWrapper</span> <span class="o">|</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Get a geometry group from the brain.</span>
<span class="sd">    Args:</span>
<span class="sd">        name: The name of the group.</span>
<span class="sd">    Returns:</span>
<span class="sd">        The group instance or `None` if the group does not exist.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_groups</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">




<h2 id="threebrainpy.core.brain.Brain.get_slice" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">get_slice</span><span class="p">(</span><span class="n">name</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>Get MRI slices from the brain.
Args:
    name: The name of the slice.
Returns:
    The slice instance or <code>None</code> if the slice does not exist.</p>

          <details class="quote">
            <summary>Source code in <code>threebrainpy/core/brain.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">468</span>
<span class="normal">469</span>
<span class="normal">470</span>
<span class="normal">471</span>
<span class="normal">472</span>
<span class="normal">473</span>
<span class="normal">474</span>
<span class="normal">475</span>
<span class="normal">476</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">get_slice</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span> <span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">VolumeSlice</span> <span class="o">|</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Get MRI slices from the brain.</span>
<span class="sd">    Args:</span>
<span class="sd">        name: The name of the slice.</span>
<span class="sd">    Returns:</span>
<span class="sd">        The slice instance or `None` if the slice does not exist.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_slices</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">




<h2 id="threebrainpy.core.brain.Brain.get_slices" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">get_slices</span><span class="p">()</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>Get all MRI slices from the brain.</p>

          <details class="quote">
            <summary>Source code in <code>threebrainpy/core/brain.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">477</span>
<span class="normal">478</span>
<span class="normal">479</span>
<span class="normal">480</span>
<span class="normal">481</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">get_slices</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="n">VolumeSlice</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Get all MRI slices from the brain.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_slices</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">




<h2 id="threebrainpy.core.brain.Brain.get_surfaces" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">get_surfaces</span><span class="p">(</span><span class="n">surface_type</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>Get surfaces from the brain.
Args:
    surface_type: The type of the surface, e.g. "pial", "white", "inflated", "sphere" (see <code>surf/</code> folder, usually <code>[lr]h.&lt;surface_type&gt;</code>).
Returns:
    A dictionary of surface instances if exist, with keys being the hemesphere.</p>

          <details class="quote">
            <summary>Source code in <code>threebrainpy/core/brain.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">610</span>
<span class="normal">611</span>
<span class="normal">612</span>
<span class="normal">613</span>
<span class="normal">614</span>
<span class="normal">615</span>
<span class="normal">616</span>
<span class="normal">617</span>
<span class="normal">618</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">get_surfaces</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">surface_type</span> <span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span> <span class="o">|</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Get surfaces from the brain.</span>
<span class="sd">    Args:</span>
<span class="sd">        surface_type: The type of the surface, e.g. &quot;pial&quot;, &quot;white&quot;, &quot;inflated&quot;, &quot;sphere&quot; (see `surf/` folder, usually `[lr]h.&lt;surface_type&gt;`).</span>
<span class="sd">    Returns:</span>
<span class="sd">        A dictionary of surface instances if exist, with keys being the hemesphere.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_surfaces</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">surface_type</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">




<h2 id="threebrainpy.core.brain.Brain.get_transform" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">get_transform</span><span class="p">(</span><span class="n">space_from</span><span class="p">,</span> <span class="n">space_to</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>Get transform matrix from <code>space_from</code> to <code>space_to</code>. 
Args:
    space_from: The space from which the transform matrix is defined.
        choices are <code>voxel</code>, <code>ras</code>, <code>ras_tkr</code>, <code>mni305</code>, <code>mni152</code>.
    space_to: The space to which the transform matrix is defined.
        see <code>space_from</code> for choices.
Examples:
    &gt;&gt;&gt; brain.get_transform(space_from = "voxel", space_to = "ras_tkr")
    Mat44 (T1.voxel -&gt; T1.ras_tkr): 
    array([[  -1.,    0.,    0.,  128.],
        [   0.,    0.,    1., -128.],
        [   0.,   -1.,    0.,  128.],
        [   0.,    0.,    0.,    1.]])</p>

          <details class="quote">
            <summary>Source code in <code>threebrainpy/core/brain.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">get_transform</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">space_from</span> <span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">space_to</span> <span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Mat44</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Get transform matrix from `space_from` to `space_to`. </span>
<span class="sd">    Args:</span>
<span class="sd">        space_from: The space from which the transform matrix is defined.</span>
<span class="sd">            choices are `voxel`, `ras`, `ras_tkr`, `mni305`, `mni152`.</span>
<span class="sd">        space_to: The space to which the transform matrix is defined.</span>
<span class="sd">            see `space_from` for choices.</span>
<span class="sd">    Examples:</span>
<span class="sd">        &gt;&gt;&gt; brain.get_transform(space_from = &quot;voxel&quot;, space_to = &quot;ras_tkr&quot;)</span>
<span class="sd">        Mat44 (T1.voxel -&gt; T1.ras_tkr): </span>
<span class="sd">        array([[  -1.,    0.,    0.,  128.],</span>
<span class="sd">            [   0.,    0.,    1., -128.],</span>
<span class="sd">            [   0.,   -1.,    0.,  128.],</span>
<span class="sd">            [   0.,    0.,    0.,    1.]])</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">if</span> <span class="n">space_from</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">CONSTANTS</span><span class="o">.</span><span class="n">SUPPORTED_SPACES</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Invalid space_from: </span><span class="si">{</span><span class="n">space_from</span><span class="si">}</span><span class="s2">, supported spaces are: </span><span class="si">{</span><span class="n">CONSTANTS</span><span class="o">.</span><span class="n">SUPPORTED_SPACES</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">space_to</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">CONSTANTS</span><span class="o">.</span><span class="n">SUPPORTED_SPACES</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Invalid space_to: </span><span class="si">{</span><span class="n">space_to</span><span class="si">}</span><span class="s2">, supported spaces are: </span><span class="si">{</span><span class="n">CONSTANTS</span><span class="o">.</span><span class="n">SUPPORTED_SPACES</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">space_from</span> <span class="o">==</span> <span class="n">space_to</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">Mat44</span><span class="p">(</span><span class="n">space_from</span><span class="o">=</span><span class="n">space_from</span><span class="p">,</span> <span class="n">space_to</span><span class="o">=</span><span class="n">space_to</span><span class="p">,</span> <span class="n">modality_from</span><span class="o">=</span><span class="s2">&quot;T1&quot;</span><span class="p">,</span> <span class="n">modality_to</span><span class="o">=</span><span class="s2">&quot;T1&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">space_from</span> <span class="o">==</span> <span class="s2">&quot;ras&quot;</span><span class="p">:</span>
        <span class="n">transform</span> <span class="o">=</span> <span class="n">Mat44</span><span class="p">(</span><span class="n">space_from</span><span class="o">=</span><span class="s2">&quot;ras&quot;</span><span class="p">,</span> <span class="n">space_to</span><span class="o">=</span><span class="s2">&quot;ras&quot;</span><span class="p">,</span> <span class="n">modality_from</span><span class="o">=</span><span class="s2">&quot;T1&quot;</span><span class="p">,</span> <span class="n">modality_to</span><span class="o">=</span><span class="s2">&quot;T1&quot;</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">space_from</span> <span class="o">==</span> <span class="s2">&quot;ras_tkr&quot;</span><span class="p">:</span>
        <span class="n">transform</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="o">~</span><span class="bp">self</span><span class="o">.</span><span class="n">ras2ras_tkr</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">space_from</span> <span class="o">==</span> <span class="s2">&quot;mni305&quot;</span><span class="p">:</span>
        <span class="n">transform</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="o">~</span><span class="bp">self</span><span class="o">.</span><span class="n">ras2mni_305</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">space_from</span> <span class="o">==</span> <span class="s2">&quot;mni152&quot;</span><span class="p">:</span>
        <span class="n">transform</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="o">~</span><span class="bp">self</span><span class="o">.</span><span class="n">ras2mni_152</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">transform</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">vox2ras</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">space_to</span> <span class="o">==</span> <span class="s2">&quot;ras&quot;</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">transform</span>
    <span class="k">elif</span> <span class="n">space_to</span> <span class="o">==</span> <span class="s2">&quot;ras_tkr&quot;</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">ras2ras_tkr</span> <span class="o">*</span> <span class="n">transform</span>
    <span class="k">elif</span> <span class="n">space_to</span> <span class="o">==</span> <span class="s2">&quot;mni305&quot;</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">ras2mni_305</span> <span class="o">*</span> <span class="n">transform</span>
    <span class="k">elif</span> <span class="n">space_to</span> <span class="o">==</span> <span class="s2">&quot;mni152&quot;</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">ras2mni_152</span> <span class="o">*</span> <span class="n">transform</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">(</span><span class="o">~</span><span class="bp">self</span><span class="o">.</span><span class="n">vox2ras</span><span class="p">)</span> <span class="o">*</span> <span class="n">transform</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">




<h2 id="threebrainpy.core.brain.Brain.has_geometry" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">has_geometry</span><span class="p">(</span><span class="n">name</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>Check if the brain has a geometry instance.
Args:
    name: The name of the geometry template.
Returns:
    <code>True</code> if the geometry instance exists, <code>False</code> otherwise.</p>

          <details class="quote">
            <summary>Source code in <code>threebrainpy/core/brain.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">429</span>
<span class="normal">430</span>
<span class="normal">431</span>
<span class="normal">432</span>
<span class="normal">433</span>
<span class="normal">434</span>
<span class="normal">435</span>
<span class="normal">436</span>
<span class="normal">437</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">has_geometry</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span> <span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Check if the brain has a geometry instance.</span>
<span class="sd">    Args:</span>
<span class="sd">        name: The name of the geometry template.</span>
<span class="sd">    Returns:</span>
<span class="sd">        `True` if the geometry instance exists, `False` otherwise.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">return</span> <span class="n">name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_geoms</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">




<h2 id="threebrainpy.core.brain.Brain.has_group" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">has_group</span><span class="p">(</span><span class="n">name</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>Check if the brain has a geometry group.
Args:
    name: The name of the group.
Returns:
    <code>True</code> if the group exists, <code>False</code> otherwise.</p>

          <details class="quote">
            <summary>Source code in <code>threebrainpy/core/brain.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">has_group</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span> <span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Check if the brain has a geometry group.</span>
<span class="sd">    Args:</span>
<span class="sd">        name: The name of the group.</span>
<span class="sd">    Returns:</span>
<span class="sd">        `True` if the group exists, `False` otherwise.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">return</span> <span class="n">name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_groups</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">




<h2 id="threebrainpy.core.brain.Brain.has_slice" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">has_slice</span><span class="p">(</span><span class="n">name</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>Check if the brain has MRI slices with given name.</p>

          <details class="quote">
            <summary>Source code in <code>threebrainpy/core/brain.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">482</span>
<span class="normal">483</span>
<span class="normal">484</span>
<span class="normal">485</span>
<span class="normal">486</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">has_slice</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span> <span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Check if the brain has MRI slices with given name.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">return</span> <span class="n">name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_slices</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">




<h2 id="threebrainpy.core.brain.Brain.has_surface_type" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">has_surface_type</span><span class="p">(</span><span class="n">surface_type</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>Check if the brain has surfaces with given type.
Args:
    surface_type: The type of the surface, e.g. "pial", "white", "inflated", "sphere" (see <code>surf/</code> folder, usually <code>[lr]h.&lt;surface_type&gt;</code>).</p>

          <details class="quote">
            <summary>Source code in <code>threebrainpy/core/brain.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">619</span>
<span class="normal">620</span>
<span class="normal">621</span>
<span class="normal">622</span>
<span class="normal">623</span>
<span class="normal">624</span>
<span class="normal">625</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">has_surface_type</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">surface_type</span> <span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Check if the brain has surfaces with given type.</span>
<span class="sd">    Args:</span>
<span class="sd">        surface_type: The type of the surface, e.g. &quot;pial&quot;, &quot;white&quot;, &quot;inflated&quot;, &quot;sphere&quot; (see `surf/` folder, usually `[lr]h.&lt;surface_type&gt;`).</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">return</span> <span class="n">surface_type</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_surfaces</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">




<h2 id="threebrainpy.core.brain.Brain.render" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">render</span><span class="p">(</span><span class="n">launch_browser</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">host</span><span class="o">=</span><span class="s1">&#39;localhost&#39;</span><span class="p">,</span> <span class="n">port</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>Render the brain cache. If <code>path</code> is not specified, the cache will be rendered under the temporary directory.
Args:
    path: The path to render the cache; default is using the <code>self._storage</code> path.
    kwargs: Other arguments to be passed to <code>subprocess.call</code>.</p>

          <details class="quote">
            <summary>Source code in <code>threebrainpy/core/brain.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1091</span>
<span class="normal">1092</span>
<span class="normal">1093</span>
<span class="normal">1094</span>
<span class="normal">1095</span>
<span class="normal">1096</span>
<span class="normal">1097</span>
<span class="normal">1098</span>
<span class="normal">1099</span>
<span class="normal">1100</span>
<span class="normal">1101</span>
<span class="normal">1102</span>
<span class="normal">1103</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">render</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">launch_browser</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">host</span> <span class="o">=</span> <span class="s2">&quot;localhost&quot;</span><span class="p">,</span> <span class="n">port</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span> <span class="p">:</span> <span class="nb">dict</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Render the brain cache. If `path` is not specified, the cache will be rendered under the temporary directory.</span>
<span class="sd">    Args:</span>
<span class="sd">        path: The path to render the cache; default is using the `self._storage` path.</span>
<span class="sd">        kwargs: Other arguments to be passed to `subprocess.call`.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">build</span><span class="p">(</span><span class="n">dry_run</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">path</span><span class="o">=</span><span class="n">ensure_temporary_directory</span><span class="p">(</span><span class="s2">&quot;_threebrainpy-viewers&quot;</span><span class="p">),</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;dry_run&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">):</span>
        <span class="n">server</span> <span class="o">=</span> <span class="n">start_service</span><span class="p">(</span><span class="n">host</span> <span class="o">=</span> <span class="n">host</span><span class="p">,</span> <span class="n">port</span> <span class="o">=</span> <span class="n">port</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;[threebrainpy] viewer is running at: http://</span><span class="si">{}</span><span class="s2">:</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">server</span><span class="o">.</span><span class="n">host</span><span class="p">,</span> <span class="n">server</span><span class="o">.</span><span class="n">port</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">launch_browser</span><span class="p">:</span>
            <span class="n">server</span><span class="o">.</span><span class="n">browse</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">




<h2 id="threebrainpy.core.brain.Brain.set_electrode_keyframe" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">set_electrode_keyframe</span><span class="p">(</span><span class="n">number</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">time</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;value&#39;</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>Low-level method to set electrode contacts keyframe (values).
Args:
    number: The integer number of the electrode contact, starting from 1.
    value: The value of the keyframe, can be numerical or characters.
    time: The time (second) of the keyframe, default is <code>None</code> which means 0.
    name: The name of the keyframe, default is "value".
Returns:
    The keyframe created</p>

          <details class="quote">
            <summary>Source code in <code>threebrainpy/core/brain.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">678</span>
<span class="normal">679</span>
<span class="normal">680</span>
<span class="normal">681</span>
<span class="normal">682</span>
<span class="normal">683</span>
<span class="normal">684</span>
<span class="normal">685</span>
<span class="normal">686</span>
<span class="normal">687</span>
<span class="normal">688</span>
<span class="normal">689</span>
<span class="normal">690</span>
<span class="normal">691</span>
<span class="normal">692</span>
<span class="normal">693</span>
<span class="normal">694</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">set_electrode_keyframe</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">number</span> <span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">value</span> <span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">|</span> <span class="nb">list</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">|</span> <span class="nb">list</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">|</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">|</span> <span class="nb">float</span> <span class="o">|</span> <span class="nb">int</span> <span class="o">|</span> <span class="nb">str</span><span class="p">,</span> 
                           <span class="n">time</span> <span class="p">:</span> <span class="nb">float</span> <span class="o">|</span> <span class="nb">list</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">|</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">|</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> 
                           <span class="n">name</span> <span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;value&quot;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">SimpleKeyframe</span> <span class="o">|</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Low-level method to set electrode contacts keyframe (values).</span>
<span class="sd">    Args:</span>
<span class="sd">        number: The integer number of the electrode contact, starting from 1.</span>
<span class="sd">        value: The value of the keyframe, can be numerical or characters.</span>
<span class="sd">        time: The time (second) of the keyframe, default is `None` which means 0.</span>
<span class="sd">        name: The name of the keyframe, default is &quot;value&quot;.</span>
<span class="sd">    Returns:</span>
<span class="sd">        The keyframe created</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">contact</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_electrode_contacts</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">number</span><span class="p">),</span> <span class="kc">None</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">contact</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">None</span>
    <span class="k">return</span> <span class="n">contact</span><span class="o">.</span><span class="n">set_keyframe</span><span class="p">(</span><span class="n">value</span> <span class="o">=</span> <span class="n">value</span><span class="p">,</span> <span class="n">time</span> <span class="o">=</span> <span class="n">time</span><span class="p">,</span> <span class="n">name</span> <span class="o">=</span> <span class="n">name</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">




<h2 id="threebrainpy.core.brain.Brain.set_electrode_value" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">set_electrode_value</span><span class="p">(</span><span class="n">number</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">time</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>Set value to a electrode contact.
Args:
    number: The electrode contact number.
    name: The data name of the value.
    value: The value to set, can be a list of values or a single value.
    time: The time of the value, can be a list of times (in seconds) or a single time.
Returns: 
    The keyframe object or None if the electrode contact is not found.</p>

          <details class="quote">
            <summary>Source code in <code>threebrainpy/core/brain.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">844</span>
<span class="normal">845</span>
<span class="normal">846</span>
<span class="normal">847</span>
<span class="normal">848</span>
<span class="normal">849</span>
<span class="normal">850</span>
<span class="normal">851</span>
<span class="normal">852</span>
<span class="normal">853</span>
<span class="normal">854</span>
<span class="normal">855</span>
<span class="normal">856</span>
<span class="normal">857</span>
<span class="normal">858</span>
<span class="normal">859</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">set_electrode_value</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">number</span> <span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">name</span> <span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">value</span> <span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">|</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">|</span> <span class="nb">dict</span> <span class="o">|</span> <span class="nb">float</span> <span class="o">|</span> <span class="nb">str</span><span class="p">,</span> 
                        <span class="n">time</span> <span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">|</span> <span class="nb">float</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">SimpleKeyframe</span> <span class="o">|</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Set value to a electrode contact.</span>
<span class="sd">    Args:</span>
<span class="sd">        number: The electrode contact number.</span>
<span class="sd">        name: The data name of the value.</span>
<span class="sd">        value: The value to set, can be a list of values or a single value.</span>
<span class="sd">        time: The time of the value, can be a list of times (in seconds) or a single time.</span>
<span class="sd">    Returns: </span>
<span class="sd">        The keyframe object or None if the electrode contact is not found.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">contact</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_electrode_contacts</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">number</span><span class="p">),</span> <span class="kc">None</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">contact</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">None</span>
    <span class="k">return</span> <span class="n">contact</span><span class="o">.</span><span class="n">set_keyframe</span><span class="p">(</span><span class="n">value</span> <span class="o">=</span> <span class="n">value</span><span class="p">,</span> <span class="n">time</span> <span class="o">=</span> <span class="n">time</span><span class="p">,</span> <span class="n">name</span> <span class="o">=</span> <span class="n">name</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">




<h2 id="threebrainpy.core.brain.Brain.set_electrode_values" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">set_electrode_values</span><span class="p">(</span><span class="n">table</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>Set single or multiple values to multiple electrode contacts.
Args: 
    table: A pandas or a path to a csv file. The see 'Details' for table contents
Details:
    The table (or table file) contains the following columns (<strong>case-sensitive</strong>):</p>
<pre><code>* `Electrode` (mandatory): The electrode contact number, starting from 1
* `Subject` (optional): The subject code of the value, default is the current subject code
* `Time` (optional): The numeric time of the value, in seconds
* All other columns: The the column names are the data names of the values, can 
    be combinations of letters `[a-zA-Z]`, numbers `[0-9]`, dots `.`, and underscores `_`
</code></pre>
<p>Examples:
    The minimal table contains only the electrode contact number and the value:</p>
<pre><code>| Electrode | brain.response |
|-----------|----------------|
| 1         | 0.1            |
| 2         | 0.2            |
| 3         | 0.3            |


Here's an example of the table with two variables `brain.response` and `classifier`, 
and two electrodes `1` and `2`. The time range is `0~1` seconds.

| Electrode | Time | brain.response | classifier |
|-----------|------|----------------|------------|
| 1         | 0    | 0.1            | A          |
| 1         | 1    | 0.2            | A          |
| 2         | 0    | 0.3            | A          |
| 2         | 1    | 0.4            | B          |
</code></pre>

          <details class="quote">
            <summary>Source code in <code>threebrainpy/core/brain.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">860</span>
<span class="normal">861</span>
<span class="normal">862</span>
<span class="normal">863</span>
<span class="normal">864</span>
<span class="normal">865</span>
<span class="normal">866</span>
<span class="normal">867</span>
<span class="normal">868</span>
<span class="normal">869</span>
<span class="normal">870</span>
<span class="normal">871</span>
<span class="normal">872</span>
<span class="normal">873</span>
<span class="normal">874</span>
<span class="normal">875</span>
<span class="normal">876</span>
<span class="normal">877</span>
<span class="normal">878</span>
<span class="normal">879</span>
<span class="normal">880</span>
<span class="normal">881</span>
<span class="normal">882</span>
<span class="normal">883</span>
<span class="normal">884</span>
<span class="normal">885</span>
<span class="normal">886</span>
<span class="normal">887</span>
<span class="normal">888</span>
<span class="normal">889</span>
<span class="normal">890</span>
<span class="normal">891</span>
<span class="normal">892</span>
<span class="normal">893</span>
<span class="normal">894</span>
<span class="normal">895</span>
<span class="normal">896</span>
<span class="normal">897</span>
<span class="normal">898</span>
<span class="normal">899</span>
<span class="normal">900</span>
<span class="normal">901</span>
<span class="normal">902</span>
<span class="normal">903</span>
<span class="normal">904</span>
<span class="normal">905</span>
<span class="normal">906</span>
<span class="normal">907</span>
<span class="normal">908</span>
<span class="normal">909</span>
<span class="normal">910</span>
<span class="normal">911</span>
<span class="normal">912</span>
<span class="normal">913</span>
<span class="normal">914</span>
<span class="normal">915</span>
<span class="normal">916</span>
<span class="normal">917</span>
<span class="normal">918</span>
<span class="normal">919</span>
<span class="normal">920</span>
<span class="normal">921</span>
<span class="normal">922</span>
<span class="normal">923</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">set_electrode_values</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">table</span> <span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="n">DataFrame</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Set single or multiple values to multiple electrode contacts.</span>
<span class="sd">    Args: </span>
<span class="sd">        table: A pandas or a path to a csv file. The see &#39;Details&#39; for table contents</span>
<span class="sd">    Details:</span>
<span class="sd">        The table (or table file) contains the following columns (**case-sensitive**):</span>

<span class="sd">        * `Electrode` (mandatory): The electrode contact number, starting from 1</span>
<span class="sd">        * `Subject` (optional): The subject code of the value, default is the current subject code</span>
<span class="sd">        * `Time` (optional): The numeric time of the value, in seconds</span>
<span class="sd">        * All other columns: The the column names are the data names of the values, can </span>
<span class="sd">            be combinations of letters `[a-zA-Z]`, numbers `[0-9]`, dots `.`, and underscores `_`</span>
<span class="sd">    Examples:</span>
<span class="sd">        The minimal table contains only the electrode contact number and the value:</span>

<span class="sd">        | Electrode | brain.response |</span>
<span class="sd">        |-----------|----------------|</span>
<span class="sd">        | 1         | 0.1            |</span>
<span class="sd">        | 2         | 0.2            |</span>
<span class="sd">        | 3         | 0.3            |</span>


<span class="sd">        Here&#39;s an example of the table with two variables `brain.response` and `classifier`, </span>
<span class="sd">        and two electrodes `1` and `2`. The time range is `0~1` seconds.</span>

<span class="sd">        | Electrode | Time | brain.response | classifier |</span>
<span class="sd">        |-----------|------|----------------|------------|</span>
<span class="sd">        | 1         | 0    | 0.1            | A          |</span>
<span class="sd">        | 1         | 1    | 0.2            | A          |</span>
<span class="sd">        | 2         | 0    | 0.3            | A          |</span>
<span class="sd">        | 2         | 1    | 0.4            | B          |</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">table</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
        <span class="c1"># table = &quot;/Users/dipterix/rave_data/data_dir/demo/DemoSubject/rave/meta/electrodes.csv&quot;</span>
        <span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
        <span class="n">table</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">table</span><span class="p">,</span> <span class="n">sep</span> <span class="o">=</span> <span class="s2">&quot;,&quot;</span><span class="p">)</span>
    <span class="c1"># assume table is pandas since we don&#39;t want to import pandas here</span>
    <span class="k">if</span> <span class="s2">&quot;Electrode&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">table</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">LookupError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Invalid table, must contain column &#39;Electrode&#39;.&quot;</span><span class="p">)</span>
    <span class="n">time</span> <span class="o">=</span> <span class="n">table</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;Time&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
    <span class="n">subjects</span> <span class="o">=</span> <span class="n">table</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;Subject&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
    <span class="n">electrodes</span> <span class="o">=</span> <span class="n">table</span><span class="p">[</span><span class="s2">&quot;Electrode&quot;</span><span class="p">]</span>
    <span class="n">electrode_numbers</span> <span class="o">=</span> <span class="n">electrodes</span><span class="o">.</span><span class="n">unique</span><span class="p">()</span>
    <span class="n">var_names</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">table</span><span class="o">.</span><span class="n">columns</span> <span class="k">if</span> <span class="n">x</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;Electrode&quot;</span><span class="p">,</span> <span class="s2">&quot;Time&quot;</span><span class="p">]]</span>
    <span class="k">if</span> <span class="n">subjects</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">subjects</span> <span class="o">=</span> <span class="n">subjects</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">subject_code</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">subjects</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="k">for</span> <span class="n">electrode</span> <span class="ow">in</span> <span class="n">electrode_numbers</span><span class="p">:</span>
        <span class="n">sel</span> <span class="o">=</span> <span class="p">(</span><span class="n">electrodes</span> <span class="o">==</span> <span class="n">electrode</span><span class="p">)</span> <span class="o">&amp;</span> <span class="n">subjects</span>
        <span class="k">if</span> <span class="n">sel</span><span class="o">.</span><span class="n">size</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">sel</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">var_names</span><span class="p">:</span>
                <span class="n">keyframe</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">set_electrode_value</span><span class="p">(</span>
                    <span class="n">number</span> <span class="o">=</span> <span class="n">electrode</span><span class="p">,</span> <span class="n">name</span> <span class="o">=</span> <span class="n">name</span><span class="p">,</span> <span class="n">value</span> <span class="o">=</span> <span class="n">table</span><span class="p">[</span><span class="n">name</span><span class="p">][</span><span class="n">sel</span><span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">(),</span> 
                    <span class="n">time</span> <span class="o">=</span> <span class="kc">None</span> <span class="k">if</span> <span class="n">time</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">time</span><span class="p">[</span><span class="n">sel</span><span class="p">])</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">keyframe</span><span class="p">,</span> <span class="n">SimpleKeyframe</span><span class="p">):</span>
                    <span class="c1"># get colormap</span>
                    <span class="n">colormap</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_electrode_cmaps</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">colormap</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                        <span class="n">colormap</span> <span class="o">=</span> <span class="n">ElectrodeColormap</span><span class="p">(</span><span class="n">keyframe_name</span> <span class="o">=</span> <span class="n">keyframe</span><span class="p">,</span> <span class="n">value_type</span> <span class="o">=</span> <span class="s2">&quot;continuous&quot;</span> <span class="k">if</span> <span class="n">keyframe</span><span class="o">.</span><span class="n">is_continuous</span> <span class="k">else</span> <span class="s2">&quot;discrete&quot;</span><span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">_electrode_cmaps</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">colormap</span>
                    <span class="n">colormap</span><span class="o">.</span><span class="n">update_from_keyframe</span><span class="p">(</span> <span class="n">keyframe</span> <span class="o">=</span> <span class="n">keyframe</span> <span class="p">)</span>
    <span class="k">return</span> 
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">




<h2 id="threebrainpy.core.brain.Brain.set_group_data" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">set_group_data</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">is_cache</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">absolute_path</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">auto_create</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>Set group data to the brain so the JavaScript engine will have access to the data. 
    This method is a low-level function
Args:
    name: The name of the group data.
    value: If <code>is_cache=False</code>, the value of the group data, can be any JSON-serializable object.
        If <code>is_cache=True</code>, the path to, or the file name of the cached JSON file.
    is_cache: Whether the <code>value</code> is a cached JSON file.
    absolute_path: The absolute path to the cached JSON file.
    auto_create: Whether to create a group if the group does not exist.</p>

          <details class="quote">
            <summary>Source code in <code>threebrainpy/core/brain.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">set_group_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span> <span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">value</span> <span class="p">:</span> <span class="nb">any</span><span class="p">,</span> <span class="n">is_cache</span> <span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">absolute_path</span> <span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">auto_create</span> <span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Set group data to the brain so the JavaScript engine will have access to the data. </span>
<span class="sd">        This method is a low-level function</span>
<span class="sd">    Args:</span>
<span class="sd">        name: The name of the group data.</span>
<span class="sd">        value: If `is_cache=False`, the value of the group data, can be any JSON-serializable object.</span>
<span class="sd">            If `is_cache=True`, the path to, or the file name of the cached JSON file.</span>
<span class="sd">        is_cache: Whether the `value` is a cached JSON file.</span>
<span class="sd">        absolute_path: The absolute path to the cached JSON file.</span>
<span class="sd">        auto_create: Whether to create a group if the group does not exist.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">if</span> <span class="n">auto_create</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ensure_group</span><span class="p">(</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span><span class="p">)</span>
    <span class="n">group</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_group</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">group</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Group </span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2"> not found.&quot;</span><span class="p">)</span>
    <span class="n">group</span><span class="o">.</span><span class="n">set_group_data</span><span class="p">(</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span><span class="p">,</span> <span class="n">value</span> <span class="o">=</span> <span class="n">value</span><span class="p">,</span> <span class="n">is_cache</span> <span class="o">=</span> <span class="n">is_cache</span><span class="p">,</span> <span class="n">absolute_path</span> <span class="o">=</span> <span class="n">absolute_path</span><span class="p">)</span>
    <span class="k">return</span> <span class="kc">None</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">




<h2 id="threebrainpy.core.brain.Brain.set_transform_space" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">set_transform_space</span><span class="p">(</span><span class="n">transform</span><span class="p">,</span> <span class="n">space_from</span><span class="p">,</span> <span class="n">space_to</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>Returns a copy of <code>transform</code>, but with space transformed. 
Args:
    transform: The transform matrix of class <code>Mat44</code>. If <code>transform</code> is not specified, then the transform will be identity matrix.
    space_from: The space from which the transform matrix will be defined.
        choices are <code>voxel</code>, <code>ras</code>, <code>ras_tkr</code>, <code>mni305</code>, <code>mni152</code>.
    space_to: The space to which the transform matrix will be defined.
Returns:
    The new transform matrix with given spaces and inherited modalities.
Examples:
    If you have a matrix that switch the column and row indexes in the voxel space,
        what's the matrix in the ras space?
    &gt;&gt;&gt; from threebrainpy.core import Mat44
    &gt;&gt;&gt; idx_transform = Mat44([0,1,0,0,1,0,0,0,0,0,1,0], space_from = "voxel", space_to = "voxel")
    &gt;&gt;&gt; idx_transform
    Mat44 (T1.voxel -&gt; T1.voxel): 
    array([[0., 1., 0., 0.],
        [1., 0., 0., 0.],
        [0., 0., 1., 0.],
        [0., 0., 0., 1.]])
    &gt;&gt;&gt; # Applies idx_transform first then vox-to-ras
    &gt;&gt;&gt; brain.set_transform_space(transform = idx_transform, space_from = "voxel", space_to = "ras")
    Mat44 (T1.voxel -&gt; T1.ras): 
    array([[   0.        ,   -1.        ,    0.        ,  131.61447144],
        [   0.        ,    0.        ,    1.        , -127.5       ],
        [  -1.        ,    0.        ,    0.        ,  127.5       ],
        [   0.        ,    0.        ,    0.        ,    1.        ]])
    &gt;&gt;&gt; # To validate the transform
    &gt;&gt;&gt; brain.vox2ras * idx_transform
    Mat44 (T1.voxel -&gt; T1.ras): 
    array([[   0.        ,   -1.        ,    0.        ,  131.61447144],
        [   0.        ,    0.        ,    1.        , -127.5       ],
        [  -1.        ,    0.        ,    0.        ,  127.5       ],
        [   0.        ,    0.        ,    0.        ,    1.        ]])</p>

          <details class="quote">
            <summary>Source code in <code>threebrainpy/core/brain.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">set_transform_space</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">transform</span> <span class="p">:</span> <span class="n">Mat44</span><span class="p">,</span> <span class="n">space_from</span> <span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">space_to</span> <span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Mat44</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Returns a copy of `transform`, but with space transformed. </span>
<span class="sd">    Args:</span>
<span class="sd">        transform: The transform matrix of class `Mat44`. If `transform` is not specified, then the transform will be identity matrix.</span>
<span class="sd">        space_from: The space from which the transform matrix will be defined.</span>
<span class="sd">            choices are `voxel`, `ras`, `ras_tkr`, `mni305`, `mni152`.</span>
<span class="sd">        space_to: The space to which the transform matrix will be defined.</span>
<span class="sd">    Returns:</span>
<span class="sd">        The new transform matrix with given spaces and inherited modalities.</span>
<span class="sd">    Examples:</span>
<span class="sd">        If you have a matrix that switch the column and row indexes in the voxel space,</span>
<span class="sd">            what&#39;s the matrix in the ras space?</span>
<span class="sd">        &gt;&gt;&gt; from threebrainpy.core import Mat44</span>
<span class="sd">        &gt;&gt;&gt; idx_transform = Mat44([0,1,0,0,1,0,0,0,0,0,1,0], space_from = &quot;voxel&quot;, space_to = &quot;voxel&quot;)</span>
<span class="sd">        &gt;&gt;&gt; idx_transform</span>
<span class="sd">        Mat44 (T1.voxel -&gt; T1.voxel): </span>
<span class="sd">        array([[0., 1., 0., 0.],</span>
<span class="sd">            [1., 0., 0., 0.],</span>
<span class="sd">            [0., 0., 1., 0.],</span>
<span class="sd">            [0., 0., 0., 1.]])</span>
<span class="sd">        &gt;&gt;&gt; # Applies idx_transform first then vox-to-ras</span>
<span class="sd">        &gt;&gt;&gt; brain.set_transform_space(transform = idx_transform, space_from = &quot;voxel&quot;, space_to = &quot;ras&quot;)</span>
<span class="sd">        Mat44 (T1.voxel -&gt; T1.ras): </span>
<span class="sd">        array([[   0.        ,   -1.        ,    0.        ,  131.61447144],</span>
<span class="sd">            [   0.        ,    0.        ,    1.        , -127.5       ],</span>
<span class="sd">            [  -1.        ,    0.        ,    0.        ,  127.5       ],</span>
<span class="sd">            [   0.        ,    0.        ,    0.        ,    1.        ]])</span>
<span class="sd">        &gt;&gt;&gt; # To validate the transform</span>
<span class="sd">        &gt;&gt;&gt; brain.vox2ras * idx_transform</span>
<span class="sd">        Mat44 (T1.voxel -&gt; T1.ras): </span>
<span class="sd">        array([[   0.        ,   -1.        ,    0.        ,  131.61447144],</span>
<span class="sd">            [   0.        ,    0.        ,    1.        , -127.5       ],</span>
<span class="sd">            [  -1.        ,    0.        ,    0.        ,  127.5       ],</span>
<span class="sd">            [   0.        ,    0.        ,    0.        ,    1.        ]])</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">transform</span><span class="p">,</span> <span class="n">Mat44</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Invalid transform matrix: </span><span class="si">{</span><span class="n">transform</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">space_from</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">CONSTANTS</span><span class="o">.</span><span class="n">SUPPORTED_SPACES</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Invalid space_from: </span><span class="si">{</span><span class="n">space_from</span><span class="si">}</span><span class="s2">, supported spaces are: </span><span class="si">{</span><span class="n">CONSTANTS</span><span class="o">.</span><span class="n">SUPPORTED_SPACES</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">space_to</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">CONSTANTS</span><span class="o">.</span><span class="n">SUPPORTED_SPACES</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Invalid space_to: </span><span class="si">{</span><span class="n">space_to</span><span class="si">}</span><span class="s2">, supported spaces are: </span><span class="si">{</span><span class="n">CONSTANTS</span><span class="o">.</span><span class="n">SUPPORTED_SPACES</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="c1"># check modalities</span>
    <span class="k">if</span> <span class="n">transform</span><span class="o">.</span><span class="n">modality_from</span> <span class="o">!=</span> <span class="s2">&quot;T1&quot;</span> <span class="ow">and</span> <span class="n">transform</span><span class="o">.</span><span class="n">space_from</span> <span class="o">!=</span> <span class="n">space_from</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Invalid transform matrix: </span><span class="si">{</span><span class="n">transform</span><span class="si">}</span><span class="s2">, modality_from must be &#39;T1&#39; or space_from must be </span><span class="si">{</span><span class="n">space_from</span><span class="si">}</span><span class="s2">.&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">transform</span><span class="o">.</span><span class="n">modality_to</span> <span class="o">!=</span> <span class="s2">&quot;T1&quot;</span> <span class="ow">and</span> <span class="n">transform</span><span class="o">.</span><span class="n">space_to</span> <span class="o">!=</span> <span class="n">space_to</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Invalid transform matrix: </span><span class="si">{</span><span class="n">transform</span><span class="si">}</span><span class="s2">, modality_to must be &#39;T1&#39; or space_to must be </span><span class="si">{</span><span class="n">space_to</span><span class="si">}</span><span class="s2">.&quot;</span><span class="p">)</span>
    <span class="n">re</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="n">transform</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">transform</span><span class="o">.</span><span class="n">modality_from</span> <span class="o">==</span> <span class="s2">&quot;T1&quot;</span><span class="p">:</span>
        <span class="n">re</span> <span class="o">=</span> <span class="n">re</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_transform</span><span class="p">(</span><span class="n">space_to</span> <span class="o">=</span> <span class="n">transform</span><span class="o">.</span><span class="n">space_from</span><span class="p">,</span> <span class="n">space_from</span> <span class="o">=</span> <span class="n">space_from</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">transform</span><span class="o">.</span><span class="n">modality_to</span> <span class="o">==</span> <span class="s2">&quot;T1&quot;</span><span class="p">:</span>
        <span class="n">re</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_transform</span><span class="p">(</span><span class="n">space_from</span> <span class="o">=</span> <span class="n">transform</span><span class="o">.</span><span class="n">space_to</span><span class="p">,</span> <span class="n">space_to</span> <span class="o">=</span> <span class="n">space_to</span><span class="p">)</span> <span class="o">*</span> <span class="n">re</span>
    <span class="k">return</span> <span class="n">re</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">




<h2 id="threebrainpy.core.brain.Brain.to_dict" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">to_dict</span><span class="p">()</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>Convert the brain to a dict.
Returns: 
    A dict containing the brain data.</p>

          <details class="quote">
            <summary>Source code in <code>threebrainpy/core/brain.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">935</span>
<span class="normal">936</span>
<span class="normal">937</span>
<span class="normal">938</span>
<span class="normal">939</span>
<span class="normal">940</span>
<span class="normal">941</span>
<span class="normal">942</span>
<span class="normal">943</span>
<span class="normal">944</span>
<span class="normal">945</span>
<span class="normal">946</span>
<span class="normal">947</span>
<span class="normal">948</span>
<span class="normal">949</span>
<span class="normal">950</span>
<span class="normal">951</span>
<span class="normal">952</span>
<span class="normal">953</span>
<span class="normal">954</span>
<span class="normal">955</span>
<span class="normal">956</span>
<span class="normal">957</span>
<span class="normal">958</span>
<span class="normal">959</span>
<span class="normal">960</span>
<span class="normal">961</span>
<span class="normal">962</span>
<span class="normal">963</span>
<span class="normal">964</span>
<span class="normal">965</span>
<span class="normal">966</span>
<span class="normal">967</span>
<span class="normal">968</span>
<span class="normal">969</span>
<span class="normal">970</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">to_dict</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Convert the brain to a dict.</span>
<span class="sd">    Returns: </span>
<span class="sd">        A dict containing the brain data.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="c1"># global_data needs to be rebuilt</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_globals</span><span class="o">.</span><span class="n">set_group_data</span><span class="p">(</span>
        <span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;subject_data&quot;</span><span class="p">,</span> 
        <span class="n">is_cache</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">value</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;subject_code&#39;</span> <span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">subject_code</span><span class="p">,</span>
            <span class="s1">&#39;Norig&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">vox2ras</span><span class="o">.</span><span class="n">mat</span><span class="o">.</span><span class="n">tolist</span><span class="p">(),</span>
            <span class="s1">&#39;Torig&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">vox2ras_tkr</span><span class="o">.</span><span class="n">mat</span><span class="o">.</span><span class="n">tolist</span><span class="p">(),</span>
            <span class="s1">&#39;xfm&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">ras2mni_305</span><span class="o">.</span><span class="n">mat</span><span class="o">.</span><span class="n">tolist</span><span class="p">(),</span>
            <span class="c1"># FreeSurfer RAS to MNI305, should be ras_tkr2mni_305, but for compatibility, vox2vox_MNI305</span>
            <span class="s1">&#39;vox2vox_MNI305&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">ras_tkr2mni_305</span><span class="o">.</span><span class="n">mat</span><span class="o">.</span><span class="n">tolist</span><span class="p">(),</span>
            <span class="c1"># -(self$Norig %*% solve( self$Torig ) %*% c(0,0,0,1))[1:3]</span>
            <span class="s1">&#39;volume_types&#39;</span> <span class="p">:</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_slices</span><span class="o">.</span><span class="n">keys</span><span class="p">()),</span>
            <span class="s1">&#39;atlas_types&#39;</span> <span class="p">:</span> <span class="p">[],</span> <span class="c1"># self._atlases.keys()</span>
        <span class="p">})</span>
    <span class="n">geom_list</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">group_list</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">geom</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_geoms</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="n">geom_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">geom</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">group</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_groups</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="n">group_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">group</span><span class="p">)</span>
    <span class="c1"># The config file should contain groups and geoms</span>
    <span class="k">return</span> <span class="p">{</span>
        <span class="s1">&#39;subject_code&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">subject_code</span><span class="p">,</span>
        <span class="s1">&#39;storage&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">storage</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
        <span class="s1">&#39;path&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="p">,</span>
        <span class="s2">&quot;settings&quot;</span><span class="p">:</span> <span class="p">{},</span>
        <span class="s2">&quot;groups&quot;</span><span class="p">:</span> <span class="n">group_list</span><span class="p">,</span>
        <span class="s2">&quot;geoms&quot;</span><span class="p">:</span> <span class="n">geom_list</span><span class="p">,</span>
    <span class="p">}</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>



  </div>

  </div>

</div>





                
              </article>
            </div>
          
          
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    <script id="__config" type="application/json">{"base": "..", "features": [], "search": "../assets/javascripts/workers/search.dfff1995.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../assets/javascripts/bundle.78eede0e.min.js"></script>
      
    
  </body>
</html>